<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>'g7ctrl' Manual &amp; Handbook</title><link rel="stylesheet" type="text/css" href="article.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="#idm6361360" title="'g7ctrl' Manual &amp; Handbook"><link rel="next" href="#idp50519936" title="1 Preface"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article"><div class="titlepage"><div><div><h1 class="title"><a name="idm6361360"></a>'g7ctrl' Manual &amp; Handbook</h1></div><div><h3 class="subtitle"><i>Xtreme GM7 GPS Tracker Daemon
            <div class="mediaobject"><img src="gm7_tracker_tall.jpg" width="400"></div>
        </i></h3></div><div><div class="author"><h3 class="author">Johan Persson</h3><code class="email">&lt;<a class="email" href="mailto:johan162@gmail.com">johan162@gmail.com</a>&gt;</code></div></div><div><p class="releaseinfo">Manual RA15 (For daemon v3.2.0)</p></div><div><p class="copyright">Copyright © 2013-2015 Johan Persson</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50519936">1. Preface</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50562272">1.1. Acknowledgement</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#appendix.release-history">2. Overview - Release history and roadmap</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50478496">2.1. Major Public Releases</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50639616">2.2. High level roadmap</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50643680">2.3. Upgrading to 3.2.0 from previous versions</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.introduction">3. Introduction</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50620912">3.1. Typographic conventions used in the manual</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50697792">3.2. Why would you want this software?</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50775536">3.3. Who can use this software?</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50788432">3.4. Available documentation</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50796688">3.5. Summary of functionality</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.known-defects">3.6. Limitations and known defects in 3.x series</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50841008">3.7. Software License</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.installing">4. Installing</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50629408">4.1. System requirements</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50667312">4.2. Building and installing</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50678496">4.3. Installing the daemon as a systemd service</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50888080">4.4. Rebuilding the documentation</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50898288">4.5. Configuring and compiling the source using the distributed tarball</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.build-environment">4.6. Creating a build environment</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50946512">4.7. Configuring the daemon</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.running-the-daemon">5. Running the daemon</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50752464">5.1. Running the server, starting and stopping.</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50740416">5.2. For system using old style <code class="filename">init.d</code></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50708304">5.3. Using systemd</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50717712">5.4. Using upstart</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51007056">5.5. Command line argument</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51041760">5.6. Verifying that the daemon is running</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.security">5.7. Security</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51071664">5.8. Adding user hooks for special processing</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.command-shell">6. The command shell - "g7sh"</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50723840">6.1. Command line arguments</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50964960">6.2. Basic usage</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50860272">6.3. Configuring the shell as a login shell</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50982080">6.4. Command line editing and completion</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.connecting-device">7. Connecting the device </a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51095920">7.1. Connecting over USB</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51104464">7.2. Configuring USB connection</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51145248">7.3. Connecting over GPRS</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51156784">7.4. Connecting with text messages</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.controlling-device">8. Controlling the device using commands</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51111856">8.1. Controlling the device using server commands</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51290224">8.2. Controlling the device using "raw" device commands</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.using-presets">8.3. Using presets</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.receiving-data">9. Receiving data</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50748080">9.1. Setting up device to receive location updates</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.exporting-db">10. Exporting the DB</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp50973120">10.1. Supported export formats</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.configuring-the-daemon">Appendix A. Configuring the daemon</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51254112">A.1. The configuration file</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51257248">A.1.1. The <code class="literal">[startup]</code> section</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51695584">A.1.2. The <code class="literal">[config]</code> section</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51772544">A.1.3. The <code class="literal">[mail] </code>section</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51841776">A.1.4. The distributed configuration template file </a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.google-api-key">A.2. Creating and using a Google API key</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.mail-templates">A.3. Mail templates</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.event-scripts">A.4. Event-scripts</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.trouble-shooting">Appendix B. Troubleshooting</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51264768">B.1. The server is not receiving any location data</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51477584">B.2. The device is not connected via USB</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51496576">B.3. An error "port is in use" is shown</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.command-reference">Appendix C. Command reference</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51373312">C.1. Device Command reference</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.address">C.1.1. <span class="command"><strong>address</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.batt">C.1.2. <span class="command"><strong>batt</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.clrec">C.1.3. <span class="command"><strong>clrec</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.comm">C.1.4. <span class="command"><strong>comm</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.config">C.1.5. <span class="command"><strong>config</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.dlrec">C.1.6. <span class="command"><strong>dlrec</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.geofevt">C.1.7. <span class="command"><strong>gfevt</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.gfen">C.1.8. <span class="command"><strong>gfen</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.imei">C.1.9. <span class="command"><strong>imei</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.led">C.1.10. <span class="command"><strong>led</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.loc">C.1.11. <span class="command"><strong>loc</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.locg">C.1.12. <span class="command"><strong>locg</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.lowbatt">C.1.13. <span class="command"><strong>lowbatt</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.mswitch">C.1.14. <span class="command"><strong>mswitch</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.nrec">C.1.15. <span class="command"><strong>nrec</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.phone">C.1.16. <span class="command"><strong>phone</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.ps">C.1.17. <span class="command"><strong>ps</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.reboot">C.1.18. <span class="command"><strong>reboot</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.rec">C.1.19. <span class="command"><strong>rec</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.reset">C.1.20. <span class="command"><strong>reset</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.roam">C.1.21. <span class="command"><strong>roam</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.sense">C.1.22. <span class="command"><strong>sens</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.sim">C.1.23. <span class="command"><strong>sim</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.sleep">C.1.24. <span class="command"><strong>sleep</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.sms">C.1.25. <span class="command"><strong>sms</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52744624">C.1.26. <span class="command"><strong>test</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.track">C.1.27. <span class="command"><strong>track</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.tz">C.1.28. <span class="command"><strong>tz</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.ver">C.1.29. <span class="command"><strong>ver</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.vip">C.1.30. <span class="command"><strong>vip</strong></span></a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#appendix.database-commands">C.2. Database commands</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-deletelocations">C.2.1. <span class="command"><strong>db deletelocations</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-dist">C.2.2. <span class="command"><strong>db dist</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-export">C.2.3. <span class="command"><strong>db export</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-head">C.2.4. <span class="command"><strong>db head</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-lastloc">C.2.5. <span class="command"><strong>db lastloc</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-mailpos">C.2.6. <span class="command"><strong>db mailpos</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-mailgpx">C.2.7. <span class="command"><strong>db mailgpx</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-mailcsv">C.2.8. <span class="command"><strong>db mailcsv</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52935440">C.2.9. <span class="command"><strong>db size</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52938368">C.2.10. <span class="command"><strong>db sort</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.db-tail">C.2.11. <span class="command"><strong>db tail</strong></span></a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52953024">C.3. Preset commands</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52954720">C.3.1. <span class="command"><strong>preset list</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52958144">C.3.2. <span class="command"><strong>preset refresh</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52961168">C.3.3. <span class="command"><strong>preset use</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52964592">C.3.4. <span class="command"><strong>preset help</strong></span></a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.server-commands">C.4. Server commands</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.address-toggle">C.4.1. <span class="command"><strong>.lookup</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.cachestat">C.4.2. <span class="command"><strong>.cachestat</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.date">C.4.3. <span class="command"><strong>.date</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.help">C.4.4. <span class="command"><strong>help</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.help-command">C.4.5. <span class="command"><strong>help &lt;command&gt;</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-ver">C.4.6. <span class="command"><strong>.ver</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-lc">C.4.7. <span class="command"><strong>.lc</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-ld">C.4.8. <span class="command"><strong>.ld</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-ln">C.4.9. <span class="command"><strong>.ln</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp53035776">C.4.10. <span class="command"><strong>.dn</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-nick">C.4.11. <span class="command"><strong>.nick</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-table">C.4.12. <span class="command"><strong>.table</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-target">C.4.13. <span class="command"><strong>.target</strong></span></a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#cmd.srv-usb">C.4.14. <span class="command"><strong>.usb</strong></span></a></span></dt></dl></dd></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.technical">Appendix D. Technical information</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51523824">D.1. Documentation format</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51517648">D.2. The database schema</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.internal-export-format">D.3. The internal <acronym class="acronym">XML</acronym> export format
            grammar</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51632208">D.4. Configuring the daemon to generate a stack-trace</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51392928">D.5. Configuring for a simulated device</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp51395952">D.6. Protocol description</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52403312">D.7. Internal architecture</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52405472">D.7.1. Coding standards</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52289040">D.7.2. Compilation</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52294848">D.7.3. Organization of the source code</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52268112">D.7.4. Thread model</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52280240">D.7.5. A note on command line parsing</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52107616">D.7.6. Supporting libraries included</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#section.build-system">D.7.7. The build system</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp53088112">D.7.8. A note on build number</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp53094864">D.7.9. Generating a release</a></span></dt></dl></dd></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.references">Appendix E. References</a></span></dt><dd><dl><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52346720">E.1. Major SW technologies and tools used</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52175040">E.2. XML standards referenced and tools used</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="section"><a href="#idp52177056">E.3. Miscellaneous standards referenced</a></span></dt></dl></dd><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.news">Appendix F. Detailed release history</a></span></dt><dt><span xmlns:d="http://docbook.org/ns/docbook" class="appendix"><a href="#appendix.backlog">Appendix G. Backlog</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp50519936"></a>1 Preface</h2></div></div></div><p>This is a short guide through a particular software that interacts with a technology that
        almost seamlessly has seeped in to our daily life in a way that very few could have
        predicted even just ten years ago. Satellite position technology is probably one of the most
        sophisticated and advanced technologies in common use today. It builds on a theoretical
        framework so complex that there is no single person that knows all the necessary technology
        in its entirety. The particulars are head spinning even for those of us that claim technical
        expertise in small parts of the system. Yet, this human feat of science and engineering is
        in use by ten-year old´s to find there friends or by their parents making sure the kids is
        safely home after school. A truly remarkable achievement but not without risks as we shall
        see later on.</p><p>As a child I remember seeing a movie where the hero was chasing the bad guys from a
        distance by looking at a blinking dot on green phosphorous screen (although I didn't know it
        was phosphor at the time) and I was entirely convinced that such technologies were in the
        hands of the "spy world". Unfortunately that was not true, it was only film-magic. The
        technology available at that time (even for spies!) did not make such a device practically
        possible. The only distant positioning technology at that time was through
        radio-triangulation (or radar) like what was later used and in fact enforced by commercial
        shipping, the Decca system, which was eventually shut down in the early 2000. </p><p>It is only in the last couple of years that such - once film-only-magic technology - has
        become available as a consumer product by combining different technology strands into one
        unit. In fact a modern GPS tracking device is the successful merge of three major technology
        tracks. The satellite navigational system, the digital radio communication (made financially
        possible by the mobile phone explosion) and the internet and its use of a packet switching
        network based on the TCP/IP protocol stack. The development of these three technology tracks
        together with its supporting technologies has literally made use of much of the science and
        engineering progress made in the last three hundred years. Specialist mathematical areas
        like Galois theory and BCH error correcting code made reliable communication possible, the
        relativity theory told us how to compensate when talking to satellites, chemical and
        physical engineering pioneered in the 19:th century made it possible to construct everything
        from batteries to rocket fuel and more. </p><p>Most people do not think about such thing when checking Google Maps for how to find that
        special café in Paris which their favourite magazine recommended (only to discover that they
        were not the only one reading that recommendation). Neither should they, but I cannot
        personally help wonder how it comes that those of us working in research and science have
        done such an utterly poor job of marketing. Asking any person on the main street over the
        age of thirty it is a very high probability that he or she has heard of people like
        Hemingway, Jean-Paul Sartre, Doris Lessing, Lord Byron, Edgar Allan Poe, Yates and other
        humanists and writers even if he or she has never read anything by these authors.</p><p>However, if asking the same question but replacing the names with the likes such as Sophus
        Lie, Niels-Henrik Abel, Emmy Noether, Alexis Hocquenghem, Leonard Euler, Carl F. Gauss or
        Dennis Ritchie very few (if any) have ever heard of them. One of the few exceptions is A.
        Einstein but then mostly as a caricature of a an absent-minded old professor in gray hair. </p><p>I find this asymmetry sad. </p><p>While Hemingway without doubt wrote some great books he has not had the impact on the
        everyday life of people in any way that comes even close to the way the latter names have
        had (without most people knowing it). </p><p>Coming back to GPS technology and its rapid commoditization actually poses a risk that few
        people are fully aware of. The rapid fall in cost (after the GPS system was released to the
        civil market by the US military - but only after congress threatened to kill of the entire
        program due to cost) has tempted many manufacturer to replace older proven technology with
        cheap mass-market GPS receivers in places not easily guessed. So was the fact for example
        when the British navy commissioned a ship that specifically should be fully functional with
        no GPS. During the tests when the GPS signal was jammed their sonar suddenly stopped
        working. It turned out that the manufacturer of the sonar equipment had made use of a GPS
        receiver inside the sonar (which nobody had thought of) since it was so cheap that they
        practically got it for free. </p><p>It is therefore worth giving some thoughts about the risk of satellite communication and
        the dependency we as a society in a very short time has built up on this technology. Even
        though getting the wrong position from an alarm in your stolen car is not helpful it is
        unlikely to be a life and death situation either. However, a false position for an airplane
        in mid-air flight can cause some fairly interesting situations most people want to avoid. </p><p>What you first realize looking a bit deeper into satellite navigation is that this is a
        scaringly fragile technology. With equipment that can (almost) be purchased at the closest
        Wall-Mart for the cost of a better dinner you can interfere with equipment worth billions of
        dollars. The current GPS system was never truly designed to be a technology able to robustly
        run the world to the extent we now have come to rely on as the following two recent stories
        illustrates.</p><p>In 2011 Newark airport in the USA experienced sporadic problem with their GPS system to
        the extent that it was forced to divert airplanes to other airports or put them in long
        holding positions until the airports GPS system was back online (and double checked). The
        technicians and the manufacture spent months of trying to pinpoint the problem without
        success. The problem was randomly occurring and no pattern could be discovered. As the
        suspicion of sabotage grew the police was contacted and a massive surveillance operation was
        put in place to discover any outside influence of the airport system. The problem continued
        but no unauthorized personal was discovered. As a last resort the team set up cameras on the
        highway outside the airport and started filming all cars driving there. After a couple of
        months with some more disturbances the police started a painfully detailed analysis of the
        films in the hope of detecting some patterns correlating with the disturbances.</p><p>The pattern was found. With the films it was clear that a specific truck had been driving
        close to the airport every time the GPS signal was lost. The police concluded that this was
        deliberate sabotage and set up a massive operation to intercept the presumed terrorist(s).
        After some time the same truck was spotted and the truck was forced to stop and the driver
        immediately detained (with some mild persuasion we can assume).</p><p>So what had happened, was this in fact the work of domestic terrorists? No, not at all 
        that exciting, the truth was much more mundane. 
        The driver was working for a company that had put in GPS
        tracking devices in all its trucks. Furthermore the drivers were told not to drive there
        trucks home and keep to recommended routes and speeds. This particular driver did not like
        that policy and that the owners wold be able to see exactly how and where he had been driving and as a
        result he had purchased a $99.99 GPS jammer so he could drive his truck without the company
        knowing exactly where and when. Without him knowing it the jammer was more powerful than he
        realized so that whenever he was in the vicinity of the airport the jammer also interfered
        with the highly sensitive equipment in the airport. </p><p>In this story the driver obviously had no malicious intent towards the airport and he was
        later released. However that is not always the case.</p><p>The airport in Soul - South Korea - did experience problem with the traffic systems GPS in
        april-may 2012. Investigations (and satellite surveillance) concluded that directed GPS
        antennas had been constructed in North Korea in the Kaesong area (only ~10km from the
        border). The construction had no other discernible purpose than to interfere with the GPS in
        the airport in Soul. This is black mail on large scale and there is absolutely nothing
        (legally) to do about it. </p><p>So even if the GPS tracker makes for a great anti-theft device for the average "joy-rider"
        you should probably not just yet throw away your lock and key. It might still be a good idea
        to teach our kids how to use a map &amp; compass and not just trust that Google maps will
        always be available (or accurate)!</p><p>  </p><p><span class="bold"><strong>Happy tracking!</strong></span></p><p>Johan Persson</p><p>@ <span class="italic">N 59.655070, E 14.867005</span></p><p>August 2014</p><p><span class="italic">(Third printing may 2015)</span></p><p> </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50562272"></a>1.1 Acknowledgement</h3></div></div></div><p>I would like to express my gratitude to <span class="bold"><strong>GPSER Sweden
                AB</strong></span> (<a class="link" href="http://gpser.se/" target="_top">http://gpser.se/</a>) who
            provided the details of the GM7 communication protocol without this project would not
            have been possible.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="appendix.release-history"></a>2 Overview - Release history and roadmap</h2></div></div></div><p>For a more detailed functional description of past and future releases please see <a class="xref" href="#appendix.backlog" title="Appendix G - Backlog">Appendix G</a>.  </p><p>
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Version numbers indicate magnitude of change and compatibility as follows:</p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">x.y.z -&gt; x.y.(z+1)</code></p><p><span class="bold"><strong>Maintenance release</strong></span> (defect or
                            optimization fixes). No change in public interface, feature set or
                            file/DB formats or locations. Safe upgrade without user
                            intervention.</p></li><li class="listitem"><p><code class="literal">x.y.z -&gt; x.(y+1).z</code></p><p><span class="bold"><strong>New functionality.</strong></span> API compatibility
                            maintained. Safe upgrade but user might need to learn new functionality
                            to take advantage of release. Limited changes in DB/File format as well
                            as configuration file is possible.</p></li><li class="listitem"><p><code class="literal">x.y.z -&gt; (x+1).y.z</code></p><p><span class="bold"><strong>Major new functionality.</strong></span> API
                            compatibility is not guaranteed. Any type of changes in external API,
                            file or DB format. May require a complete upgrade of config file and
                            existing DBs.</p></li></ul></div><p>
            </p></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50478496"></a>2.1 Major Public Releases</h3></div></div></div><p>Only rmajor new functionality is listed here.For a complete list see the NEWS file 
            (<a class="xref" href="#appendix.news" title="Appendix F - Detailed release history">Appendix F</a>)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">v3.2.0 (May 2015)</span></dt><dd><p>Adds option to include miniature maps in the various event mails that shows
                        the location. Also introduces throttling of Google API call to avoid hitting
                        the rate ceiling for anonymous call to Google. A notification mail is now
                        sent when the 24 hour limit has been reached and further lookups are
                        disabled until the 24 time period has expired, the daemon restarted or the
                        ".ratereset" command given. Some Improvements in handling of
                            <acronym class="acronym">UTF8</acronym> characters have been added and pretty-printing
                        of tabled output introduced (see the ".table" command, <a class="xref" href="#cmd.srv-table" title="C.4.12 .table">.table</a>). A few more DB commands (db head, db tail)
                        and some minor bug fixes. Configuration file modified by adding possibility
                        to set a Google API key and moved the port settings to the "startup"
                        section. Improvements of the <span class="command"><strong>dlrec</strong></span> command and some
                        general documentation updates. Security audit for string routines and a
                        complete Coverity check. The communication with command shell was improved
                        to be able to send larger amount of data without truncation.</p></dd><dt><span class="term">v3.1.0 (Mar 2015)</span></dt><dd><p>Make it possible to connect multiple devices and select which one to
                        direct commands to. This release also makes it possible for each connected
                        command client to individually select which device to direct commands to.
                        One more highlight is the possibility to enter non-interactive commands via
                        the newly introduce "@@" command (See <a class="xref" href="#sec.direct-device-commands" title="8.1.1 Non-Interactive device commands - the @@CMD(arg1, ...) format">Section 8.1.1</a>)</p></dd><dt><span class="term">v3.0.0 (Jan 2015)</span></dt><dd><p>Changed location of all data files to fully adhere to FHS (File
                        Hierarchical Standard). Added several command line options for starting the
                        daemon. Several internal changes in how the processes and locking is
                        handled. Changed configuration file content. Some minor bug fixes.</p></dd><dt><span class="term">v2.2.0 (Sep 2014)</span></dt><dd><p>Added reverse Geo-location address lookup to map coordinates to approximate
                        street addresses. In addition this release adds improved support for Apple
                        OS X as well as more robust USB connection handling. The build system for
                        documentation was also overhauled to improve documentation build capability
                        on most common Linux variants as well as Apple OS X. The DB schema was also
                        slightly updated to include the approx street address. In addition some
                        minor defect fixes has been included as well as a security scan of the
                        source base using coverity static code analysis.</p></dd><dt><span class="term">v2.1.0 (Mar 2014)</span></dt><dd><p>This version adds full support for communication to the device over
                            <acronym class="acronym">GPRS</acronym> as well as a number of internal improvements and
                        documentation updates.</p></dd><dt><span class="term">v2.0.1 (Jan 2014)</span></dt><dd><p>Major DB schema improvements to increase download speed of stored location
                        on device. Added registering of devices and giving them nick-names, commands
                        for handling geo-fencing and geo-location events was added.
                            <acronym class="acronym">GPX</acronym> export improved with support for identifying
                        tracks. On the server side it is now possible to list more information about
                        connected clients. The command shell was updated with improved handling of
                        long running commands (like location download). Documentation update and
                        some minor defect fixes for corner cases. </p></dd><dt><span class="term">v1.0.1 (Jan 2014)</span></dt><dd><p>First public release</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50639616"></a>2.2 High level roadmap</h3></div></div></div><p>In general the daemon is expected to initially have three to four public releases per
            year. However as it is also expected that as the product matures the updates will become
            less frequent. If critical issues with security implications are found then intermediate
            maintenance releases will issued. The daemon is considered stable with all planned
            features implemented. Future devlopment will primarily focus on making it easier to
            connect to the daemon from third party clients such as new Web clients or mobil
            clients</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">v4.0.0 (TBD NON Committed)</span></dt><dd><p>Add a Web services interface and JSON response to allow easy connection
                        from web- and mobile clients. Most likely this will technically designed
                        with a bundled HTTP server (albeit running as a separate process) to reduce
                        the need to configure an external web-server to talk to the daemon.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50643680"></a>2.3 Upgrading to 3.2.0 from previous versions</h3></div></div></div><p><span class="bold"><strong>From 3.x.y</strong></span></p><p>The configuration file should be refreshed from the distribution. Then it is safe to
            only replace the binaries since there is no change in data formats in any other files or
            change in file locations.</p><p><span class="bold"><strong>From version 2.x.y and earlier</strong></span></p><p>Due to the change in config files as well as locations of data files any older
            versions needs to be completely uninstalled before attempting to install this
            version.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.introduction"></a>3 Introduction</h2></div></div></div><p>This software is meant to be used together with the <span class="productname">Xtreme GM7</span>
        <acronym class="acronym">GPS</acronym> tracker to help simplify its management and to make it possible to
        monitor alerts sent by the tracker. </p><p>The software is intended to be run as a <span class="productname">GNU/Linux</span> service
        (a.k.a. a daemon) that always runs in the background. The server has a small footprint and
        makes very little use of system resources. It should therefore be possible to run the daemon
        unnoticed and on virtually any <span class="productname">GNU/Linux</span> systems.</p><p>In the rest of the manual we will often refer to the software as "the daemon". The
        application name for the daemon is "<span class="application">g7ctrl</span>"</p><p>
        </p><div class="figure"><a name="fig.gm7_tracker"></a><div class="figure-contents"><div class="mediaobject"><img src="gm7_tracker_small.jpg" width="400" alt="The GM7 Tracker"></div></div><p class="formal-object-title"><span class="label">Figure 1: </span><span class="title">The GM7 Tracker</span></p></div><p><br class="figure-break">
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50620912"></a>3.1 Typographic conventions used in the manual</h3></div></div></div><p>The manual is consistently formatted to help differentiate the semantic meaning of the
            text as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Terminal text input/output. Example:</p><p>
                    </p><pre class="screen">g7ctrl&gt; command-line</pre><p>
                </p></li><li class="listitem"><p>File- or directory name. Example:</p><p><code class="filename">/usr/bin/g7ctrl</code></p></li><li class="listitem"><p>File listing. Example:</p><p>
                    </p><pre class="programlisting"># This is the first line in the file
# and this is the second line</pre><p>
                </p></li><li class="listitem"><p>Literal text: Example:</p><p><code class="literal">SIGHUP</code></p></li><li class="listitem"><p>Acronym. Example</p><p><acronym class="acronym">SMTP</acronym></p></li><li class="listitem"><p>Inline code. Example:</p><p><code class="code">main(int argc, char **argv)</code></p></li><li class="listitem"><p>Command. Example</p><p><span class="command"><strong>useradd</strong></span></p></li><li class="listitem"><p>Product name. Example</p><p><span class="productname">Xtreme GM7</span>
                </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50697792"></a>3.2 Why would you want this software?</h3></div></div></div><p>While it is possible to manage the <span class="productname">GM7 GPS Tracker</span>
            (commonly referred to as "the device" in this manual) through the means of sending phone
            text messages this is often awkward since it requires the user to remember specific
            commands and the corresponding arguments. At best this is a complex and tedious way to
            control the device. In addition there is also a cost associated for sending each text
            messages both in the sending phone and for the <acronym class="acronym">SIM</acronym> subscription in
            the device since the tracker will normally will send back a reply. Even when the cost in
            itself is not of concern the risk of emptying the device <acronym class="acronym">SIM</acronym> account
            increases and Murphy's law will guarantee that the <acronym class="acronym">SIM</acronym> will be empty
            when it is the most needed.</p><p>An alternative method of control is to connect the device via a <acronym class="acronym">USB</acronym>
            cable to a computer and send control instructions that way. This way the device can be
            set up in the wanted way and then be used, for example, as an alarm. This software will
            help to set up such a connection and allow the user to send command in meaningful
            English with a clear question/response based command language that do not require the
            user to remember an awkward syntax or the order of arguments. The drawback of this
            method is obviously - the device needs to be in physical proximity of a controlling
            computer.</p><p>To simplify command handling it is possible to group commands together and give them a
            meaningful name as a user defined function. This could for example be used to set up a
            device to enable <acronym class="acronym">GPRS</acronym> and start tracking using
                <acronym class="acronym">TCP/IP</acronym> back to the server when the device is moved or disturbed
            with a single command and not having to remember any details or arguments. This is
            described in more detail in the section on presets (see <a class="xref" href="#section.using-presets" title="8.3 Using presets">Section 8.3</a>)</p><p>The software can further more act as a recipient of location updates from the device
            (when it is put in tracking mode) sent over a <acronym class="acronym">GPRS</acronym> link. Each
            location update is stored in a database which later on can be queried or exported in a
            number of different formats and can for example be shown on Google maps or similar
            programs (see <a class="xref" href="#cmd.db-export" title="C.2.3 db export">db export</a>).</p><p>The location points can also be used to calculate the approximate distance travelled
            over any given time or show all locations where a given speed is exceeded (see <a class="xref" href="#cmd.db-dist" title="C.2.2 db dist">db dist</a>).</p><p>One requirement to enable the device to send back location updates is of course that
            the device can contact the server. This will require the server to be accessible from
            the internet, and hence its IP address must be known.</p><p>In a professional setting this is in general not a problem since most likely the ISP
            subscription is such that a professional server is assigned a static
                <acronym class="acronym">IP</acronym> address that will remain fixed.</p><p>However, most home user connect to the internet via a router/access point provided by
            their <acronym class="acronym">ISP</acronym> and this access point most often have a dynamic
                <code class="literal">IP</code> address. This means that the <acronym class="acronym">ISP</acronym> can and
            will change this address at will (even though in practice, the assigned address tends to
            stay the same for long period of times). Therefore it is not possible to store this
            address once in the device and always count on it to work. The best way to solve this is
            to register with a dynamic domain name server (<acronym class="acronym">DDNS</acronym>) which keeps
            track on your assigned <acronym class="acronym">IP</acronym> address. The device will then use the
                <acronym class="acronym">DDNS</acronym> name assigned by the <acronym class="acronym">DDNS</acronym> service and
            will get the corresponding <acronym class="acronym">IP</acronym> address. </p><p>It is out of the scope of this manual to give instructions on how to register your
            server (or more correctly your access point/router) with a <acronym class="acronym">DDNS</acronym>
            service (there are both free and subscription based alternatives). Many routers/access
            points also has built-in support to automatically update a specified
                <acronym class="acronym">DDNS</acronym> service when their IP address changes. </p><p>Please remember though that connecting to this address only gets as far as the access
            point. If you have one or more computers that uses that access point you need to
            forwarded the connection to a specific server where you have the daemon installed. How
            to do this is dependent on the particular router/access point you are using but most
            likely it will be found under a menu named something like "<span class="italic">Port
                forwarding</span>". There you need to instruct the access point/router to
            forward packets arriving on port <code class="literal">3400</code> to your server. This is the
            default port number used by the daemon to receive location updates from the device (the
            port number used is also configurable, see <a class="xref" href="#appendix.configuring-the-daemon" title="Appendix A - Configuring the daemon">Appendix A</a>)</p><p>One key usage of the tracker is to act as a an alarm for all kinds of vehicle and
            large equipment. When the alarm conditions (specified by the user) are met the device
            will normally send a text message to one or more predefined phone numbers and can also
            have been setup to send a message over a <acronym class="acronym">GPRS</acronym> link. In order to
            increase the chances that the alarm reaches the user the daemon can be set up to also
            send a mail on such event to one ore more predefined mail addresses. </p><p>The daemon can also be setup to execute user specified action when it receives a
            specific alarm from the tracking device. This could for example be used to give
            audio/visual indication that an alarm has been triggered. </p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>An easy way to give visual indication of alarm is to purchase a
                        <acronym class="acronym">USB</acronym> controlled warning light (such as <a class="link" href="http://www.delcomproducts.com/productdetails.asp?ProductNum=890604" target="_top">http://www.delcomproducts.com/productdetails.asp?ProductNum=890604</a>) and use a small event script to control this light.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50775536"></a>3.3 Who can use this software?</h3></div></div></div><p>In principal anyone - once the daemon has been installed and configured. We should
            however differentiate between the two roles of the <span class="italic">administrator</span> (the person installing and configuring the software) and
            the <span class="italic">end user</span> (who uses the configured software to
            communicate with the device).</p><p><span class="bold"><strong>The role of the administrator.</strong></span></p><p>Configuring and using a <acronym class="acronym">GPS</acronym> tracker requires, almost by definition,
            a certain technical maturity and the same goes with this control daemon. It is a medium
            complex piece of software that requires the person installing and configuring the
            software to be familiar with concepts such as terminal usage, <acronym class="acronym">TCP/IP</acronym>
            ports, <acronym class="acronym">GPRS</acronym> configuration, file handling and mail setup (specifying
            an outgoing <acronym class="acronym">SMTP</acronym> server). </p><p>Unfortunately this can seem like a daunting task at first and unfortunately the
            software can only do so much automatically since it cannot know the
                <acronym class="acronym">ISP</acronym> or what <acronym class="acronym">SIM</acronym> card is used in the device are
            using or the necessary <acronym class="acronym">SMTP</acronym> setup. Nevertheless, the daemon comes
            with a reasonable default configuration that tries to make the setup process as easy as
            possible given the overall complexity and clearly indicate the data that must be
            updated.</p><p>An administrator should specifically shield the end user as much as possible from the
            technical details which for example can be done by providing a good set of defined
                <span class="italic">presets</span> (see <a class="xref" href="#section.using-presets" title="8.3 Using presets">Section 8.3</a>)</p><p><span class="bold"><strong>The role of the end user.</strong></span></p><p>An end user will most likely only ever make use of the command line interface
                (<span class="command"><strong>g7sh</strong></span>) to send and receive data from the device. He or she
            therefor needs to be aware of the available commands as summarized in <a class="xref" href="#appendix.command-reference" title="Appendix C - Command reference">Appendix C</a> (eventually the daemon will also
            incorporate a WEB-based UI).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50788432"></a>3.4 Available documentation</h3></div></div></div><p>The distribution comes with the following documentation</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="emphasis"><em>Software Manual.</em></span> The document you are currently
                    reading, contains both end user and administrator information.</p></li><li class="listitem"><p>A Unix man page for the daemon "<code class="literal">man g7ctrl</code>". This is
                    installed together with the daemon.</p></li><li class="listitem"><p>A Unix man page for the command shell "<code class="literal">man g7sh</code>". This is
                    installed together with the daemon.</p></li></ul></div><p>In addition to this end user documentation there are developer documentation in the
            source tree at appropriate locations such as schema description of the database and
            various <code class="filename">README</code> files. For developers the repository also contains a
            set of <span class="command"><strong>Doxygen</strong></span> generated documentation for the source (this is
            however not included in the distributed <acronym class="acronym">tar</acronym>-ball since it is of no
            use to an end user).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50796688"></a>3.5 Summary of functionality</h3></div></div></div><p>Below is a high level overview of what functionality this software offers. A more
            detailed description of all commands and functionality is available in the command
            reference section (see <a class="xref" href="#appendix.command-reference" title="Appendix C - Command reference">Appendix C</a>).</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Handle communication with the device over a <acronym class="acronym">USB</acronym> cable
                        to both control and query the device. The commands set supports the complete
                        internal command set understood by the device.</p></li><li class="listitem"><p>Act as a control center that receives automatic location updates from the
                        device and stores them in a database. To have this functionality the device
                        must first be setup to send data over a <acronym class="acronym">GPRS</acronym> connection
                        to the server.</p></li><li class="listitem"><p>Control the device over <acronym class="acronym">TCP/IP</acronym> when the device has an
                        active <acronym class="acronym">GPRS</acronym> connection. This allows controlling the
                        device remotely without having to use text messages. This can also allow
                        predefined actions to be performed on the device when certain events
                        occur.</p></li><li class="listitem"><p>Exporting the stored location data to several popular geo-location file
                        exchange formats such as <acronym class="acronym">GPX</acronym> (<acronym class="acronym">GPS</acronym>
                        Exchange Format) or <acronym class="acronym">KML</acronym> (used by Google Earth).</p></li><li class="listitem"><p>Calculate the traveled distance for a set of locations.</p></li><li class="listitem"><p>The control center can send mails to one or more predefined addresses one
                        certain events such as alarms or notifications.</p></li><li class="listitem"><p>Send mail with attachment of exported (and compressed) track data. This
                        makes it easy to immediately gain access to tracked location even if the
                        server will not allow outside access to read an exported file.</p></li><li class="listitem"><p>Get regular mail updates on the status and location of the tracker</p></li><li class="listitem"><p>The ability to execute user specified functions on defined events received
                        from the device</p></li><li class="listitem"><p>Remote access to the daemon over a <acronym class="acronym">TCP/IP</acronym> link. This
                        could allow an administrator to configure a device remotely for a co-worker
                        with no detailed technical knowledge of the device using the full
                        functionality of the software.</p></li><li class="listitem"><p>Setup predefined command sets to control the device</p></li><li class="listitem"><p>Ability to run user defined scripts as reaction to received tracker event
                        such as alarms which for example could be made to have the computer sound an
                        audible alarm.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.known-defects"></a>3.6 Limitations and known defects in 3.x series</h3></div></div></div><p>This lists known omissions and limitations in the current version. Some limitations
            might be lifted in future versions of the software.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Dates are always specified in European format: </p><p><code class="literal">YYYY-MM-DD HH:MM:SS</code></p></div><p>
        </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp50819024"></a>3.6.1 Minor limitations</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The daemon always assume PIN code on device is
                        "<code class="literal">0000</code>"</p></li><li class="listitem"><p>The daemon only supports <acronym class="acronym">TCP/IP</acronym> connections from the
                        device and not <acronym class="acronym">UDP</acronym>. In practice this is no limitation but
                        should be mentioned for completeness.</p></li><li class="listitem"><p>Live tracking of location event over <acronym class="acronym">USB</acronym> is not
                        supported and there are no plans to support this use case. Tracking must be
                        done either to the server (over <acronym class="acronym">GPRS TCP/IP</acronym>) or logged to
                        the device internal memory and then be downloaded over
                            <acronym class="acronym">USB</acronym>. See <a class="xref" href="#cmd.dlrec" title="C.1.6 dlrec">Section C.1.6</a></p></li><li class="listitem"><p>The included shell (<span class="command"><strong>g7sh</strong></span>) for managing the daemon has a
                        buffer limit on 1MB of data to be received from the daemon. The only use
                        case when this is a limit in practice is for a user needing to do a
                            "<span class="command"><strong>db head</strong></span>" (or "<span class="command"><strong>db tail</strong></span>") and
                        display more than around 10,000 rows from the DB.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp50829168"></a>3.6.2 OSX limitations</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Applies only to OSX builds:</p><p>OSX does no longer ship with <acronym class="acronym">GNU</acronym>
                        <span class="command"><strong>readline</strong></span> but with <acronym class="acronym">BSD</acronym>
                        <span class="command"><strong>libread</strong></span> (for licensing reason). Unfortunately the
                        replacement library has (very) limited functionality compared to the
                        "original" and gives a poor working line editing experience. For full
                        functionality on OSX for the command shell please install the
                            <acronym class="acronym">GNU</acronym> readline library. An easy way of doing this is to
                        use the "<span class="italic">Homebrew</span>" system (see <a class="link" href="http://brew.sh" target="_top">http://brew.sh</a>) which is an easy way to install multiple
                        native UNIX utilities and libraries. The configure will assume that the
                            <acronym class="acronym">GNU</acronym>
                        <span class="command"><strong>readline</strong></span> library, if available, is installed to
                            "<code class="filename">/usr/local/opt/readline</code>".</p></li><li class="listitem"><p>Connecting a device over <acronym class="acronym">USB</acronym> should be considered an
                        experimental feature on <span class="productname">OSX</span>. The
                            <acronym class="acronym">USB</acronym> connection with devices can sometimes fail to be
                        established. So for working with <acronym class="acronym">USB</acronym> connected devices a
                        Linux system is strongly recommended since on Linux <acronym class="acronym">USB</acronym>
                        connections is both stable and reliable.</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50841008"></a>3.7 Software License</h3></div></div></div><p>The software is copyright 2014-2015 Johan Persson and released under the GPL 3 license
            to ensure the full distribution and freedom (as in free speech - not as in free beer) .
            See <a class="link" href="http://www.gnu.org/licenses/" target="_top">http://www.gnu.org/licenses/</a>
            for more information.</p><p>
            </p><pre class="programlisting">This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</pre><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.installing"></a>4 Installing</h2></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>There are pre-built binary packages for <span class="productname">OpenSuSE</span> 12.1 -
            13.1 (both in <acronym class="acronym">RPM</acronym> and <span class="italic">One-Click-Install</span>) available from <a class="link" href="http://software.opensuse.org/download.html?project=home%3Ajohanp_aditus&amp;package=g7ctrl" target="_top">http://software.opensuse.org/download.html?project=home%3Ajohanp_aditus&amp;package=g7ctrl</a></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50629408"></a>4.1 System requirements</h3></div></div></div><p>The software is designed to work on a <acronym class="acronym">GNU</acronym> Linux derived system. It has been built and
            verified on the following systems and versions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="productname">OpenSuSE</span> 12.3, 13.1</p></li><li class="listitem"><p><span class="productname">Linux Mint</span> r15, r16, r17</p></li><li class="listitem"><p><span class="italic">OS X Maverick 10.9</span> (Experimental support
                    only - <span class="command"><strong>g7sh</strong></span> has limitations and requires
                        <acronym class="acronym">GNU</acronym> readline for full functionality, see <a class="xref" href="#section.known-defects" title="3.6 Limitations and known defects in 3.x series">Section 3.6</a>)</p></li></ul></div><p>The daemon will specifically <span class="bold"><strong>not</strong></span> run on any variant
            of MS Windows nor will it ever be ported by the author to any variants thereof.</p><p>Even though the daemon is only tested on these versions it will most likely build fine
            on most recent <acronym class="acronym">GNU</acronym> Linux distributions. It does not make use of any
            special code, tricks or requires special libraries. In order to compile the software a
            supported C compiler must be used. As of version 2.0 the following compilers are
            officially supported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="command"><strong>gcc</strong></span>,v4.6.x,  v4.7.x &amp; v4.8.x</p></li><li class="listitem"><p><span class="command"><strong>clang</strong></span>, v3.2</p></li></ul></div><p>In addition the daemon need three utility libraries to build. The build configuration
            will check for those libraries and if they are not found an error message is shown on
            exactly what library is missing. For current version of the daemon the following
            external libraries are needed for a successful compilation.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">libpcre3</code></p></li><li class="listitem"><p><code class="literal">libsqlite3</code></p></li><li class="listitem"><p><code class="literal">libxml2</code></p></li></ul></div><p>In addition, if your system has <code class="literal">libiniparser</code> library the build will
            also use it and if it is not available a built-in version will be used. In order to
            compile with the needed libraries the development version of each library (usually named
            with a "<code class="literal">-devel</code>" or "<code class="literal">-dev</code>" suffix) must be
            installed.</p><p>
            </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Please make sure that the Tracker firmware is <span class="bold"><strong>M7 2.007
                        GP rev00c</strong></span> or later. With the daemon installed and the device
                    connected you can easily verify this using the command <span class="command"><strong>get
                        ver</strong></span></p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50667312"></a>4.2 Building and installing</h3></div></div></div><p>Even though the process of installing the daemon ideally is as simple as typing three
            commands it is inevitable that different systems and variants behave differently and it
            is impossible to test the software build on all possible configurations "in the wild".
            While the software is configured to handle most system differences automatically there
            will always be corner cases that will require some minor adjustments to get the software
            working on that particular system. Unfortunately that requires a bit of
            experience.</p><p>It will be helpful if you previously experience running <span class="command"><strong>configure</strong></span> and
                <span class="command"><strong>make</strong></span>. The commands</p><p>
        </p><pre class="screen">&gt; ./configure &amp;&amp; make
sudo make install</pre><p>
    </p><p>is a standard way of compiling and installing Unix/<acronym class="acronym">GNU</acronym> Linux software
            based on the <acronym class="acronym">GNU</acronym>
            <span class="italic">Automake</span> tool chain (which is a fantastic piece of
            canned black magic and years of experience). With default configuration the daemon will
            be installed in <code class="filename">/usr/bin</code> and the configuration directory will be
            set to <code class="filename">/etc/g7ctrl</code>. If you would like to install the daemon in
            other places, for example under <code class="filename">/usr/local/bin</code>, then configure the
            daemon using the <code class="literal">--prefix</code> argument as</p><p>
        </p><pre class="screen">&gt; ./configure --prefix=/usr/local &amp;&amp; make
sudo make install</pre><p>
    </p><p>If you are not comfortable with this process or have never done this before it is
            recommended for you to use a pre-compiled package for your particular system. </p><p> 
        </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>If a package does not yet exist for your system please consider requesting a
                package to be provided from the people responsible for your distribution.</p></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50678496"></a>4.3 Installing the daemon as a systemd service</h3></div></div></div><p>For technical reason having to do with the way the autotools work the  installation
            does not enable the daemon as a service.  If you want to have the daemon run as a
                <code class="literal">systemd</code> service execute the following line after you have done
            the standard <code class="literal">make install</code> (still as root)</p><p>
            </p><pre class="screen">&gt; systemctl enable g7ctrl.service</pre><p>
        </p><p>This will enable the <span class="command"><strong>g7ctrl</strong></span> service with <code class="literal">systemd</code>
            in multi-user mode. </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50888080"></a>4.4 Rebuilding the documentation</h3></div></div></div><p>The distribution comes with pre-rendered versions of all documentation in both plain
            text, <acronym class="acronym">HTML</acronym> and <acronym class="acronym">PDF</acronym> format. </p><p>The documentation is written using the <span class="italic">Docbook 5
                XML</span> schema which is a very good way to build multi-mode documentation.
            However, rebuilding the documentation (perhaps you want to add some section or have
            found one or more spelling mistakes that irritates you) requires a fully working Docbook
            5 environment. </p><p>While this is certainly possible <span class="italic">Docbook5</span> and
                <acronym class="acronym">XML</acronym> transformations might not be everyone’s coup of tea. if you
            are not used to the <acronym class="acronym">XML</acronym> transformation process it can be a certain
            learning step. The configuration process will investigate your system if it has the
            capability to render all or some of the output formats and state that information at the
            end after running the "<code class="filename">./configure</code>" script.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>An easy way to get a fully working <span class="italic">Docbook5</span>
                    setup is to check out the source directly from the repository and run the
                        <code class="filename">bootstrap.sh</code> script. This will re-create a full build
                    environment for the daemon. See <a class="xref" href="#section.build-environment" title="4.6 Setting up your own build environment - for developers">Section 4.6</a></p></div><p>
        </p><p> </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50898288"></a>4.5 Configuring and compiling the source using the distributed tarball</h3></div></div></div><p>Using the tar-ball installation is the recommended way for most end users (compared to
            getting the source directly from the repository) since the tar ball has pre-built
            configuration environment and pre-rendered documentation. After downloading the tarball
            (please use the latest version available at the time of download) it needs to be
            extracted to a temporary directory where it can be compiled. </p><p>Assuming you have downloaded version 3.0.0 the commands to extract the source is
            first</p><p>
            </p><pre class="screen">&gt; tar xzf g7ctrl-3.0.0.tar.gz</pre><p>
        </p><p>or if you downloaded the "<code class="literal">.xz</code>" version (which is in general smaller
            but requires the <span class="command"><strong>xz</strong></span>-compression program, which makes use of the more
            efficient <acronym class="acronym">LMZ2</acronym>)</p><p>
            </p><pre class="screen">&gt; tar xJf g7ctrl.3.0.0.tar.xz</pre><p>
        </p><p>In order to then configure and compile the sources (using default settings) do the
            following:</p><p>
            </p><pre class="screen">&gt; cd g7ctrl-3.0.0
./configure &amp;&amp; make -j8</pre><p>
        </p><p>(the <code class="literal">-j8</code> is strictly speaking not necessary but will speed up the
            compilation a bit through parallelization) If some of the necessary prerequisites are
            missing (like one of the required libraries) an error message will be given. Install the
            required library and run the commands again. Once the compilation process is done the
            daemon needs to be installed. This requires <code class="literal">root</code> privileges. To
            install the daemon do the following</p><p>
            </p><pre class="screen">&gt; sudo make install</pre><p>
        </p><p>By default the installation process will install the binary in
                <code class="filename">/usr/bin</code>, the configuration file in
                <code class="filename">/etc/g7ctrl</code> and the database in
                <code class="filename">/var/lib/g7ctrl</code>. The exact location can easily be changed by
            using the "<code class="literal">--prefix</code>" argument to "<code class="literal">configure</code>". For
            a complete list of options at configuration time please run </p><p>
            </p><pre class="screen">&gt; ./configure --help</pre><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.build-environment"></a>4.6 Setting up your own build environment - for developers</h3></div></div></div><p>If your are planning to do some development of your own or just want to follow the
            development of the daemon more closely than waiting for official releases you can set up
            your own local copy of the repository. However, this is only recommended for developers
            with previous experience with medium complex software. Specifically you need experience
            with the <span class="emphasis"><em>subversion</em></span>
            <acronym class="acronym">SCS</acronym> since that is what the repository uses.</p><p>To help setup a full build environment including the
                <span class="productname">Docbook5</span> environment with this there are two utility
            script in the <code class="filename">bldscripts</code> directory which when run will
            automatically set up a complete build environment including a working
                <span class="productname">Docbook5</span> environment. The two included bootstrap scripts
            are</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">bootstrap.sh</code></p><p>Used for RPM based system like OpenSuSE</p></li><li class="listitem"><p><code class="filename">bootstrap-deb.sh</code></p><p>Used for PKG based system such as Debian, Ubuntu or Linux Mint</p></li></ul></div><p>The bootstrap script are <span class="bold"><strong>only</strong></span> meant to be <span class="bold"><strong>run once</strong></span> after the initial checkout. </p><p>If you are on a <span class="productname">Debian</span> based system the following two steps
            are all that is needed to both checkout and setup a complete build system</p><p>
            </p><pre class="screen">&gt; svn co http://www.sourceforge.net/p/g7ctrl/trunk g7ctrl
&gt; cd g7ctrl
&gt; ./bldscripts/bootstrap<span class="bold"><strong>-deb</strong></span>.sh</pre><p>
        </p><p>and if you are on a <span class="productname">OpenSuSE</span> (<acronym class="acronym">RPM</acronym>) based
            system use the following steps</p><p>
            </p><pre class="screen">&gt; svn co http://www.sourceforge.net/p/g7ctrl/trunk g7ctrl
&gt; cd g7ctrl
&gt; sh ./bldscripts/bootstrap.sh</pre><p>
        </p><p>The bootstrap script will install all required pre-requisites including
                <acronym class="acronym">GNU</acronym>
            <span class="command"><strong>autoconfig</strong></span> and <span class="command"><strong>automake</strong></span> tools. If no errors were
            found you should see the following information on the screen.</p><p>
            </p><pre class="screen">Build environment is ready.

Now run autoreconf
You can now run "./stdbuild.sh" to build the daemon
and then then run "./mkrelease.sh" to create new releases.</pre><p>
        </p><p>Now run the <code class="filename">autoreconf</code> script in order to recreate the
                <acronym class="acronym">GNU</acronym> autotools setup. After that you can proceed as usual to build
            the source.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please note that you will not have the ability check in changes to the code
                    base by default. To get permission you need to show that you have a substantial
                    contribution and demonstrated clear knowledge at the level required to
                    comprehend the code base. If you believe you meet this requirement contact the
                    author via email stating your request. For more technical information on the
                    source tree please see <a class="xref" href="#appendix.technical" title="Appendix D - Technical information">Appendix D</a></p></div><p>
        </p><p>For development there are two additional configuration parameters that can be given to
            the configures process.</p><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--enable-simulate</code></span></dt><dd><p>This will allow the execution of commands even though a real device is
                            not connected. Note that if this is enabled the daemon will never be
                            able to communicate with a real device!</p></dd><dt><span class="term"><code class="literal">--enable-stacktrace</code></span></dt><dd><p>This will instrument the build so that in case of a
                                <code class="literal">SIGSEGV</code> (or <code class="literal">SIGABRT</code>,
                                <code class="literal">SIGBUS</code>) a limited stack trace will be written to
                                "<code class="filename">/tmp</code>" to facility debugging. It is also
                            recommended that the system is setup to allow for full core-dump in
                            order to help with the post-mortem debugging. The stack trace is however
                            useful to help analyze a fault at an end user where he/she can mail the
                            stack trace back to the developer for analyze. Ideally a watch daemon
                            should be added to the system that will watch the
                                <code class="filename">/tmp</code> directory for a stack trace and in that
                            case offer the end user to automatically mail the trace (and mini-dump)
                            back to the developer.</p><p>
                            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><code class="literal">--enable-stacktrace</code> is <span class="bold"><strong>not</strong></span> supported on OSX/Darwin due to
                                    reliance on specific <acronym class="acronym">GNU</acronym> Linux system
                                    libraries (stack-walking) and will give a configuration error if
                                    enabled on OSX.</p></div><p>
                        </p></dd></dl></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50946512"></a>4.7 Configuring the daemon</h3></div></div></div><p>After a successful installation the daemon needs to be configured. This is done by
            adjusting the configuration template file. The first step is to switch to root and then
            use the template provided to create an initial configuration file. Assuming the
            configuration file is installed in the default directory start by doing the
            following:</p><p>
            </p><pre class="screen">&gt; cd /etc/g7ctrl
&gt; sudo cp g7ctrl.conf.template g7ctrl.conf</pre><p>
        </p><p>The next step is to open the configuration file in your favourite editor and adjust a
            few settings in accordance with your preferences and system. There are very few settings
            that you absolutely have to adjust. Depending on your needs and setup you should as a
            minimum review the following settings:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>SMTP mail server.</strong></span>
                </p><p>If you intend to use the mail functionality of the daemon you need to state
                    the name of the <acronym class="acronym">SMTP</acronym> server and your credentials (user and
                    password)</p></li><li class="listitem"><p><span class="bold"><strong>Listening ports</strong></span></p><p>Reviewing what ports the daemon is listening on from command and device
                    connections. By default the daemon will listen on port <code class="literal">3100</code>
                    for commands and on port <code class="literal">3400</code> for incoming events from the
                    tracking device such as alarms and location updates. The ports can be any number
                    but it is recommended you keep the port range in the range
                        <code class="literal">[1025-9000]</code> unless you really know what you are
                    doing!</p></li><li class="listitem"><p><span class="bold"><strong>Connection password</strong></span></p><p>In order to make a command connection to the daemon password must normally be
                    given. By default the build process will create a random 6 letter password in
                    the configuration file. You might want to change this to better suit you
                    environment. If you only intend to have the daemon reachable from your local
                    computer network (and not have the command port open to the entire internet) you
                    might turn off the password to avoid having to type it whenever you want to
                    connect the daemon. </p><p>However, if you have the daemon accessible from the internet <span class="bold"><strong>you really, really should have it protected by a password
                    </strong></span>of minimum 8 characters in length. However since the communication is
                    done in plain text it is susceptible for line listening. For a secure
                    communication the command shell should be configured as a login shell so that
                    the communication can easily be done over a encrypted link, more details are
                    available in <a class="xref" href="#section.command-shell" title='6 The command shell - "g7sh"'>Section 6</a>.</p></li></ul></div><p> All settings in the configuration file is described in more details in <a class="xref" href="#appendix.configuring-the-daemon" title="Appendix A - Configuring the daemon">Appendix A</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.running-the-daemon"></a>5 Running the daemon</h2></div></div></div><p>Once installed it is time to start the daemon. This can be done in a number of ways as the
        following sections will show.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50752464"></a>5.1 Running the server, starting and stopping.</h3></div></div></div><p>While strictly speaking not necessary the server should normally be started by the
                <code class="literal">root</code> user. As soon as the server doesn't need
                <code class="literal">root</code> privileges it will switch to run as the user specified in
            the configuration file, by default this is the user <span class="emphasis"><em>g7ctrl</em></span> if the
            configuration file has not been changed. This user should for security reasons not be
            the 'root' user. This user should be a system user without login shell. Such a user can
            normally be created by running the command '<span class="emphasis"><em>useradd</em></span>'. (If the
            daemon is installed via the RPM package this user will be automatically created).</p><p>If your system supports the command <span class="command"><strong>useradd</strong></span> then start by changing
            to root and add the user as so&gt;  useradd -r g7ctrl</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The user created must normally belong to the group <code class="literal">dialout</code>
                    on most system in order to have access to the <acronym class="acronym">USB</acronym>-serial
                    device.</p></div><p>
        </p><p>Then to start the server as root using the default settings the simplest way is to
            just call</p><pre class="screen">&gt; sudo g7ctrl</pre><p>In order to stop the server and allow it to do a clean shutdown the
                <code class="literal">SIGINT</code> (or <code class="literal">SIGSTOP</code>) signal should be sent to
            the process running the server (assuming <span class="command"><strong>g7ctrl</strong></span> has been started as a
            daemon). The distribution includes two support scripts to help with this. This can of
            course also be done manually as (and reading the pid number from the standard
            pid-file)</p><p>
            </p><pre class="screen">&gt; sudo kill -SIGINT `cat /var/run/g7ctrl/g7ctrl.pid`</pre><p>
        </p><p>Please note the "<code class="code">`</code>" backward slashes.</p><p>While testing the server it is also possible to start the daemon as a "normal" user.
            As a test start the daemon from command line for example as</p><p>
            </p><pre class="screen">&gt; g7ctrl -dN -V3 -lstdout</pre><p>
        </p><p>The commands will start the application on the terminal <code class="code">-dN</code> (not as a
            daemon), with maximum logging (<code class="code">-V3</code>) and print the log file directly to the
            terminal (<code class="code">-lstdout</code>).   This is a good way to do the initial testing since
            any problem can usually be quickly seen in the log. Note that when the daemon is not
            started as the root user it can not switch to the daemon user specified in the
            configuration file. </p><p>Once the testing is completed the daemon can be setup to be started at the same time
            as the server. Depending on the system this can done in a few different ways as the
            following two sections show.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50740416"></a>5.2 For system using old style <code class="filename">init.d</code></h3></div></div></div><p>To start the daemon automatically the installation will install two utility scripts.
            The first script will be installed in "<code class="filename">/etc/init.d/g7ctrl</code>" and
            follows the normal guidelines for a "<code class="filename">init.d</code>" service start/stopping
            script according to <acronym class="acronym">LSB</acronym> (Linux Standard Base). Using this script to
            start the server is then simply a matter of calling</p><pre class="screen">&gt; sudo /etc/init.d/g7ctrl start</pre><p>(or its alias <span class="command"><strong>rcg7ctrl</strong></span>) is given. The start-up script also supports
            the "<code class="literal">restart</code>" and "<code class="literal">status</code>" options.</p><p>If the server gives the error message : "<span class="emphasis"><em>Server can not be started. See
                system log</em></span>" then more information about the details of the problem can be
            found in the system log, normally <code class="filename">/var/log/messages</code>. The most
            common reason for this message is that the daemon is already running. </p><p>To stop the server give the command (as root)</p><pre class="screen">&gt; sudo /etc/init.d/g7ctrl stop</pre><p>Since the <code class="literal">init.d</code> system has been abandoned in most modern system
            the <code class="literal">init.d</code> scripts will then be automatically redirected to the
            corresponding <code class="literal">systemd</code> service. In that case it is better to just use
            the <code class="literal">systemd</code> service directly as the following section shows.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50708304"></a>5.3 Using systemd</h3></div></div></div><p>If your system makes use of <code class="literal">systemd</code> then the second utility script
            will be installed as a <code class="literal">systemd</code> service. The configuration script will
            automatically figure out if your system supports this. In this case the daemon can be
            directly controlled via the usual <span class="command"><strong>systemctl</strong></span> command as whown below.
            See <span class="command"><strong>man systemctl</strong></span> for details.</p><p>
            </p><pre class="screen">&gt; sudo systemctl stop g7ctrl.service</pre><p>
        </p><p>
            </p><pre class="screen">&gt; sudo systemctl start g7ctrl.service</pre><p>
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The <code class="literal">g7ctrl</code> service needs to first be enabled after the
                    initial installation with</p><p>
                    </p><pre class="screen">&gt; sudo systemctl enable g7ctrl.service</pre><p>
                </p></div><p>
        </p><p>If your system does not have the command <span class="command"><strong>systemctl</strong></span> then it is not
            using the <code class="literal">systemd</code> setup.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50717712"></a>5.4 Using upstart</h3></div></div></div><p>Newer version of Debian and Ubuntu now uses "<code class="literal">upstart</code>" to manage
            daemons. The build system fylly supports this and after the usual "<span class="command"><strong>sudo make
                install</strong></span>" the daemon could be controlled by</p><p>
            </p><pre class="screen">&gt; sudo start g7ctrl
&gt; sudo stop g7ctrl
&gt; sudo status g7ctrl</pre><p>
        </p><p>or alternatively by</p><p>
            </p><pre class="screen">&gt; sudo service g7ctrl start
&gt; sudo service g7ctrl stop
&gt; sudo service g7ctrl status</pre><p>
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The configuration files a restored in
                        <code class="filename">/etc/init/g7ctrl.conf</code></p></div><p>
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Upstart will be deprecated by Ubuntu from around 2016 and support for this
                    will officially end with the release of version 4.0.0</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51007056"></a>5.5 Command line argument</h3></div></div></div><p>Command line argument will override the corresponding settings in the configuration
            file. The daemon supports the following arguments in short and long format:</p><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>-d [n|y], --daemon=[n|y]</strong></span></span></dt><dd><p>Detach the program from the controlling terminal, a.k.a. running as a
                            daemon</p></dd><dt><span class="term"><span class="bold"><strong>-h, --help</strong></span></span></dt><dd><p>Print help</p></dd><dt><span class="term"><span class="bold"><strong>-i file, --inifile=file</strong></span></span></dt><dd><p>Use specified file for configuration</p></dd><dt><span class="term"><span class="bold"><strong>-l logfile, --logfile=file</strong></span></span></dt><dd><p>Specify the name of the logfile. A special value of
                                "<code class="literal">stdout</code>" can be used to print directly to
                            terminal</p></dd><dt><span class="term"><span class="bold"><strong>-p n, --cmdport=n</strong></span></span></dt><dd><p>Specify <acronym class="acronym">TCP/IP</acronym> port number for command listener</p></dd><dt><span class="term"><span class="bold"><strong>-s n, --stty=n</strong></span></span></dt><dd><p>Specify what <code class="literal">ttyACM&lt;n&gt;</code> device to use when
                            connecting over USB to device</p></dd><dt><span class="term"><span class="bold"><strong>-t n, --trkport=n</strong></span></span></dt><dd><p>Specify TCP/IP port number for receiving tracker updates</p></dd><dt><span class="term"><span class="bold"><strong>-V n, --verbose=n</strong></span></span></dt><dd><p>Specify verbose level for logging. 1=Show warnings and errors, 2=add
                            notices, 3=add debugging output</p></dd><dt><span class="term"><span class="bold"><strong>-v, --version</strong></span></span></dt><dd><p>Print version information and exit</p></dd><dt><span class="term"><span class="bold"><strong>--pidfile=file</strong></span></span></dt><dd><p>Specify PID lock file to be used. By default this is
                            <code class="filename">/var/run/g7ctrl/g7ctrl.pid</code> so if the daemon is
                            not started as root it must be specified since only root has access to
                            <code class="filename">/var/run</code>.</p></dd><dt><span class="term"><span class="bold"><strong>--datadir=directory</strong></span></span></dt><dd><p>Specify directory for static data files (default,is
                                <code class="filename">/usr/share/g7ctrl</code>)  that are shipped with the
                            daemon.</p></dd><dt><span class="term"><span class="bold"><strong>--dbdir=directory</strong></span></span></dt><dd><p>Specify directory for dynamic data files (default,is
                                <code class="filename">/var/lib/g7ctrl</code>) the dynamic data files
                            currently used are the database and the cache file for retrived address
                            lookup from coordinates.</p></dd></dl></div><p>
        </p><p>The default settings in the distribution corresponds running the daemon as</p><p>
            </p><pre class="screen">&gt; g7ctrl -i "/etc/g7ctrl/g7ctrl.conf" -d Y -s 0 -p 3100 -t 3400 \
-l "/var/log/g7ctrl/g7ctrl.log" V 2 --pidfile="/var/run/g7ctrl/g7ctrl.pid" \
--dbdir="/var/lib/g7ctrl" --datadir="/usr/share/g7ctrl"</pre><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51041760"></a>5.6 Verifying that the daemon is running</h3></div></div></div><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Since the configuration file at installation time specifies that the
                    connection to the daemon is password protected you most likely need to look at
                    the configuration file (<code class="filename">/etc/g7ctrl/g7ctrl.conf)</code> to confirm
                    (or change) the password currently in use.</p></div><p>
        </p><p>Once the server is running an easy way to connect to the server is by using the
                '<span class="command"><strong>nc</strong></span>' (net-cat) command this allows connecting to a specific port
            on any named server. Assuming that the <span class="emphasis"><em>g7ctrl</em></span> server is running on
            localhost the following command will connect to the daemon (assuming the default command
            port 3100 has not been changed in the configuration-file (e.g.
                <code class="filename">/etc/g7ctrl/g7ctrl.conf</code>) or by a command line argument).</p><pre class="screen">&gt; nc localhost 3100</pre><p>After a successful connection the server will reply with a short information message.
            The full returned information message at the connection time should look something
            similar to the following (the version and build numbers might however differ):</p><pre class="screen">GM7 Server version 3.0.0 (build 150109-13)
</pre><p>If password protection (see <a class="xref" href="#section.security" title="5.7 Security">Section 5.7</a> ) the welcome
            message is not be shown until the correct password has been specified. Instead when
            password protection is enabled the connection sequence looks like this</p><pre class="screen">&gt; nc localhost 9300
Password:<span class="bold"><strong>xxxxxxx</strong></span>
GM7 Server version 3.0.0 (build 150109-13)
</pre><p>This means that the correct server password has to be given before the welcome
            message is seen. The server is now ready to accept commands on this
            connection.</p><p>To test the server you could for example give the internal server command
                "<span class="command"><strong>.ver</strong></span>" (please note the "<code class="literal">.</code>" at the beginning!)
            which will again prompt out the version of the daemon.</p><p>To disconnect to the server just type '<span class="command"><strong>exit</strong></span>'</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>The best way to connect to the daemon is to use the supplied command shell
                        "<span class="command"><strong>g7sh</strong></span>" which supports full editing and history as well as
                    knowledge of the daemon command protocol to make it a more pleasant experience
                    than connecting "raw" to the daemon of the <acronym class="acronym">TCP/IP</acronym>
                    socket.</p></div><p>
        </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51056336"></a>5.6.1 Simulating an active tracker</h4></div></div></div><p>A final check is to simulate an active tracker that connects to the daemon. You should
                use this to verify that all setups are correct and that you receive an event mail.
                This is done by using the "<span class="command"><strong>nc</strong></span>" command to send a "fake" location
                update to the dameon in the saem manner as the tracker does. The following commadn
                line assumes that the utility program "<span class="command"><strong>nc</strong></span>" is installed and that
                the command is issued on the same server as where the daemon is running (otherwise
                just replace "<code class="literal">localhost</code>" with the proper server address.</p><p>
            </p><pre class="screen">&gt; printf "3000000010,20131211002222,14.959445,53.366545,0,0,0,0,34,3.99V,0\r\n" | \
nc localhost 3400</pre><p>
        </p><p>The command above will simulate an active tracker with ID
                    <code class="literal">3000000010</code> that sends the "<code class="literal">Wake up Event</code>".
                If the daemon configuration is set to send mails you should now check that you have
                received the event mail after a short while.</p><p>If this does not work as expected then look at the log file (normally
                    <code class="filename">/var/log/g7ctrl/g7ctrl.log</code>)  for clues why this is not
                working.. </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.security"></a>5.7 Security</h3></div></div></div><p>In order to prevent unauthorized access to the server the server have a basic
            plain-text password protection. This means that a password can be configured to be used
            before a client can start giving command to the daemon. The password is set in the
            configuration-file.</p><p>The setting whether password should be used or not and the actual password is
            specified in the configuration-file. </p><p>The configuration uses the same password for all clients. Since the password is stored
            in plain text format the configuration file should have restricted access. </p><p>This should not be considered strong security but rather a weak
                "<span class="emphasis"><em>stop-messing-with-my-tracker</em></span>" protection. At configuration
            time the password in the configuration file is set to a random 6 character long
            password. </p><p>After connecting to the server when the password has been enabled the first string
            sent back from the server will be the single string:</p><pre class="screen">Password:</pre><p>The rest of the reply is the same as when no password is used. After three failed
            attempts the daemon will disconnect the client.</p><p>For a more secure access to the server the <span class="command"><strong>g7sh</strong></span> command should be
            setup as a login shell (or logging in to the server remotely using
                <span class="command"><strong>ssh</strong></span> or <span class="command"><strong>mosh</strong></span>). For more information see <a class="xref" href="#section.command-shell" title='6 The command shell - "g7sh"'>Section 6</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51071664"></a>5.8 Adding user hooks for special processing</h3></div></div></div><p>To maintain maximum flexibility the daemon will check for the existence of several
            (optional) shell scripts that can be provided by the user to take special actions on
            certain events such as that the tracker reports movement. These shell scripts are
            initially null scripts and does nothing.</p><p>The scripts are stored in "<code class="filename">/usr/share/g7ctrl/scripts/</code>". For more
            information regarding these event scripts please refer to <a class="xref" href="#section.event-scripts" title="A.4 Event-scripts">Section A.4</a>.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>These event scripts can for example be used to play an alarm sound when the
                    daemon receives an alarm event.</p></div><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.command-shell"></a>6 The command shell - "g7sh"</h2></div></div></div><p>The supplied command shell offers the easiest way to control a device and the daemon. The
        shell can be run on either the same server that is running the daemon (the most common case)
        but it is also possible to run the shell on an arbitrary computer as long as <acronym class="acronym">TCP/IP
        </acronym>connection can be established to the server running the daemon. </p><p>If no command line arguments are given the shell assume that the daemon is running on the
        same machine and tries to find the daemon configuration file and read the settings from
        there.</p><p>To run the command shell from a different computer it is required to add command line
        arguments that specifies the server name and optionally what port the shell should connect
        to.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50723840"></a>6.1 Command line arguments</h3></div></div></div><p>The shell support the following command line arguments</p><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>-h, --help</strong></span></span></dt><dd><p>Print help and exit</p></dd><dt><span class="term"><span class="bold"><strong>-p <em class="parameter"><code>nnn</code></em>,
                                --port=<em class="parameter"><code>nnn</code></em></strong></span></span></dt><dd><p>What command port to use (by default 3100)</p></dd><dt><span class="term"><span class="bold"><strong>-s <em class="parameter"><code>&lt;address&gt;</code></em>,
                                --server=<em class="parameter"><code>&lt;address&gt;</code></em></strong></span></span></dt><dd><p>The address of the server to connect to either as a domain address or
                            in numeric "dot" format.</p></dd><dt><span class="term"><span class="bold"><strong>-v, --version</strong></span></span></dt><dd><p>Print shell version and exit</p></dd><dt><span class="term"><span class="bold"><strong>-e &lt;command&gt;</strong></span></span></dt><dd><p>Run the shell and execute specified command and then quit.Only single
                            commands can be give for each invocation.</p></dd></dl></div><p>
        </p><p>Use <code class="literal">man g7sh</code> on the command line to get more information.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50964960"></a>6.2 Basic usage</h3></div></div></div><p>The shell can be run either on the same server as the daemon or on a separate
            computer. Assuming the first case the shell can just be invoked as </p><p>
            </p><pre class="screen">&gt; g7sh</pre><p>
        </p><p>If run from another computer them the server running the dameon must be specified on
            the command line. </p><p>
            </p><pre class="screen">&gt; g7sh -s 192.168.0.10</pre><p>
        </p><p>The above commands assumes that the ports setup for the daemon are either the standard
            ports or given in the configuration file. If the config file can not be found in the
            common place (i.e. <code class="filename">/etc/g7ctrl/g7ctrl.conf</code>) then the shell will
            look for a shell specific config file "<code class="filename">.g7sh</code>" in the users home
            directory. Command line argument will however always override any ini file
            setting.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50860272"></a>6.3 Configuring the shell as a login shell</h3></div></div></div><p>One possible way to use the command shell is to use it as a <span class="italic">system login shell</span>. In this way it will be possible to
            login directly to the server by using, for example, <span class="command"><strong>ssh</strong></span> (or its
            mobile successor <span class="command"><strong>mosh</strong></span>) and connecting as a dedicated user who uses
                <span class="command"><strong>g7sh</strong></span> as the default login shell. This has the advantage of
            allowing a secure remote connection directly to the daemon by just connection to the
            server as that user.</p><p>In order to accomplish this there are three things that must be done:</p><p>
                </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Add the user that should have the command shell as login shell (for
                        example by using <span class="command"><strong>useradd</strong></span>)</p></li><li class="listitem"><p>Specify <span class="command"><strong>g7sh</strong></span> as the login shell for that user. How to
                        do this is system dependent but could for example be done by first adding a
                        line in the <code class="filename">/etc/passwd</code> file. For example adding the
                        user <code class="literal">g7shell</code> could be done by adding the line</p><p>
                        </p><pre class="screen">g7shell:x:0:0:g7ctrl shell user:/home/g7shell:/usr/bin/g7sh</pre><p>
                    </p><p>The above line creates a new user called <code class="literal">g7shell</code> which
                        uses <span class="command"><strong>g7sh</strong></span> as login shell. (The '<span class="italic">x</span>' in the password field indicates that the system is using
                            <span class="italic">shadow passwords</span>). You can also use
                        the system tools you are comfortable with in order to create a new user and
                        specifying that users login shell.</p></li><li class="listitem"><p>Allow <span class="command"><strong>g7sh</strong></span> to be used as system shell by adding it
                        to the list of allowed system shells in
                        '<code class="filename">/etc/shells</code>'</p></li></ol></div><p>
            </p><p>After the configuration is done it is simply a matter of login in to the server as
            the user with the <span class="command"><strong>g7sh</strong></span> as login shell, for example via
                <span class="command"><strong>ssh</strong></span> and give commands and read statuses from the daemon as usual. </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50982080"></a>6.4 Command line editing and completion</h3></div></div></div><p>The shell supports full command line editing. The cmmands are identical to hte one
            used for command line editing in "<code class="literal">bash</code>" shell (basically a subset of
            commands supported by <code class="literal">emacs</code>). </p><p>In addition to command line editing the shell also supports context sensitive command
            completion. What this means is that at any time it is possible to use the "tab"-key and
            a list of possible commands are shown. Depdning on what has been written earlier on the
            command line the list will only show commands possible at that point. If a character or
            characters have been typed then only commands starting with those will be shown.</p><p><span class="bold"><strong>Example 1.</strong></span> Typing "<code class="literal">ge</code>" and then
            press "tab" twice and the follwing command completions will be shown (the
                <code class="literal">&lt;TAB&gt;</code> indicates pressing the tab-key)</p><p>
            </p><pre class="screen">g7ctrl&gt; ge<span class="bold"><strong>&lt;TAB&gt;</strong></span>
g7ctrl&gt; get <span class="bold"><strong>&lt;TAB&gt;</strong></span>
address  gfen     loc      nrec     roam     sms      vip
batt     gfevt    locg     phone    sens     track    
comm     imei     lowbatt  ps       sim      tz       
config   led      mswitch  rec      sleep    ver      
g7ctrl&gt; get c<span class="bold"><strong>&lt;TAB&gt;</strong></span>
g7ctrl&gt; get co<span class="bold"><strong>n</strong></span><span class="bold"><strong>&lt;TAB&gt;</strong></span>
g7ctrl&gt; get config</pre><p>
        </p><p><span class="bold"><strong>Example 2.</strong></span> If instead the initial command is
                "<code class="literal">do</code>" the completion list will be quite different and showing only
            the possible completion for the "<code class="literal">do</code>" statement.</p><p>
            </p><pre class="screen">g7ctrl&gt; do<span class="bold"><strong>&lt;TAB&gt;</strong></span>
clrec   dlrec   reboot  reset   test    
g7ctrl&gt; do </pre><p>
        </p><p><span class="bold"><strong>Example 3.</strong></span> Finally , to get a list of all possible
            commands that a line can start with just press tab-key at the empty line</p><p>
            </p><pre class="screen">g7ctrl&gt; <span class="bold"><strong>&lt;TAB&gt;</strong></span>
.address    .ld         .target     exit        set
.cachestat  .ln         .usb        get         
.date       .nick       .ver        help        
.dn         .ratereset  db          preset      
.lc         .table      do          quit    
g7ctrl&gt; </pre><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.connecting-device"></a>7 Connecting the device </h2></div></div></div><p>The tracker is connected to the server in one of three ways each with there own advantages
        and disadvantages.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Direct with a <acronym class="acronym">USB</acronym> cable</p><p><span class="bold"><strong><span class="italic">Pros:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Does not incur any cost.</p></li><li class="listitem"><p>Does not require special setup</p></li></ul></div><p><span class="bold"><strong><span class="italic">Cons:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The tracker must be physically close to the server</p></li><li class="listitem"><p>This can be done even without the daemon but will require the user to
                            set up a serial connection to the device and use software to communicate
                            with the device.</p></li></ul></div></li><li class="listitem"><p>Over <acronym class="acronym">GPRS</acronym></p><p><span class="bold"><strong><span class="italic">Pros:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Allows server to control the device over a distance which makes it
                            easy for the end user</p></li></ul></div><p><span class="bold"><strong><span class="italic">Cons:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Consumes bandwidth and incur costs</p></li><li class="listitem"><p>Requires a server software to talk to the device</p></li><li class="listitem"><p>Requires the setup of device GPRS connection which will drain the
                            battery. Due to the way a connection is established a constant
                            connection must be established by regularly sending data even when the
                            end user has made no such requests. The daemon will automatically send
                            data as necessary to keep the connection alive.</p></li></ul></div></li><li class="listitem"><p>Using <acronym class="acronym">GSM</acronym> text messages (a.k.a <acronym class="acronym">SMS</acronym>,
                    <span class="italic">Short Message Service</span>)</p><p><span class="bold"><strong><span class="italic">Pros:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Can control the device over distance</p></li><li class="listitem"><p>Does not require any extra software or server</p></li></ul></div><p><span class="bold"><strong><span class="italic">Cons:</span></strong></span>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Incur cost for each message (both in sending phone and in device since
                            a reply is normally sent)</p></li><li class="listitem"><p>Tedious and error prone to enter long commands as texts</p></li><li class="listitem"><p>Requires the user to learn the detailed device protocol</p></li></ul></div></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51095920"></a>7.1 Connecting over USB</h3></div></div></div><p>This only requires a mini USB cable between the device and your computer. When a new
            device have been connected the daemon will automatically detect this and when the device
            is ready it will read back the device ID. The connected <acronym class="acronym">USB</acronym> devices
            can be listed with the "<span class="command"><strong>.usb</strong></span>" command. The active USB port (the one
            receiving the given commands) is indicated with a '*'. Withe the same command it is
            possible to select which of the connected devices should receive the commands (See <a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a>). Please allow for 20s after the device have been
            attached to the computer for the connection to be fully established and it will start to
            accept commands.</p><p>If no device is connected an error message will be shown if you try to give commands
            to the device (unless you are using a debug version of the daemon configured with the
                <code class="literal">--enable-simulate</code> option, see <a class="xref" href="#section.build-environment" title="4.6 Setting up your own build environment - for developers">Section 4.6</a>). An easy way to verify that the device is
            recognized is to query the device, for example by asking for the version of the firmware
            via the "<code class="literal">get ver</code>" command.</p><p>
            </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>On Linux the user running the daemon must have read/write access to the
                        <acronym class="acronym">USB</acronym> device (usually <code class="literal">ttyACM0</code> or
                    similar). On most system this requires the user to be a member of the
                        "<code class="literal">dialout</code>" group. </p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51104464"></a>7.2 Configuring USB connection</h3></div></div></div><p>On Linux the <acronym class="acronym">USB</acronym> connections shows up as a
                <code class="literal">ttyACM</code><span class="italic">n</span> but on
                <span class="productname">OSX</span> it shows up as
                <code class="literal">cu.usbmodem</code><span class="italic">nnnn</span>. To help the
            daemon identify the device it is necessary to specify the correct number in the config
            file. On Linux based system it usually doesn't matter what <acronym class="acronym">USB</acronym> port
            you connect on, it will still give the device to the same <code class="literal">ttyACM</code>
            device. The ports are numbered from 0 unless you have a number of other peripheral
            permanently connected. In that case you most likely need to set a higher start number
            then "0" i the configuration file so that the daemon does not try to connect to the
            other peripheral.</p><p>However, for <acronym class="acronym">OSX</acronym> this number will differ depending on which
                <acronym class="acronym">USB</acronym> port you connect the device on. Therefore you should check
            which device it shows up as by listing the devices under the "<code class="filename">/dev</code>"
            directory. On <span class="productname">OSX</span> this will be a 4 digit number (e.g. 1411)
            but on Linux it will be a single digit number. The config file setting for this is the
                <code class="literal">stty_device</code> variable at the top of the config file. For
                <span class="productname">OSX</span> a list of possible <acronym class="acronym">USB</acronym> ports to
            watch can be given since they are not numbered sequentially as they are on Linux.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The connection over <acronym class="acronym">USB</acronym> on <span class="productname">OSX</span>
                    should be considered an experimental feature. The connection can sometimes have
                    a temperament and <span class="productname">OSX</span> might refuse to recognize a
                    connected device. In case of problem try reconnect the device after it been to
                    sleep and woken up. The cause for the (sometimes) instability on
                        <span class="productname">OSX</span> is so far unknown. </p><p>The <acronym class="acronym">USB</acronym> connection on Linux is however extremly stable and
                    hence should be the preferred platform when working with devices over
                        <acronym class="acronym">USB</acronym>.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51145248"></a>7.3 Connecting over GPRS</h3></div></div></div><p>It is possible to send command to the device remotely over <acronym class="acronym">GPRS</acronym>. In
            order for this to work it is first necessary to enable <acronym class="acronym">GPRS</acronym> as a
            communication channel. This is done using the "<span class="command"><strong>comm</strong></span>" command (<a class="xref" href="#cmd.comm" title="C.1.4 comm">Section C.1.4</a>). Once this is setup the device will constantly be in touch
            with the base over GPRS. Please note that this will drain the battery fairly soon so it
            should only be used on devices with external power supply or for a short period of time. </p><p>Since it is possible for the daemon to have multiple trackers connected either on
                <acronym class="acronym">USB</acronym> or over <acronym class="acronym">GPRS</acronym> the daemon must be told which
            tracker to send commands to. This is done with either the "<span class="command"><strong>.usb</strong></span>"
            command (<a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a>) which specifies the <acronym class="acronym">USB</acronym>
            target for the following commands or by the <span class="command"><strong>.target</strong></span> (<a class="xref" href="#cmd.srv-target" title="C.4.13 .target">.target</a>) command hich specifies
            the <acronym class="acronym">GPRS</acronym> target for the following commands. A target can be specified
            with either its nick-name or its client number as listed by the "<span class="command"><strong>.ld</strong></span>"
            command.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>To make it easier configure the preset "<span class="command"><strong>gprs_on</strong></span>" to enable
                        <acronym class="acronym">GPRS</acronym> communication. Please note however that the exact
                    setting the preset template must be customized with the details of the operator
                    providing the <acronym class="acronym">SIM</acronym> used in the device.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51156784"></a>7.4 Connecting with text messages</h3></div></div></div><p>Please see the supplied manual for the tracker. This requires no special setup on the
            behalf of the daemon.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.controlling-device"></a>8 Controlling the device using commands</h2></div></div></div><p>A tracking device such as the <span class="productname">GM7</span> must be setup to operate in a
        specific mode to be useful. The tracker can be setup so that it only sends an update when it
        detects a movement or for example when the speed exceeds a certain limit. There are three
        major way in which the device can be configured as discussed in <a class="xref" href="#section.connecting-device" title="7 Connecting the device">Section 7</a>. </p><p>The daemon supports both communication over <acronym class="acronym">USB</acronym> which is the preferred
        way to do the initial setup </p><p>Please keep in mind though that when you are giving commands you are talking to the daemon
        which then sends commands to the device. The normal way to interact with the daemon is
        through the command shell , "<code class="literal">g7sh</code>", see  <a class="xref" href="#section.command-shell" title='6 The command shell - "g7sh"'>Section 6</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51111856"></a>8.1 Controlling the device using server commands</h3></div></div></div><p>The device has its own set of "raw" commands that can be used to communicate with the
            device. These commands are described in the protocol description fro the
                <span class="productname">GM7 Tracker</span>. These are for example the commands you would
            use when sending text messages to the device. The problem with this is that the syntax
            is a bit tedious and it requires the user to look up or remember the exact meaning of a
            number of arguments given to each command.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Using the commands below assumes that a device is connected via the
                        <acronym class="acronym">USB</acronym> port. If this is not so the daemon will give a
                    information message that device commands are not available at this time.</p></div><p>
        </p><p>To alleviate this burden a bit the daemon has its own command set that is easier for
            an end user to remember and use. As an example consider the following "raw"
            command</p><p>
            </p><pre class="screen">$WP+ROAM=0000,1</pre><p>
        </p><p>which is used to enable <acronym class="acronym">GSM</acronym>/<acronym class="acronym">GPRS</acronym> roaming (i.e.
            the device can send text and data when the <acronym class="acronym">SIM</acronym> card is in roaming
            mode). </p><p>The same command using the simplified daemon command set would be</p><p>
            </p><pre class="screen">g7ctrl&gt; set roam on</pre><p>
        </p><p>Perhaps not a gigantic difference but definitely easier to remember especially since
            the command structure is the same for a large number of commands. The greatest
            difference is however in using commands with many parameters. For example to setup the
            device to use <acronym class="acronym">GPRS</acronym> communication for a Telenor <acronym class="acronym">SIM</acronym>
            card assuming the daemon is running on a server with <acronym class="acronym">IP</acronym> address
                <code class="literal">158.94.13.298</code> on port <code class="literal">3100</code> with 45s in between
            the so called <code class="literal">KEEP_ALIVE </code>packets the raw command to send the device
            would be</p><p>
            </p><pre class="screen">$WP+COMMTYPE=0000,4,,,services.telenor.se,,,158.94.13.298,3100,45,</pre><p>
        </p><p>The chances of getting this command right every time from memory is very small indeed.
            Using the daemons command version instead the following conversation between the user
            and the daemon would take place:</p><p>
            </p><pre class="screen">g7ctrl&gt; set comm
CommSelect - Select primary type of communication
  0 - Use USB
  1 - Use SMS over GSM
  2 - CSD &lt;reserved&gt;
  3 - UDP over GPRS
  4 - TCP/IP over GPRS
Select (0/1/2/3/4)?
&gt;&gt; </pre><p>
        </p><p>At this point user enters his selection after the "<code class="literal">(arg)&gt; </code>" mark
            and hits enter. The next question will be</p><p>
            </p><pre class="screen">SMS Base Phone - SMS base number to call
(arg)&gt; </pre><p>
        </p><p>and the user can enter the corresponding phone number. This will be followed by the a
            clear question for each of the following command arguments. After the user have answered
            all the questions and the daemon has made some sanity checks of the answers the complete
            command will be sent to the device. </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When giving arguments for a device command the prompt changes from "&gt; " to "&gt;&gt;
                    "</p></div><p>
        </p><p>To further simplify device handling it is possible to "record" command and command
            sequences so that instead of having to answer ten questions (as is the case for the
            "comm" command) a single command is given and earlier recorded parameters are used See
                <a class="xref" href="#section.using-presets" title="8.3 Using presets">Section 8.3</a>.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>To abort a command in the middle of specifying parameters just enter a
                    punctuation character "<span class="command"><strong>.</strong></span>" to abort the current
                    command.</p></div><p>
        </p><p>A complete list of server command with all argument s given in <a class="xref" href="#appendix.command-reference" title="Appendix C - Command reference">Appendix C</a>. Below is a one line summary of all
            available server commands as printed by the daemon "<code class="literal">help</code>"
            command.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>It is also possible to enter commands bypassing the argument questions. For
                    details see <a class="xref" href="#sec.direct-device-commands" title="8.1.1 Non-Interactive device commands - the @@CMD(arg1, ...) format">Section 8.1.1</a></p></div><p>
        </p><p>
            </p><pre class="screen">Device Command list:
--------------------
address   - Return the current location as the closest street address
batt      - Read the battery voltage from device
clrec     - Erase all stored locations from the device memory
comm      - Set/Read device communication type and its parameters
config    - Set/Read device ID, Password, and PIN Code of the SIM card
dlrec     - Download all stored locations in device memory to DB
gfen      - Enable/Disabling virtual fence
gfevt     - Enable/Disable/Set/Read GEO-Fencing event
imei      - Query the IMEI number of the internal GSM module
led       - Enable/Disable the LED indicator on/off
loc       - Get latest location
locg      - Get latest location as a Google map string
lowbatt   - Set/Read the internal battery low level alert
mswitch   - Set handling of detach event
nrec      - Get number of locations in device memory
phone     - Enable the function "Get the current location by making a phone call"
ps        - Enable/Disable power saving mode
reboot    - Restart-up the device
rec       - Enable/Disable/read logging function to the device
reset     - Reset all parameters to the manufactory default settings
roam      - Enable/Disable GPRS roaming function
sim       - Query the identification of the SIM card
sleep     - Enable/Disable "Sleeping Report"
sms       - Switch the SMS format (Text of PDU mode)
test      - Device diagnostic function
track     - Control if device should be sending back automatic tracking information.
tz        - Set the time zone information for the device
ver       - Get current firmware version
vip       - Preset up to 5 SMS phone numbers for receiving different alerts

Use "help &lt;command&gt;" for detailed help on each command.

Server Command list:
--------------------
help       - Print help for all commands
.lookup    - Toggle geolocation lookup
.cachestat - Print statistics of cache usage
.date      - Print date and time of server
.target    - List or set the GPRS target device to be active
.usb       - List or set USB connected device to be active
.ver       - Give version information of server
.lc        - List active connections
.ld        - List all connected devices (both on USB and GPRS)
.nd        - Delete specified nick
.nick      - Register a nick-name for connected device
.nl        - List all registered nicks
.table     - Toggle pretty printing of tables
.ratereset - Allow calls to the Google location API after usage limit excess

DB Command list:
----------------
db dist            - Calculate the approximate distance from a set of chosen locations
db deletelocations - Clear all stored locations
db export          - Export selected locations in chosen format to file
db head            - Display locations in DB from the top
db lastloc         - Retrieve the last stored location in the DB
db mailpos         - Mail the last stored location in the DB
db mailgpx         - Export the database in GPX format and mail as compressed attachment
db mailcsv         - Export the database in CSV format and mail as compressed attachment
db size            - Report number of location events in DB
db tail            - Display locations in DB from the head

Preset command list:
----------------
preset list            - List all read preset files with short description
preset refresh         - Re-read all preset files from disk
preset use &lt;preset&gt;    - Use (execute) the specified preset ("@&lt;preset&gt;" as shortform)
preset help &lt;preset&gt;   - Give more detailed help on the specified preset</pre><p>
        </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sec.direct-device-commands"></a>8.1.1 Non-Interactive device commands - the @@CMD(arg1, ...) format</h4></div></div></div><p>By default all device commands are interactive in the sense that giving a command
                will interactively ask for all arguments interactively one by one explaining the
                purpose of the command and the choice of input. For example for the <span class="command"><strong>set
                    comm</strong></span> command the interaction would be somewhat along the lines of (all
                text <span class="bold"><strong>in bold</strong></span> are user input):</p><p>
                </p><pre class="screen">g7ctrl&gt; <span class="bold"><strong>set comm</strong></span>
CommSelect - Select primary type of communication
  0 - Use USB
  1 - Use SMS over GSM
  2 - CSD &lt;reserved&gt;
  3 - UDP over GPRS
  4 - TCP/IP over GPRS
Select (0/1/2/3/4)?
(arg)&gt; <span class="bold"><strong>4</strong></span>
SMS Base Phone - SMS base number to call?
(arg)&gt; <span class="bold"><strong>[RETURN]</strong></span>
CSD Base Phone - CSD base number &lt;reserved and not used&gt;?
(arg)&gt; <span class="bold"><strong>[RETURN]</strong></span>
GPRS APN - The operators APN?
(arg)&gt; <span class="bold"><strong>internet.telenor.se</strong></span>
GPRS User - User name if required?
(arg)&gt; <span class="bold"><strong>[RETURN]</strong></span>
GPRS Passwd - Password if required?
(arg)&gt; <span class="bold"><strong>[RETURN]</strong></span>
GPRS Server - Server IP address where the device reports back to?
(arg)&gt; <span class="bold"><strong>mytracker.mydomain.com</strong></span>
GPRS Server Port - TCP/IP Port to use on server?
(arg)&gt; <span class="bold"><strong>3400</strong></span>
GPRS Keep Alive - Interval (in sec) between Keep Alive Packets?
(arg)&gt; <span class="bold"><strong>120</strong></span>
GPRS DNS - Optional DNS server for device to use.?
(arg)&gt; <span class="bold"><strong>208.67.222.222</strong></span>
[GM7] 4,,,internet.telenor.se,,,mytracker.mydomain.com,3400,120,208.67.222.222
      CommSelect: TCP/IP over GPRS
  SMS Base Phone: 
  CSD Base Phone: 
        GPRS APN: internet.telenor.se
       GPRS User: 
     GPRS Passwd: 
     GPRS Server: aditus.asuscomm.com
GPRS Server Port: 3400
 GPRS Keep Alive: 120
        GPRS DNS: 208.67.222.222

g7ctrl&gt; 
</pre><p>
            </p><p>Entering an empty line leaves the original value intact. To clear an old value (to
                leave it empty) enter an empty string (<span class="bold"><strong>""</strong></span>).</p><p>The above sequence makes sense for most users since it can not be expected to
                memorize the arguments for the many possible commands. However , for experienced
                users (or to use the command shell non-interactively) it is also possible to enter
                the commands non-interactively and not have the question for each argument posed.
                The format for this is</p><p>
                </p><pre class="screen">@@COMMAND(arg1,arg2,...)</pre><p>
            </p><p>So to enter the above command as a non-interactive command a user would
                enter</p><p>
                </p><pre class="screen">g7ctrl&gt; @@COMM(4,,,internet.telenor.se,,,mytracker.mydomain.com,3400,120,208.67.222.222)
OK.
g7ctrl&gt; </pre><p>
            </p><p>As explained above it is necessary to use the empty string ("") to clear a value
                instead of just leaving it empty which will keep the old value.</p><p>
                </p><pre class="screen">g7ctrl&gt; @@COMM(4,"","",internet.telenor.se,"","",mytracker.mydomain.com,3400,120,208.67.222.222)
OK.
g7ctrl&gt;  </pre><p>
            </p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please note that (by design) spaces are now allowed in the function
                        call.</p></div><p>
            </p><p>The main purpose of this possibility is to be able to script command sequences
                using the command shell ( g <span class="command"><strong>g7sh</strong></span>) with the "<span class="italic">-e</span>" option that can send commands to the daemon
                non-interactively. Of course, experienced user might find this faster than to have
                to answer a sequence of questions once the arguments have been understood and
                memorized.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51290224"></a>8.2 Controlling the device using "raw" device commands</h3></div></div></div><p>In order to accommodate expert users that really wants to use the raw commands
            directly the server also makes this possible. Raw device commands can be seen as an even
            more complex alternative to the  "<code class="literal">@@</code>" non-interactive functions. This
            makes it possible to interact with the device on the lowest level by giving commands
            directly according to their exact syntax as described in the <span class="italic">GM7
                Protocol description</span>.</p><p>For example. to find the <acronym class="acronym">IMEI</acronym> number of the device give the
            command</p><p>
            </p><pre class="screen">$WP+IMEI=0000,?</pre><p>
        </p><p>To enable this the config file setting "<code class="literal">enable_raw_commands</code>" must
            be set to true. <span class="bold"><strong>Please note that by default this option is
                disabled</strong></span>. This should be considered an expert options and we refer to the
                <span class="italic">GM7 Protocol description</span> for details on the exact
            format for the command string and we will not discuss this further here.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.using-presets"></a>8.3 Using presets</h3></div></div></div><p>Presets is way to record often used commands or command sequences. Technically this is
            a file of one or more commands that can be replayed. Any number of commands can be
            given.</p><p>By default the device comes with a few defined presets that will handle common tasks
            such as setting up <acronym class="acronym">GPRS</acronym> communication and enable tracking.</p><p>All preset files are stored in "<code class="filename">/usr/share/g7ctrl/presets/</code>" and
            have file suffix "<code class="literal">.preset</code>". The following commands are available to
            manage presets.</p><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>preset list</strong></span></span></dt><dd><p>List all currently defined presets</p></dd><dt><span class="term"><span class="bold"><strong>preset refresh</strong></span></span></dt><dd><p>Refresh all presets from the disk. This command makes it possible to
                            add or remove presets without having to restart the daemon.</p></dd><dt><span class="term"><span class="bold"><strong>preset use
                            </strong></span><em class="parameter"><code>&lt;preset-name&gt;</code></em></span></dt><dd><p>Run the commands in the specified preset file</p></dd><dt><span class="term"><span class="bold"><strong>preset help</strong></span>
                        <em class="parameter"><code>&lt;preset-name&gt;</code></em></span></dt><dd><p>Each preset file has its own built-in help to remember the user of
                            what exactly each preset file is doing. This command will give the
                            detailed help for the specified preset command.</p></dd></dl></div><p>
        </p><p>To further simplify running command presets a short form of "<code class="literal">preset use
                &lt;command-name&gt;</code>" exists. </p><p>
            </p><pre class="screen">@&lt;preset-name&gt;</pre><p>
        </p><p>As of version 2.1.3 the following predefined preset template are shipped</p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">gprs_on</code> - This will enable GPRS as the main
                        communication method for the device to report back. It will assume a Telenor
                            <acronym class="acronym">SIM</acronym> card to set up the APN.</p></li><li class="listitem"><p><code class="literal">gprs_off</code> - Turn the GPRS off. This is opertor
                        independent.</p></li><li class="listitem"><p><code class="literal">gtrack_on</code> - Enable GPRS and tracking. The device will
                        report back its position every 2min</p></li><li class="listitem"><p><code class="literal">gtrack_off</code> - Disable tracking and GPRS
                        communication</p></li><li class="listitem"><p><code class="literal">alarm_on</code> - Enable communication over GPRS, Use power
                        save mode 3, Enable GFEN alarm with 100m radius</p></li><li class="listitem"><p><code class="literal">alarm_off </code>- Disable GFEN alarm</p></li><li class="listitem"><p><code class="literal">rec_on</code> - Record positions to device memory</p></li><li class="listitem"><p><code class="literal">rec_off</code> - Stop recording positions to device
                        memory</p></li><li class="listitem"><p><code class="literal">sleep_wm</code> - Put device in sleep mode 3, wake up on
                        movements and all radios off</p></li></ul></div><p>
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The shipped files are only templates and must be completed and renamed before
                    they can be run. See <a class="xref" href="#section.preset-templates" title="8.3.2 Preset templates">Section 8.3.2</a> for
                    details.</p></div><p>
        </p><p>So if you have a Telenor <acronym class="acronym">SIM</acronym> card all you have to do to enable the
            device to start sending back location updates every 2min is to connect the device to
            your computer running the daemon using a <acronym class="acronym">USB</acronym> cable, wait for the
            device to setup communication, start the command shell and give the command</p><p>
            </p><pre class="screen">@gtrack_on</pre><p>
        </p><p>Assuming you have a Telenor <acronym class="acronym">SIM</acronym> card the device should now start
            sending back location updates to your server (assuming it is accessible from the
            internet as described in <a class="xref" href="#section.receiving-data" title="9 Receiving data">Section 9</a>). You can verify
            this by requesting the last received location update stored in the database with the
            command</p><p>
            </p><pre class="screen">g7ctrl&gt; db lastloc</pre><p>
        </p><p>which would return something like</p><p>
            </p><pre class="screen">20131010 22:31:19, devid=3000000001, lat=59.4512 lon=17.1853, \
http://maps.google.com/maps?q=59.4512,17.1853</pre><p>
        </p><p>Verify that the device id and time is what you expect. You should also wait another
            2min and do the same request again to see that a new location has been received. Another
            way would be to review the logfile of the daemon since each connection and location
            update is logged.</p><p> </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Remember that if the device is not connected to the computer over r
                        <acronym class="acronym">USB</acronym> it will by default go into sleep mode if no movement
                    is detected within 3min and it will stop sending location updates.</p></div><p>
        </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51339568"></a>8.3.1 Adding new presets</h4></div></div></div><p>Presets are created by adding a new file (with the file suffix
                    "<code class="literal">.preset</code>" in the preset directory. Each preset file has a
                comment section at top which is shown when the preset help &lt;preset&gt; is given and
                then one or more commands. A comment line is started with a "<code class="literal">#</code>"
                character. </p><p>The commands are the same as the daemon commands but written as function calls
                with parenthesis. As an example the following preset file sets up
                    <acronym class="acronym">GPRS</acronym> communication and starts a device tracking (i.e. the
                device sends back location data at regular interval) and sending it back to the
                server at <acronym class="acronym">IP</acronym> address <code class="literal">85.226.91.109</code></p><p>
                </p><pre class="programlisting">#Enable GPRS tracking
#This enable GPRS tracking back to a sever
# Using Telenor APN (internet.telenor.se)
# Server is 85.226.91.109, and port=3400
# Keep alive packet are sent every 45s
# Tracking every 2min regardless GPS fix
comm(4,"","",internet.telenor.se,"","",85.226.91.109,3400,45,"")
track(1,120,0,35,1,4,15)</pre><p>
            </p><p>As can be seen the commands have to include all arguments even if they are empty.
                The command reference (see <a class="xref" href="#appendix.command-reference" title="Appendix C - Command reference">Appendix C</a>) lists
                all commands and there arguments.</p><p>To refresh the preset files remember to either restart the daemon or run
                    "<span class="command"><strong>preset refresh</strong></span>" after a new preset file has been
                added.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="section.preset-templates"></a>8.3.2 Preset templates</h4></div></div></div><p>To make it easy the daemon includes a number of predefined preset template (for
                example "<code class="filename">gtrack.preset.template</code>". This preset will both enable
                the <acronym class="acronym">GPRS</acronym> communication and also turn on tracking so that the
                device will start sending updates at specified time interval.)</p><p>The template preset must be edited according to your preferences and operator details.
                It should be clear in the template where to edit from the placeholder. </p><p>For example to adapt the <code class="literal">gtrack</code> template do the following</p><p>Start by copying the template to a file without the <code class="literal">.template</code>
                suffix.</p><p>
                </p><pre class="screen">&gt; cp gtrack.preset.template gtrack.preset</pre><p>
            </p><p>Then change the IP-address of your server, the time interval and the
                    <code class="literal">KEEP_ALIVE</code> time. The template is shown in the listing below
                with the placeholder you should change marked in bold</p><p>
                </p><pre class="programlisting">#Enable GPRS tracking
#This enable GPRS tracking back to a sever on port 3400
#Using Telenor APN (internet.telenor.se)
comm(4,"","",internet.telenor.se,"","",<span class="bold"><strong>[SERVER_IP]</strong></span>,3400,<span class="bold"><strong>[KEEPALIVE_TIME]</strong></span>,"")
track(1,<span class="bold"><strong>[TRACKTIME_SEC]</strong></span>,0,0,1,4,15)</pre><p>
            </p><p>
                </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">SERVER_IP</code></span></dt><dd><p>IP Address of server</p></dd><dt><span class="term"><code class="literal">KEEPALIVE_TIME</code></span></dt><dd><p>Keep alive time in seconds (usually in the range 30-180)</p></dd><dt><span class="term"><code class="literal">TRACKTIME_SEC</code></span></dt><dd><p>Tracking interval in seconds for the device to send back position
                                update to server</p></dd></dl></div><p>
            </p><p>The above preset assumes that you have a Telenor <acronym class="acronym">SIM</acronym> so it uses
                the Telenor <acronym class="acronym">APN</acronym> (<code class="literal">internet.telenor.se</code>) and that
                you are using the default tracker port (<code class="literal">3400</code>). For a detailed
                explanation of the meaning of all other parameters please see the command reference
                    <a class="xref" href="#appendix.command-reference" title="Appendix C - Command reference">Appendix C</a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.receiving-data"></a>9 Receiving data</h2></div></div></div><p>Once the daemon is running it will listen for incoming events from the tracker. By default
        the daemon is listening on <acronym class="acronym">TCP/IP</acronym> port 3400 for device connections. As
        explained in <a class="xref" href="#appendix.configuring-the-daemon" title="Appendix A - Configuring the daemon">Appendix A</a> the port can be changed
        in either the configuration file or via command line arguments when the daemon is
        started.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50748080"></a>9.1 Setting up device to receive location updates</h3></div></div></div><p>To have the device start sending data two things must happen:</p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The device must be put in <acronym class="acronym">GPRS</acronym> communication mode. This
                        is done via the "<span class="command"><strong>comm</strong></span>" command in the daemon which will
                        configure the communication method of the device. </p><p>In order to enable <acronym class="acronym">GPRS</acronym> communication you must first
                        find out some information from the operator you are using. At minimum you
                        need to find your operators <acronym class="acronym">APN</acronym> name and if you want to
                        use a <acronym class="acronym">DNS</acronym> name for your server (as opposed to a numeric
                            <acronym class="acronym">IP</acronym> address).</p><p>The final bit of information/decision you need to make is decide how often
                        the device will "phone home". Since the operator has to manage a lot of
                        devices (where most of them are mobile phones) and there is a limited number
                        of IP addresses the operator will re-use addresses when it decides it is not
                        longer in use. The operator assumes a device does no longer need its
                        communication path if it has been silent for a certain time. When the device
                        starts talking again a new IP address and communication path will be
                        setup.</p><p>Therefore to keep the channel open with the same address the device will
                        regularly send a message back to the server to indicate that the device is
                        alive and kicking even if it hasn't sent any other events in a while.</p><p>When establishing a <acronym class="acronym">GPRS</acronym> connection you need to decide
                        how often these so called "KEEP ALIVE" messages (for obvious reasons) should
                        be sent. Sending them to often will drain the battery but on the other hand
                        sending them too slow will have the operator close the connection and force
                        the device to create a new communication (with a new IP address). The daemon
                        is clever enough to keep track of each device regardless of what IP address
                        it gets so dropping the connection is not really a big issue. The only small
                        drawback is that if its too far between the KEEP ALIVE messages it can take
                        a while to discover that the device has a problem.</p><p>The time depends on the operator but to keep the same
                            <acronym class="acronym">IP</acronym> address most likely the time needs to be less than
                        2min.</p></li><li class="listitem"><p>Tell the tracker to start sending location updates according to
                        specifications. The tracker can be told to send back location updates at
                        regular interval (either time, distance or both). See the "track" command
                            (<a class="xref" href="#cmd.track" title="C.1.27 track">Section C.1.27</a>) for more details.</p></li></ol></div><p>
        </p><p>To make it easy the daemon includes a predefined <span class="bold"><strong>preset</strong></span> template "<code class="filename">gtrack.preset.template</code>". This
            preset will both enable the <acronym class="acronym">GPRS</acronym> communication and also turn on
            tracking so that the device will start sending updates at specified time interval. See
                <a class="xref" href="#section.preset-templates" title="8.3.2 Preset templates">Section 8.3.2</a> for more details. </p><p>To disable the tracking send the command "<span class="command"><strong>set track off</strong></span>" (see <a class="xref" href="#cmd.track" title="C.1.27 track">Section C.1.27</a>) to the device.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please recall that the device by default will go into sleep mode if no
                    movement is detected within 3 minutes and will then stop sending location
                    updates.</p></div><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section.exporting-db"></a>10 Exporting the DB</h2></div></div></div><p>The database managed by the daemon contains all position update events received. To make
        it possible to interact with other programs (for example to plot routes in using the site
            <a class="link" href="http://www.gpsvisualizer.com/" target="_top">www.gpsvisualizer.com</a>) it is
        possible to export the database in several commonly used formats. </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp50973120"></a>10.1 Supported export formats</h3></div></div></div><p>The supported export formats are:</p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">GPX</acronym> - The <acronym class="acronym">GPS</acronym> exchange format. When
                        creating GPX export it is possible to have the locations grouped into tracks
                        and track segments. This is typically used to group temporally close
                        locations into logical tracks. The split time for two locations to be
                        considered to be part of different tracks are configurable. </p></li><li class="listitem"><p><acronym class="acronym">KML</acronym> - Format used by Google Earth</p></li><li class="listitem"><p><acronym class="acronym">CSV</acronym> - Comma separated values. Useful for post
                        processing using a spreadsheet program. All recorded information are
                        exported.</p></li><li class="listitem"><p><acronym class="acronym">XML</acronym> - Internal format which is a
                        serialization of the DB in <acronym class="acronym">XML</acronym>. This format has the
                        advantage of including all information sent back by the tracker which the
                        other <acronym class="acronym">XML</acronym> based format does not have support for. A
                        detailed description of the grammar (in <acronym class="acronym">RNG</acronym> format) for
                        the <acronym class="acronym">XML</acronym> format used is available in <a class="xref" href="#section.internal-export-format" title="D.3 The internal XML export format grammar">Section D.3</a>.</p></li><li class="listitem"><p><acronym class="acronym">JSON</acronym> - JavaScript Object Notation. A format suitable
                        for easy post processing with 3:rd party program</p></li></ul></div><p>
        </p><p>A detailed description of the commands are available in <a class="xref" href="#appendix.database-commands" title="C.2 Database commands">Section C.2</a></p><p><span class="bold"><strong>Examples:</strong></span></p><p>
            </p><pre class="screen">g7ctrl&gt; db export gpx
g7ctrl&gt; db export 2013-01-01 2013-01-31 csv /tmp/jan.csv
g7ctrl&gt; db export dev=3000000002 kml</pre><p>
        </p><p>The first command will export all locations in the database to the file
                <code class="filename">/usr/share/g7ctrl/export.gpx</code>, the second command for the
            selected date range to <code class="filename">/tmp/jan.csv</code> and the third command will
            export all location updates for the specified device to
                <code class="filename">/usr/share/g7ctrl/export.kml</code>. </p><p>For detailed information on the command see <a class="xref" href="#cmd.db-export" title="C.2.3 db export">db export</a>.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>The config file settings <code class="literal">trackseg_split_time</code> and
                        <code class="literal">track_split_time</code> specifies how the export should break up
                    sequences of locations into tracks and track segments.</p></div><p>
        </p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>In order to visualize a track there are several web-services available that
                    directly can import an exported <acronym class="acronym">GPX</acronym> database. One example is
                        <a class="link" href="http://www.gpsvisualizer.com/" target="_top">http://www.gpsvisualizer.com/</a></p></div><p>
        </p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.configuring-the-daemon"></a>Appendix A - Configuring the daemon</h2></div></div></div><p>There are a few principle areas which can be used to configure the daemon. They
        are:</p><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The configuration file (<code class="filename">/etc/g7ctrl/g7ctrl.conf</code>) which
                    holds all user configurable settings for the daemon itself.</p></li><li class="listitem"><p>The mail-templates which controls the look and feel of the mail sent from the
                    daemon. They are located in
                    (<code class="filename">/usr/share/g7ctrl/mail_templates</code>)</p></li><li class="listitem"><p>Event-scripts. These are shell scripts that the daemon will run on defined
                    events (such as a movement alarm)</p></li></ol></div><p>
    </p><p>The three areas in the configuration file are described in this appendix.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51254112"></a>A.1 The configuration file</h3></div></div></div><p>The following section describes all possible settings in the configuration file. By
            default this is located in "<code class="filename">/etc/g7ctrl/g7ctrl.conf</code>". The
            configuration file has two main sections, the <code class="literal">[config]</code> and the
                <code class="literal">[mail]</code> section. The first section controls all general settings
            and the latter the mail settings such as what <acronym class="acronym">SMTP</acronym> server to
            use.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51257248"></a>A.1.1 The <code class="literal">[startup]</code> section</h4></div></div></div><p>This section will only be read at startup. Any config file re-reads while the daemon
                is running (by sending the SIGHUP signal to the daemon) will ignore settings in this
                section</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">run_as_user</code></span></dt><dd><p>Type: <em class="parameter"><code>string</code></em> (Default:
                        <code class="literal">"g7ctrl"</code>)</p><p>Specifies the user who runs the daemon. This has only affect if the daemon
                            is started as root. As soon as the daemon do not need root privileges it
                            will drop down to this user. <span class="bold"><strong>Please note that this
                                user must exist on your server</strong></span>. The user should also have
                            access to the serial ports which usually requires the user to belong to
                            the group "<code class="literal">dialout</code>" since in ancient traditional
                            times serial ports was used for modem connections.</p></dd><dt><span class="term"><code class="literal">device_port</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[1025:60000]</code></em> (Default:
                        <code class="literal">3400</code>)</p><p>The port the daemon is listening on for incoming events from the
                        tracker</p></dd><dt><span class="term"><code class="literal">cmd_port</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[1025:60000]</code></em> (Default:
                        <code class="literal">3100</code>)</p><p>The port the daemon is listening on for commands on. This is the port
                        that the command shell "g7sh" will connect on. It is also perfectly
                        possible to connect directly to this port if one wants to (for some
                        reason) avoid to use the command shelll. </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51695584"></a>A.1.2 The <code class="literal">[config]</code> section</h4></div></div></div><p>Please note that many of these settings can be overridden by supplying command line
            arguments when starting the daemon.</p><p>
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">stty_device</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[0.7]</code></em> (Default: 0)</p><p>Which virtual serial port to use for connection with tracker over USB.
                                Normally the tracker will appear as an "<span class="emphasis"><em>Abstract Control
                                    Model</em></span>" tty port numbered from 0
                                    (<code class="literal">ttyACM0</code> = 0, <code class="literal">ttyACM1</code> = 1,
                                    <code class="literal">ttyACM2</code> = 2 ... and so on) . Default is to
                                accept command connection on <code class="literal">ttyACMO0</code> (i.e.
                                    <code class="literal">stty_device= 0</code>) </p><p>If you are unsure of which serial port to use please list the
                                    "<code class="filename">/dev</code>" directory before and after you
                                connect a tracker device. If your system is reasonable configured
                                your device should show up as "<code class="literal">ttyACM&lt;n&gt;</code>"
                                where "<code class="literal">&lt;n&gt;</code>" is single digit number. </p><p><span class="emphasis"><em>If your device shows up as something completely different
                                then unfortunately this version of the daemon does not support your
                                system, Please report this to have it addressed in a future
                                version.</em></span></p></dd><dt><span class="term"><code class="literal">max_clients</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[10:500]</code></em> (Default:
                                    <code class="literal">50</code>)</p><p>The maximum number of clients allowed to connect to the server. All
                            connections will be counted, both command and trackers. As a rule of
                            thumb this should be a minimum of (number of command clients expected) +
                            3*(number of expected trackers). This can safely be set to a fairly huge
                            number since it means very little system drain to have this as a high
                            number. </p></dd><dt><span class="term"><code class="literal">enable_raw_device_commands </code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">false</code>)</p><p>Set this to true if you want to allow clients to write raw device
                            commands directly to a connected device. All raw commands follow the
                            normal device command sequence and starts with a
                                "<code class="literal">$WP+</code>" prefix. See the GM7 protocol specification
                            for detailed information on each command.</p></dd><dt><span class="term"><code class="literal">verbose_log</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[1.3]</code></em> (Default:
                                    <code class="literal">2</code>)</p><p>verbosity of logging, 1=only show warning messages, 2=show
                            warnings+information, 3=same as 2 but also show debugging
                            messages.</p></dd><dt><span class="term"><code class="literal">client_idle_time</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[10:500]</code></em> (Default:
                                    <code class="literal">1200</code>)</p><p>How long time in seconds a command client can be inactive before the
                            connection is closed.</p></dd><dt><span class="term"><code class="literal">device_idle_time</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[10:500]</code></em> (Default:
                                    <code class="literal">180</code>)</p><p>How long time in seconds the device can be silent before the daemon
                            disconnects. </p></dd><dt><span class="term"><code class="literal">require_client_pwd</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">true</code>)</p><p>Should the daemon request a password before accepting a command
                            connection</p></dd><dt><span class="term"><code class="literal">client_pwd</code></span></dt><dd><p>Type: <em class="parameter"><code>string</code></em> (Default:
                                &lt;<span class="emphasis"><em>generated-at-config-time</em></span>&gt;)</p><p>If passwords are enabled this specifies the password to use. A random
                            default value is automatically generated when you configure the source
                            in preparation for compilation (i.e. ./configure)</p></dd><dt><span class="term"><code class="literal">track_split_time</code></span></dt><dd><p>Type: <code class="literal">integer[10, 24*60]</code>  (Default:
                                    <code class="literal">240</code>)</p><p>For <acronym class="acronym">GPX</acronym> export the locations can be split into
                                different tracks, and track segment if there is a specified time
                                difference between two consecutive location updates. This parameter
                                specifies the minimum time between two locations (in minutes) to
                                consider them to be part of different tracks. Set to -1 to disable. </p></dd><dt><span class="term"><code class="literal">trackseg_split_time</code></span></dt><dd><p>Type: <code class="literal">integer[10, 24*60]</code>  (Default:
                                    <code class="literal">-1</code>)</p><p>Within each track the locations can further be divided in track
                                segments for <acronym class="acronym">GPX</acronym> export. This parameter defines
                                the minimum time between two location update (in minutes) to
                                consider them to be different segments. Set to -1 to disable segment
                                splitting. </p></dd><dt><span class="term"><code class="literal">attachment_compression</code></span></dt><dd><p>Type: <code class="literal">string</code> (Default:
                                <code class="literal">"xz"</code>)</p><p>Specify the program and argument to use for compressing the export
                                attachment file when sending this a mail. On Linux system the "xz"
                                compression is typically the best alternative (highest compression
                                ratio) but requires more memory than for example "gzip". </p><p>Possible alternatives are: "<span class="command"><strong>xz</strong></span>",
                                    "<span class="command"><strong>gzip</strong></span>" and "<span class="command"><strong>bzip2</strong></span>".</p><p>Note that it is possible to supply compression level arguments as
                                well, e.g. "<span class="command"><strong>xz -8</strong></span>"</p></dd><dt><span class="term"><code class="literal">translate_device_reply</code></span></dt><dd><p>Type: <code class="literal">bool</code> (Default:
                                <code class="literal">yes</code>)</p><p>Determines if the device reply should also be translated into
                                plain-text in addition to the raw device reply.</p></dd><dt><span class="term"><code class="literal">enable_gfen_tracking</code></span></dt><dd><p>Type: <code class="literal">bool</code> (Default:
                                <code class="literal">yes</code>)</p><p>If the server receives a virtual fence crossing event (GFEN) the
                                if this flag is set the server will put the device in tracking mode.
                                The use case for this behaviour is that GFEN is most often used as a
                                theft alarm when for example a vehicle is moved. If such an event is
                                detected then it is useful to have the device start tracking in
                                order to trace the thieves. This makes it possible to have the
                                tracking normally turned off and only enable it in case of an active
                                theft (and hence save some battery and bandwidth)</p></dd><dt><span class="term"><code class="literal">gfen_tracking_interval</code></span></dt><dd><p>Type: <code class="literal">integer[10,3600] </code>(Default:
                                    <code class="literal">90</code>)</p><p>The tracking interval in seconds to be used when the automatic
                                tracking after a GFEN event has been enabled.</p></dd><dt><span class="term"><code class="literal">mail_on_tracker_conn</code></span></dt><dd><p>Type:  <code class="literal">bool</code> (Default:
                                <code class="literal">no</code>)</p><p>Determines if a mail should be sent when a new tracker connection
                                is established. The mail template used is
                                    "<code class="filename">mail_tracker_conn</code>". Typically this is used
                                as an alarm when a tracker wakes up and connects to the
                                server.</p></dd><dt><span class="term"><code class="literal">script_on_tracker_conn</code></span></dt><dd><p>Type:  <code class="literal">bool</code> (Default:
                                <code class="literal">no</code>)</p><p>Determines if a script should be run when a new tracker connection
                                is established. The script template used is
                                    "<code class="filename">tracker_conn.sh</code>"</p></dd><dt><span class="term"><code class="literal">use_address_lookup</code></span></dt><dd><p>Type: <code class="literal">bool</code> (Default:
                                <code class="literal">no</code>)</p><p>Determines if the dameon should do a reverse address lookup from
                                the coordinates and include them in the DB and mail. This uses the
                                Google Map API and might not be available for all locations. In
                                order to reduce the load (and potential future cost) the cached
                                addresses are stored in a file if the daemon is shut down and
                                re-read upon starting up again.</p></dd><dt><span class="term"><code class="literal">address_lookup_proximity</code></span></dt><dd><p>Type: <code class="literal">int</code> (Default:
                                <code class="literal">20</code>)</p><p>Determines how close (in meters) a lookup in the address cache
                                should be to be considered a hit when we search with given
                                coordinates.</p></dd><dt><span class="term"><code class="literal">google_api_key</code></span></dt><dd><p>Type: <code class="literal">string</code> (Default:
                                <code class="literal">""</code>)</p><p>A google <acronym class="acronym">API</acronym> key to use with Reverse geocoding
                                lookup if tracking or higher bandwidth usage is needed. Anonymous
                                calls are restricted to 2500 calls per 24h and a maximum of 5 calls
                                per second (QPS) on average (as per jan 2015) . For more information
                                on the Google API keys see <a class="xref" href="#section.google-api-key" title="A.2 Creating and using a Google API key">Section A.2</a></p></dd></dl></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51772544"></a>A.1.3 The <code class="literal">[mail] </code>section</h4></div></div></div><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">enable_mail</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">false</code>)</p><p>Master switch to enable/disable mail functionlity.</p></dd><dt><span class="term"><code class="literal">subject_prefix</code></span></dt><dd><p>Type: <em class="parameter"><code>string</code></em> (Default: <code class="literal">"GM7
                                    Daemon: "</code>)</p><p>The prefix used in the subject header for all mails sent from the
                                daemon. Note: Should include an ending space if separation from the
                                rest of the subject (that depends on the type of mail) is
                                wanted.</p></dd><dt><span class="term"><code class="literal">sendmail_on_event</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">false</code>)</p><p>Should mails be sent on alarm events. Enabling this will make the
                            daemon send mail on all received events <span class="bold"><strong>except</strong></span> from normal position updates either requested by
                            the user or when tracking is enabled.</p></dd><dt><span class="term"><code class="literal">sendmail_address</code></span></dt><dd><p>Type: <em class="parameter"><code>string[mail-address]</code></em> (Default:
                                <code class="literal">root@localhost</code>)</p><p>Default address where the  mails will be sent to.</p></dd><dt><span class="term"><code class="literal">daemon_email_from</code></span></dt><dd><p>Type: <em class="parameter"><code>string[mail-address]</code></em> (Default:
                                <code class="literal">&lt;empty&gt;</code>)</p><p>The from address used i the mail. Please note that this must be a real
                            verifiable mail address. It is not enough to name this (for example)
                                <code class="literal">root@localhost</code>. Most mail relays will rejected
                            such mails. The only exception would be if the sendmail_address is a
                            local server bound address on the same server running the <acronym class="acronym">SMTP</acronym> server.
                            In that case the mail will never be routed to an outside mail server.
                            However, if you are not an expert on how the <acronym class="acronym">SMTP</acronym> server is setup you
                            should probably give a real mail address here to avoid problems!</p></dd><dt><span class="term"><code class="literal">smtp_use</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">false</code>)</p><p>Mail can be sent either through a proper <acronym class="acronym">SMTP</acronym>
                                server or using the local "mail" command. In the latter case only
                                text-mails can be sent (no <acronym class="acronym">HTML</acronym> mails). To use an
                                    <acronym class="acronym">SMTP</acronym> server (the recommended way) this master
                                switch must be true.</p></dd><dt><span class="term"><code class="literal">smtp_server</code></span></dt><dd><p>Type: <em class="parameter"><code>string[IP-address]</code></em> (Default:
                                <code class="literal">localhost</code>)</p><p>The IP address of the <acronym class="acronym">SMTP</acronym> server.</p></dd><dt><span class="term"><code class="literal">smtp_port</code></span></dt><dd><p>Type: <em class="parameter"><code>integer[1:1024]</code></em> (Default:
                                <code class="literal">-1</code>)</p><p>The <acronym class="acronym">SMTP</acronym> port the server is listening on for incoming connection. By
                            default this is on most server port=25 but more and more this is changed
                            to another port to make it harder for various bot-nets. Please consult
                            your <acronym class="acronym">SMTP</acronym> provider to find out what port to use. Using a value of "-1"
                            will make the daemon use the system default value for the port.</p></dd><dt><span class="term"><code class="literal">smtp_user</code></span></dt><dd><p>Type: <em class="parameter"><code>string</code></em> (Default:
                                <code class="literal">&lt;empty&gt;</code>)</p><p>The user to authenticate on the <acronym class="acronym">SMTP</acronym> server</p></dd><dt><span class="term"><code class="literal">smtp_pwd</code></span></dt><dd><p>Type: <em class="parameter"><code>string</code></em> (Default:
                                <code class="literal">&lt;empty&gt;</code>)</p><p>The password to authenticate on the <acronym class="acronym">SMTP</acronym> server</p></dd><dt><span class="term"><code class="literal">use_html</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                            <code class="literal">true</code>)</p><p>Mail can be sent in plain format or in <acronym class="acronym">HTML</acronym>. This
                                switch must be true to send mail as <acronym class="acronym">HTML</acronym>
                                (recommended).</p></dd><dt><span class="term"><code class="literal">force_mail_on_all_events</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                                    <code class="literal">false</code>)</p><p>Mail is not normally sent for <code class="literal">GETLOCATION</code> or
                                    <code class="literal">TRACK</code> events. Setting this flag to true will
                                cause mails to be sent even for those two events. Note: Mails will
                                never be sent for <code class="literal">REC</code> events regardless the
                                setting of this flag.</p></dd><dt><span class="term"><code class="literal">include_minimap=no</code></span></dt><dd><p>Type: <em class="parameter"><code>bool</code></em> (Default:
                                <code class="literal">no</code>)</p><p>Determine if  the event mail should include two static miniaps
                                displaying the current coordinates with an overview and detailed
                                map.</p></dd><dt><span class="term"><code class="literal">minimap_overview_zoom</code></span></dt><dd><p>Type: <em class="parameter"><code>int</code></em> (Default:
                            <code class="literal">9</code>)</p><p>The zoom factor to be used for the overview map</p></dd><dt><span class="term"><code class="literal">minimap_detailed_zoom</code></span></dt><dd><p>Type: <em class="parameter"><code>int</code></em> (Default:
                            <code class="literal">15</code>)</p><p>The zoom factor to be used for the detailed map</p></dd><dt><span class="term"><code class="literal">minimap_width</code></span></dt><dd><p>Type: <em class="parameter"><code>int</code></em> (Default:
                            <code class="literal">200</code>)</p><p>The width of the minimap</p></dd><dt><span class="term"><code class="literal">minimap_height</code></span></dt><dd><p>Type: <em class="parameter"><code>int</code></em> (Default:
                            <code class="literal">200</code>)</p><p>The height of the minimap</p></dd></dl></div><p>            
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp51841776"></a>A.1.4 The distributed configuration template file </h4></div></div></div><p>The values in the configuration file shipped corresponds to default values used if a
                setting is missing or commented.</p><p>
            </p><pre class="programlisting">############################################################################
# About this file (g7ctrl.conf.template)
#
# This is the complete template config file for g7ctrl. It contains
# all user adjustable settings. 
#
# How to use this file:
# Copy this template to a file "g7ctrl.conf" and then make the necessary
# changes according to your server setup. The commented settings shows the
# default values.
#
# TIP: At minimum you probably want to setup the mail section to have the
# daemon send mails on events. It is normally safe to leave the other 
# settings to their default values.
#
# There are three sections in this file, they are:
#
# startup:    Settings only read at first startup (not on reload)
# config:     General settings for the server
# mail:       All mail settings
#
# -------------------------------------------------------------------------------------------------------
#
# Copyright (C) 2013-2015 Johan Persson
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;
############################################################################

############################################################################
# startup - Settings to configure the running of the daemon
#           Note: These settings will only take effect on startup and
#           not on any subsequent reload of the config.
############################################################################

[startup]

#----------------------------------------------------------------------------
# RUN_AS_USER string
# What user should the daemon run as. If the daemon is initially started
# by root user then it will drop it's privileges down to the specified
# user as soon as it is possible. If the daemon is started by a non-root
# user this will have no affect.
#----------------------------------------------------------------------------
#run_as_user=@PACKAGE_NAME@

#----------------------------------------------------------------------------
# DEVICE_PORT integer
# Default TCP/IP port where the server will listen for incoming connections
# from the tracking device.
#----------------------------------------------------------------------------
#device_port=3400

#----------------------------------------------------------------------------
# CMD_PORT integer
# Default TCP/IP port where the server will listen for command connections
#----------------------------------------------------------------------------
#cmd_port=3100


############################################################################
# config - General settings
############################################################################

[config]

#----------------------------------------------------------------------------
# STTY_DEVICE int
# The interpretation of this parameter is different whether this is a
# Linux derivate or OS X system
#
# For Linux:
# ==========
#
# The starting virtual serial port to use for connection with tracker over USB.
# normally the tracker will appear as an "Abstract Control Model" tty port
# numbered from 0
# ttyACM0 = 0
# ttyACM1 = 1
# ttyACM2 = 2
#
# The index specified here gives the starting point where the daemon will try
# to connect. For example specifying 1 here will only react on ports
# ttyACM1, ttyACM2, ... and so on. It is normally safe to leave it as 0 unless
# there are other permanently attached modems/devices.
#
# For OSX:
# ========
# This specifies an array of numbers that indicate the usbmodem
# 
# This index is used as the number(s) for for the /dev/ca.usbmodem???? USB 
# connection.
# Ex 1.) To specify (for example) ca.usbmodem1411 set 
# stty_device=1411 
# Ex 2.)  To specify (for example) ca.usbmodem1411,ca.usbmodem1451 set 
# stty_device=1411,1451 
#----------------------------------------------------------------------------
#stty_device=@DEFAULT_STTY_DEVICE@

#----------------------------------------------------------------------------
# MAX_CLIENTS integer
# The maximum number of simultaneous clients that are allowed to connect
# to this server. This includes both command clients and tracker clients.
#----------------------------------------------------------------------------
#max_clients=50

#----------------------------------------------------------------------------
# ENABLE_RAW_DEVICE_COMMANDS
# Is the user allowed to enter "raw" device commands
#----------------------------------------------------------------------------
#enable_raw_device_commands=false

#----------------------------------------------------------------------------
# VERBOSE_LOG integer
# Setting verbose to 0 will only show error messages
# Setting verbose to 1 will also show info messages
# Setting verbose to 2 will also show info messages + notices
# Setting verbose to 3 will also show info messages + notices + debug messages
#----------------------------------------------------------------------------
#verbose_log=1

#----------------------------------------------------------------------------
# CLIENT_IDLE_TIME integer
# Max idle time in seconds before clients are disconnected
# Defaults to 20min
#----------------------------------------------------------------------------
#client_idle_time=1200

#----------------------------------------------------------------------------
# DEVICE_IDLE_TIME integer
# Max idle time in seconds before connected trackers are disconnected
# Default to 3 min. (The mobile operators are usually very aggressive in
# killing off GPRS connections even with KEEP_ALIVE as short as 30s. This
# means that quite often the same tracker will connect from a new IP address
# and hence a new connection. This means that we need to close the old
# ones fairly often to avoid having a lot of old idle connections hanging 
# around.
#----------------------------------------------------------------------------
#device_idle_time=180

#----------------------------------------------------------------------------
# REQUIRE_CLIENT_PWD bool
# Should the daemon ask for password to accept command connections
#----------------------------------------------------------------------------
#require_client_pwd=yes

#----------------------------------------------------------------------------
# CLIENT_PWD string
# Password needed to access command interface
#----------------------------------------------------------------------------
client_pwd=@GENERATED_CLIENT_PWD@

#----------------------------------------------------------------------------
# TRACKSEG_SPLIT_TIME int
# The minimum time in minutes between location updates to consider them to be 
# part of different track segments when exporting location set to GPX format.
# Set to -1 to disable track segment splitting
#----------------------------------------------------------------------------
#trackseg_split_time=-1

#----------------------------------------------------------------------------
# TRACK_SPLIT_TIME int
# The minimum time in minutes between location updates to consider them to be 
# part of different tracks when exporting location set to GPX format.
# Set to -1 to disable track splitting
#----------------------------------------------------------------------------
#track_split_time=240

#----------------------------------------------------------------------------
# ATTACHMENT_COMPRESSION string
# Which compression command to use when mailing compressed GPX export
# Available compressions are :
# "xz", "gzip", "bzip2". 
# Note: "xz" is usually around 30% more effective than "gzip" but might not 
# be available on all systems and requires more memory
#----------------------------------------------------------------------------
#attachment_compression="gzip" 

#----------------------------------------------------------------------------
# TRANSLATE_DEVICE_REPLY boolean
# Determines if the device reply should be translated into plain text in 
# addition to the raw reply.
#----------------------------------------------------------------------------
#translate_device_reply=yes

#----------------------------------------------------------------------------
# ENABLE_GFEN_TRACKING bool
# If the server receives a GFEN event (eventid=50) which indicates that the
# tracker has passed its virtual fence then put the tracker in tracking mode
# so that it starts reporting back its position to the server every
# "gfen_tracking_interval" seconds.
#----------------------------------------------------------------------------
#enable_gfen_tracking=yes

#----------------------------------------------------------------------------
# GFEN_TRACKING_INTERVAL int
# Determines the tracking interval in seconds to use with automatic GFEN
# event tracking, see ENABLE_GFEN_TRACKING
#----------------------------------------------------------------------------
#gfen_tracking_interval=60

#----------------------------------------------------------------------------
# MAIL_ON_TRACKER_CONN bool
# Determines if mail is sent when a tracker makes a GPRS connection to the
# server. Could be useful to signal that the tracker has woken up by movement
# If the tracker has no GPRS setup then this will of course do nothing.
# NOTE: This will of course require a correct mail setup. See [mail] section
# below.
#----------------------------------------------------------------------------
#mail_on_tracker_conn=no

#----------------------------------------------------------------------------
# SCRIPT_ON_TRACKER_CONN bool
# Determines if a script (tracker_conn.sh) should be run when a tracker 
# makes a GPRS connection to the server. Could be useful to initiate alarm
# on movement. This is analogue with action scripts.
#----------------------------------------------------------------------------
#script_on_tracker_conn=no

#----------------------------------------------------------------------------
# USE_ADDRESS_LOOKUP bool
# Use Google service to do a reverse lookup of coordinates to get an 
# approximate address in notification mails and stored in the DB
# This is the default value when the server is started. It can be toggled
# with the server command ".address"
#----------------------------------------------------------------------------
#use_address_lookup=no

#----------------------------------------------------------------------------
# ADDRESS_LOOKUP_PROXIMIY int
# How close (in meters) a lookup must be in order to be considered a hit among
# the cached addresses. Set to 0 to only accept exact matches.
# Valid values are [0,200] since there is no point in having a radius larger
# than 200m together with address lookup.
#----------------------------------------------------------------------------
#address_lookup_proximity=20

#----------------------------------------------------------------------------
# OOGLE_API_KEY
# Optional commercial Google API key used for locations lookups. Without a 
# commercial key it is still possible to do lookups but the rate (number 
# of lookups per second) and the absolute number per 24 hours is restricted. 
#----------------------------------------------------------------------------
#google_api_key=

############################################################################
# mail - Settings for daemon email sending
############################################################################
[mail]

#----------------------------------------------------------------------------
# ENABLE_MAIL boolean
# Should the mail functionality be enabled at all. 
#----------------------------------------------------------------------------
#enable_mail=no

#----------------------------------------------------------------------------
# SUBJECT_PREFIX string
# The prefix used in the subject header in all mails sent from the daemon
#----------------------------------------------------------------------------
#subject_prefix="GM7 "

#----------------------------------------------------------------------------
# SENDMAIL_ON_EVENT boolean
# Send mail from the daemon on receiving device initiated events apart
# from downloads from device memory.Event of REC type will never generate a 
# mail since that can only happen when the user downloads recorded positions 
# in device memory and mail in that situation will not make sense. 
# If this is set to no then mails are only sent when a client connected to 
# the server requests a mail.
#----------------------------------------------------------------------------
#sendmail_on_event=no

#----------------------------------------------------------------------------
# FORCE_MAIL_ON_ALL_EVENTS boolean
# By default events of type GETLOCATION, TRACK will not generate
# a mail since they are considered normal updates requested by the end user. 
# If this flag is set to yes then both the GETLOCATION and TRACK will also 
# generate a mail. 
#----------------------------------------------------------------------------
#force_mail_on_all_events=no

#----------------------------------------------------------------------------
# SENDMAIL_ADDRESS string
# Mail address to use when sending notification.
# This can be a list of comma separated names in order to send to multiple
# addresses
#----------------------------------------------------------------------------
#sendmail_address=

#----------------------------------------------------------------------------
# DAEMON_EMAIL_FROM string
# The from address used in the email sent from the daemon. If this is left
# empty the address will default to the address of the user the daemon is
# running as. NOTE: this must usually be a valid domain address since many
# email relays refuse to forward mails from bogus domains. Hence it is
# normally not possible to specify the "localhost" as domain here.
#----------------------------------------------------------------------------
#daemon_email_from=

#----------------------------------------------------------------------------
# SMTP_USE boolean
# Use the specified SMTP server to send mail instead of the system mail
# command. If you want to use HTML formatted mail you MUST use an SMTP
# server. 
#----------------------------------------------------------------------------
#smtp_use=no

#----------------------------------------------------------------------------
# SMTP_SERVER string
# Which SMTP server to use
#----------------------------------------------------------------------------
#smtp_server=

#----------------------------------------------------------------------------
# SMTP_PORT int [-1, 1023]
# Alternative port for SMTP server. Use -1 to use system standard port.
# NOTE: The implementation does not support encrypted SMTP connections so
# just changing to the standard SMTPS port will NOT work!
#----------------------------------------------------------------------------
#smtp_port=-1

#----------------------------------------------------------------------------
# SMTP_USER string
# User name for login on the smtp server, if required
#----------------------------------------------------------------------------
#smtp_user=

#----------------------------------------------------------------------------
# SMTP_PWD string
# Password for login on the smtp server, if required
#----------------------------------------------------------------------------
#smtp_pwd=

#----------------------------------------------------------------------------
# USE_HTML boolean
# Use HTML mail when sending mail with templates when available. 
# Mails are sent with both HTML encoding as well as alternative 
# plain text as an alt content to follow the current RFC.
#----------------------------------------------------------------------------
#use_html=yes

#----------------------------------------------------------------------------
# USE_SHORT_DEVID boolean
# Should we use a truncated device ID in mails which is only the last
# four digits instead of the full 10 digit number. The purpose of this 
# is to make the mails slightly easier to read.
#----------------------------------------------------------------------------
#use_short_devid=no

#----------------------------------------------------------------------------
# INCLUDE_MINIMAP boolean
# Include a small static map in the event mail. This will include both
# an overview map and a detailed map centered at the current location.
#----------------------------------------------------------------------------
#include_minimap=no

#----------------------------------------------------------------------------
# MINIMAP_OVERVIEW_ZOOM int
# The Google map zoom factor to use for the overview minimap.
# A lower value is equal to zooming out
#----------------------------------------------------------------------------
#minimap_overview_zoom=9

#----------------------------------------------------------------------------
# MINIMAP_DETAILED_ZOOM int
# The Google map zoom factor to use for the detailed minimap.
# A lower value is equal to zooming out. The default factor 15 is roughly
# on street level.
#----------------------------------------------------------------------------
#minimap_detailed_zoom=15

#----------------------------------------------------------------------------
# MINIMAP_SIZE_WIDTH int
# The width, in pixels, of the minimap
#----------------------------------------------------------------------------
#minimap_width=200

#----------------------------------------------------------------------------
# MINIMAP_SIZE_WIDTH int
# The height, in pixels, of the minimap
#----------------------------------------------------------------------------
#minimap_height=200


# EOF - End of ini file

            </pre><p>
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.google-api-key"></a>A.2 Creating and using a Google API key</h3></div></div></div><p>The daemon can make use of two Google map services. First it can be instructed  to
            translate a received location to an approximate address and secondly it can be
            instructed to include two minature static maps (as images) in the event notification
            mail. By default the calls are made anonymously to Google and Googlewill then use the
            sending IP address to track usage and limits. The number of calls and the rate of calls
            (number of calls per second) are limited as decribed in Googles information page (see
            <a class="link" href="https://developers.google.com/maps/documentation/geocoding/" target="_top">Geocoding API</a>) .  In order to track the usage and possible increase the
            limits it is necessary to create a Google API key. Please note that there are both a
            free Google API key as well as commercial API keys. The usage limits are (of course)
            higher for commercial keys.</p><p>This section only very briefly gives the bare bones information about Google API keys.
            For a complete discussion we refer to Googles own documentation (see <a class="link" href="https://console.developers.google.com/" target="_top">https://console.developers.google.com/</a> )</p><p>
            </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>While Google at the moment allows for anonymous calls they clearly state that
                    the preferred way is to use the APIs with a valid API key. Google may at anytime
                    withdraw the anonymous access and an API key will be required. It is therefore
                    recommended to create an API key (a free API key can be created at no
                    charge)</p></div><p>
        </p><p>The limits with and without keys are as follows:</p><p>
            </p><div class="table"><a name="idp51869184"></a><p class="formal-object-title"><span class="label">Table A.1: </span><span class="title">Google rate limits for anonymous geocoding API Calls</span></p><div class="table-contents"><table summary="Google rate limits for anonymous geocoding API Calls" border="1"><colgroup><col width="265pt" class="c1"><col width="120pt" class="c2"></colgroup><thead><tr><th>Type of limit</th><th>Limit</th></tr></thead><tbody><tr><td>Calls per second</td><td>5 QPS</td></tr><tr><td>Number of calls per 24 h</td><td>2500</td></tr></tbody></table></div></div><p><br class="table-break">
        </p><p>
            </p><div class="table"><a name="idp51878896"></a><p class="formal-object-title"><span class="label">Table A.2: </span><span class="title">Google rate limits with a valid geocoding API key</span></p><div class="table-contents"><table summary="Google rate limits with a valid geocoding API key" border="1"><colgroup><col width="265pt" class="c1"><col width="120pt" class="c2"></colgroup><thead><tr><th>Type of limit</th><th>Limit</th></tr></thead><tbody><tr><td>Calls per second</td><td>5 QPS</td></tr><tr><td>Number of calls per 24 h</td><td>2500</td></tr></tbody></table></div></div><p><br class="table-break">
        </p><p>In order to increase these limits it is necessary to purchase a commercial API key.
            The API key is then entered in the configuration file. For commercial keys (requires
            billing information) the limits are</p><p>
            </p><div class="table"><a name="idp51889264"></a><p class="formal-object-title"><span class="label">Table A.3: </span><span class="title">Google rate limits with billing information geocoding API key</span></p><div class="table-contents"><table summary="Google rate limits with billing information geocoding API key" border="1"><colgroup><col width="265pt" class="c1"><col width="120pt" class="c2"></colgroup><thead><tr><th>Type of limit</th><th>Limit</th></tr></thead><tbody><tr><td>Calls per second</td><td>10 QPS</td></tr><tr><td>Number of calls per 24 h</td><td>100,000</td></tr></tbody></table></div></div><p><br class="table-break">
            
        </p><p>
            </p><div class="table"><a name="idp51898992"></a><p class="formal-object-title"><span class="label">Table A.4: </span><span class="title">Google rate limits for Static Maps with either free API key or anonymous call</span></p><div class="table-contents"><table summary="Google rate limits for Static Maps with either free API key or anonymous call" border="1"><colgroup><col width="265pt" class="c1"><col width="120pt" class="c2"></colgroup><thead><tr><th>Type of limit</th><th>Limit</th></tr></thead><tbody><tr><td>Calls per second</td><td>5 QPS</td></tr><tr><td>Number of calls per 24 h</td><td>25,000</td></tr></tbody></table></div></div><p><br class="table-break">
            
        </p><p>To either get a developer API key (free of charge - but the same limits as anonymous
            calls) or purchase a commercial key it is necessary to first get a Google account. A
            simplified instruction on how to get a Google API key can be found below. However it is
            strongly recommended you familiarize yourself with the developer console. From the
            console it is possible to see usage statics for the key as well as quota left. For more
            information on keys and developer console please refer to <a class="link" href="https://developers.google.com/console/help/new/" target="_top"> Google Developers Console Help</a></p><p><span class="bold"><strong>How to create a Google developer API key</strong></span></p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Login to Google using your Google account.</p></li><li class="listitem"><p>Go to the <a class="link" href="https://console.developers.google.com/project" target="_top">Developers Console</a></p></li><li class="listitem"><p>Create a new project</p></li><li class="listitem"><p>When the project has been created a dashboard of options are now
                        displayed. Click on "<code class="literal">Enable an API</code>" and search in the
                        list for "<code class="literal">Geocoding API</code>" and enable it.</p></li><li class="listitem"><p>Click "<code class="literal">Credentials</code>" in the left panel and click on
                        "<code class="literal">Create new Key</code>" button</p></li><li class="listitem"><p>Adjust any restrictions on the key (for example which servers are allowed
                        to send requests using this key)</p></li></ol></div><p>
        </p><p>After the key has been created then the APIs allowed with this key must be enabled. In
            order to use the Geolocation lookup and the static maps the following APIs must be
            enabled</p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Geocoding API</strong></span> (for address lookup)</p></li><li class="listitem"><p><span class="bold"><strong>Static Maps API </strong></span>(for minimaps in
                        mail)</p></li></ul></div><p>
        </p><p>The detailed on how to enable the specific APIs dependes on if the new or old Google
            console web inetrface is used and is not further discussed here.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For the static map lookup the rates are much higher (at the time of writing
                    25,000 static maps per 24/h limited by 5 QPS). However Google states that if
                    they see a continues use for more than 90 days of the maximum level they will
                    get in touch to discuss commercial options.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.mail-templates"></a>A.3 Mail templates</h3></div></div></div><p>As of version 2.1.0 there are three possibilities to send mails from the
            daemon.</p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>when the daemon receives an event from the tracker that is not a normal
                        track event or the reply from a user requested location. In all other
                        instances when the daemon receives an event an email will be generated. See
                        also the config setting for
                        <code class="literal">force_mail_on_all_events</code>.</p></li><li class="listitem"><p>when the user requests a mail with a exported and compressed version of
                        the tracking database</p></li><li class="listitem"><p>when the user requests a mail with the last stored location in the
                        tracking database</p></li></ol></div><p>
        </p><p>For each of these possibilities the mail sent is based on a template. The mail
            templates are stored in the config directory (normally
                <code class="filename">/usr/share/g7ctrl/mail_templates</code>) . There are always two versions of
            each template one <acronym class="acronym">HTML</acronym> version and one plain text version. When an
                <acronym class="acronym">HTML</acronym> mail is sent the plain text version is also included as
            alternative content in case the end recipient mail client cannot interpret
                <acronym class="acronym">HTML</acronym>. Also if the configuration setting used
                "<code class="literal">use_html</code>" is false only plain text mail will be sent.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default no mail will be sent on event 0, 1 or 2. This can however be
                    overridden in the configuration file with the
                        <code class="literal">force_mail_on_all_event</code> flag. For a list of event please
                    see <a class="xref" href="#section.event-scripts" title="A.4 Event-scripts">Section A.4</a>.</p></div><p>
        </p><p>Each template is an ordinary file in either <acronym class="acronym">HTML</acronym> or plain text.
            Placeholder in the text will be replaced by the actual data when the mail are sent. The
            following keywords will be replaced in the templates.</p><p>
            </p><div class="table"><a name="idp51940064"></a><p class="formal-object-title"><span class="label">Table A.5: </span><span class="title">Mail keywords</span></p><div class="table-contents"><table summary="Mail keywords" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th>Keyword</th><th>Meaning</th></tr></thead><tbody><tr><td><code class="literal">[EVENTDESC]</code></td><td>Description of event</td></tr><tr><td><code class="literal">[EVENTCMD]</code></td><td>Device command related to the event</td></tr><tr><td><code class="literal">[DATETIME]</code></td><td>The date and time of the event</td></tr><tr><td><code class="literal">[LAT]</code></td><td>Latitude at event</td></tr><tr><td><code class="literal">[LONG]</code></td><td>Longitude at event</td></tr><tr><td><code class="literal">[NICK_DEVID]</code></td><td>Device ID and optional nick name of reporting tracker</td></tr><tr><td><code class="literal">[HEADING]</code></td><td>Heading as reported by tracker</td></tr><tr><td><code class="literal">[SAT]</code></td><td>Number of satellites used for position fix</td></tr><tr><td><code class="literal">[VOLTAGE]</code></td><td>Battery voltage (Voltage under 3.7V is considered low)</td></tr><tr><td><code class="literal">[SERVERNAME]</code></td><td>The name of the server</td></tr><tr><td><code class="literal">[SERVERTIME]</code></td><td>The time at the server</td></tr><tr><td><code class="literal">[DISK_SIZE]</code></td><td>Size of disk partition where the database is stored</td></tr><tr><td><code class="literal">[DISK_USED]</code></td><td>Used size of disk partition</td></tr><tr><td><code class="literal">[DISK_PERCENT_USED]</code></td><td>Used size in percent</td></tr><tr><td><code class="literal">[DAEMONVERSION]</code></td><td>Daemon version</td></tr><tr><td><code class="literal">[NICK]</code></td><td>Nick name if available, device ID otherwise</td></tr><tr><td><code class="literal">[NICK_DEVID]</code></td><td>Both nick name and device ID if available as "NICK (DEVID)"
                                otherwise just "DEVID" if nick not available</td></tr><tr><td><code class="literal">[SYSTEM_LOADAVG]</code></td><td>System load average string</td></tr><tr><td><code class="literal">[APPROX_ADDRESS]</code></td><td>The approximate street address corresponding to the
                                coordinates.</td></tr><tr><td colspan="2"><span class="italic"><span class="bold"><strong>The following placeholders are only for the
                                            <code class="filename">mail_event_img.html</code>
                                        template</strong></span></span></td></tr><tr><td><code class="literal">[CID01]</code></td><td>The HTML image id for the overview map</td></tr><tr><td><code class="literal">[CID01]</code></td><td>The HTML image id for the detailed map</td></tr><tr><td><code class="literal">[IMG_WIDTH]</code></td><td>The width of the map image</td></tr><tr><td><code class="literal">[IMG_HEIGHT]</code></td><td>The height of the map image</td></tr><tr><td><code class="literal">[ZOOM_OVERVIEW]</code></td><td>Zoom factor for overview map</td></tr><tr><td><code class="literal">[ZOOM_DETAILED]</code></td><td>Zoom factor for detailed map</td></tr></tbody></table></div></div><p><br class="table-break">
        </p><p>To adjust the template just make a copy of the original templates as a backup and use
            your favourite editor to adjust the templates as requested. Please note that the name
            and/or the file endings can not be changed. The templates used are:</p><p>
            </p><div class="table"><a name="idp51989120"></a><p class="formal-object-title"><span class="label">Table A.6: </span><span class="title">Mail templates</span></p><div class="table-contents"><table summary="Mail templates" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th>Template name</th><th>Usage</th></tr></thead><tbody><tr><td><code class="filename">mail_event.html</code></td><td>Used for all event mails</td></tr><tr><td><code class="filename">mail_event.txt</code></td><td> </td></tr><tr><td><code class="filename">mail_event_img.html</code></td><td>Used for event mail with minimap</td></tr><tr><td><code class="filename">mail_event_img.txt</code></td><td> </td></tr><tr><td><code class="filename">mail_with_export_attachment.html</code></td><td>Used to send exported database</td></tr><tr><td><code class="filename">mail_with_export_attachment.txt</code></td><td> </td></tr><tr><td><code class="filename">mail_lastloc.html</code></td><td>Used for sending the last received location (<span class="command"><strong>db
                                    mailpos</strong></span>)</td></tr><tr><td><code class="filename">mail_lastloc.txt</code></td><td> </td></tr><tr><td><code class="filename">mail_tracker_conn,html</code></td><td>Used for new tracker connection (if enabled)</td></tr><tr><td><code class="filename">mail_tracker_conn.txt</code></td><td> </td></tr><tr><td><code class="filename">mail_quotalimit.html</code></td><td>Used to notify about whenGoogle API limit is exceeded</td></tr><tr><td><code class="filename">mail_quotalimit.txt</code></td><td> </td></tr></tbody></table></div></div><p><br class="table-break">
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please remember that mail functionality requires you to adjust the parameters
                    in the <code class="literal">[mail]</code> section of the <code class="filename">g7ctrl.conf</code>
                    in accordance with your setup.</p></div><p>
        </p><p>
            </p><div class="figure"><a name="fig.mail_event_img"></a><div class="figure-contents"><div class="mediaobject"><img src="event_mail_with_minimap_large.png" width="500" alt="An example of the HTML event mail with the minimap included"></div></div><p class="formal-object-title"><span class="label">Figure A.1: </span><span class="title">An example of the HTML event mail with the minimap included</span></p></div><p><br class="figure-break">
        </p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>HTML mails use CSS to style the look &amp; feel. Unfortunately many email
                    client can only handle CSS as inline style and not in a separate CSS section
                    which makes the HTML templates quite verbose since the same style has to be
                    repeated at every applicable location.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.event-scripts"></a>A.4 Event-scripts</h3></div></div></div><p>Using an event scripts is a way to have the daemon execute a user specified action
            when triggered by an event from the device. All event scripts are stored in the static
            data directory (normally "<code class="filename">/usr/share/g7ctrl/event_scripts/</code>"). By
            default there are null actions for all events in a number of templates and hence the
            administrator has to decide if any and in thta case what should be done when certain
            events happen. Each event script is named according to the rule
                "<code class="filename">&lt;event_number&gt;_action.sh</code>". So for example the action done
            when receiving event number 2 is "<code class="filename">2_action.sh</code>".</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default a number of templates for the possible action scripts are supplied.
                    To enable action scripts you must copy the template to a new file with just the
                        "<code class="literal">.sh</code>" suffix. Event scripts are written as regular shell
                    scripts and requires knowledge of <acronym class="acronym">GNU</acronym> command line Linux shell scripting. </p></div><p>
        </p><p>The events with the corresponding action scripts together with the related device
            command are:</p><p>
            </p><div class="table"><a name="idp52030752"></a><p class="formal-object-title"><span class="label">Table A.7: </span><span class="title">Device events</span></p><div class="table-contents"><table summary="Device events" border="1"><colgroup><col class="c1"><col class="newCol2"><col class="c2"><col class="newCol3"></colgroup><thead><tr><th>Event</th><th>Script name</th><th>Description</th><th>Related device command</th></tr></thead><tbody><tr><td>0</td><td><code class="filename">0_action.sh</code></td><td>Position data</td><td>GETLOCATION</td></tr><tr><td>1</td><td><code class="filename">1_action.sh</code></td><td>Logging data (location that has been stored in device
                                memory)</td><td>REC</td></tr><tr><td>2</td><td><code class="filename">2_action.sh</code></td><td>Track position data</td><td>TRACK</td></tr><tr><td>4</td><td><code class="filename">4_action.sh</code></td><td>Timer report</td><td>PSMT</td></tr><tr><td>34</td><td><code class="filename">34_action.sh</code></td><td>Wake Up Report</td><td>PSMT</td></tr><tr><td>37</td><td><code class="filename">37_action.sh</code></td><td>Enter Sleeping Report</td><td>PSMT</td></tr><tr><td>40</td><td><code class="filename">40_action.sh</code></td><td>Internal Battery Low Alert</td><td>LOWBATT</td></tr><tr><td>48</td><td><code class="filename">48_action.sh</code></td><td>Geo Fence Crossing Event</td><td>GFEN</td></tr><tr><td>100</td><td><code class="filename">100_action.sh</code></td><td>Unit Detaching Report</td><td>SETRA</td></tr><tr><td>-</td><td><code class="filename">tracker_conn.sh</code></td><td>Run (if enabled in config) when a new tracker connection is
                                detected-</td><td>-</td></tr></tbody></table></div></div><p><br class="table-break">
        </p><p>The scripts will receive the <code class="literal">deviceid</code>, <code class="literal">datetime</code>,
                <code class="literal">latitude</code> and <code class="literal">longitude</code> as command line
            arguments to be used in the scripts. The supplied script templates does not perform any
            action but contains a skeleton to make it easy to adapt and also shows how to make use
            of the supplied arguments.</p><p>One interesting application can be to have an event trigger a sound to be played as is
            shown in in the <code class="filename">100_action.sh</code> script although it is commented out
            since it assumes the existence of a <acronym class="acronym">MP3</acronym> audio file and a command line
            argument to play it. </p><p>As an example the following listing shows the supplied template for
                <code class="filename">"0_action.sh.template"</code></p><pre class="programlisting">#!/bin/sh
# 
# File:   0_action.sh.template
# Desc:   Template for event 0 Position event (GETLOCATION) 
#         There are four argument to this script:
#         -t datetime    Datetime for event
#         -d deviceid    Device Id
#         -l latitude    Latitude for event
#         -n longitude   Longitude of event  
#         -m nick        Nickname (if defined)
#
# SVN:    $Id$
#
# Note: This is just a TEMPLATE that can be modified to do
# specific actions when event is received.
#-----------------------------------------------------------


#-----------------------------------------------------------
# Get options
# Note: The daemon will supply this argument to the script
#-----------------------------------------------------------

datetime=
deviceid=
lat=
lon=
nick=
while getopts t:d:l:n: o
do  case "$o" in
    t)      datetime="$OPTARG"
            ;;
    d)      deviceid="$OPTARG"
    	    ;;
    l)      lat="$OPTARG"
	    ;;
    n)      lon="$OPTARG"
	    ;;
    m)      nick="$OPTARG"
	    ;;
    [?])    printf &gt;&amp;2 "Usage; $0 -t datetime -d deviceid -l lat -n lon -m nick\n"
            exit 1
            ;;
    esac
done

if test -z "$datetime" -o -z "$deviceid" -o -z "$lat" -o -z "$lon"; then
    printf &gt;&amp;2 "Usage; $0 -t datetime -d deviceid -l latitude -n longitude\n"
    exit 1
fi

#-----------------------------------------------------------
# Here should the real actions happen
#-----------------------------------------------------------

# Your action ....
#  echo "datetime=$datetime, deviceid=$deviceid, lat=$lat, lon=$lon\n" 

# Normal exit from the script
exit 0





</pre><p>In the supplied template it is clearly marked where you are supposed to enter you
            script lines. In order to play a warning sound on your computer whenever for example the
            low battery event is happening assuming you have an appropriate sound file called
                "<code class="filename">warning-signal.mp3</code>" just add the following lines to
                <code class="filename">40_action.sh</code> (copied from
                <code class="filename">40_action.sh.template</code></p><p>
            </p><pre class="screen">mpg123 warning-signal.mp3 &gt; /dev/null 2&gt;&amp;1 &amp;</pre><p>
        </p><p>Remember that if you have mail on event enabled (See <a class="xref" href="#section.mail-templates" title="A.3 Mail templates">Section A.3</a>) then that event will also generate an
            automatic mail notification.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><span class="bold"><strong>TECHNICAL:</strong></span> Each script is run in its own
                    thread (from version 2.1.4 and forward) so there is no need to consider limiting
                    the running time of the script.</p></div><p>
        </p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.trouble-shooting"></a>Appendix B - Troubleshooting</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51264768"></a>B.1 The server is not receiving any location data</h3></div></div></div><p>Most likely caused by a router not forwarding the external port to the server or a
            firewall that is blocking the data. The method to locate such an issue is to start
            connection from the inside and then try one step out at a time until the problem can be
            repeated.</p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Check that the <acronym class="acronym">IP</acronym> address is correct and that the
                        daemon is able to received data.</p><p>This is most easily checked by trying to manually add a location update to
                        the daemon. First try to add a location update from the same server as the
                        one daemon is running on by using the command '<span class="command"><strong>nc</strong></span>' (net
                        cat) command which is a staple tool when it comes to network
                        troubleshooting.</p><p>For example if you have used the default port try</p><p>
                        </p><pre class="screen">&gt; nc localhost 3400</pre><p>
                    </p><p>The command above should just show an empty line indicating that the
                        connection to the server was successfull and that it is now awaiting som
                        more data, i.e. the screen should look like this</p><p>
                        </p><pre class="screen">&gt; nc localhost 3400

</pre><p>
                    </p><p>Precc '<span class="command"><strong>Ctrl-C</strong></span>' to stop the net-cat from running. We
                        have now established that the daemon is indeed listening on the correct port
                        on the server. The next step is to try to send "fake" location update string
                        manually. Since the daemon expects the incoming data to be terminated by
                            '<code class="literal">\r\n</code>' we use the <span class="command"><strong>printf</strong></span>
                        command.</p><p>
                        </p><pre class="screen">&gt; printf "3000000001,20131211002222,14.959445,58.366545,0,0,0,0,2,3.92V,0\r\n" |  
nc localhost 3400</pre><p>
                    </p><p>Now review the logs for the daemon to see if this location update was
                        correctly received. If this does not work then use the following
                        steps:</p><p>
                        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>double check that the port number is correct to what you have
                                    set in the configuration file for the daemon. </p><p>When this is correct continue with next step.</p></li><li class="listitem"><p>try to connect to the daemon from within your own network but
                                    from a different server than the one running the daemon. If this
                                    does not work then the problem is most likely a firewall issue
                                    on your server running the daemon. </p><p>When this works continue with next step.</p></li><li class="listitem"><p>try to connect to your server from outside your own network.
                                    This will verify that your router(s) are sending through the
                                    data correctly to your server running the daemon. If this
                                    doesn't work verify your router setting so that the correct port
                                    is forwarded to the server running the daemon.</p></li></ol></div><p>
                    </p><p>If all of this works and you can send update string to your daemon
                        manually but you are still not seeing any connectsions from the device then
                        most likely the tracker device settings is missconfigured. Check your SIM
                        card provider for correct APN and a DNS server to use as well as the address
                        the tracker should connect to.</p></li></ul></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51477584"></a>B.2 The device is not connected via USB</h3></div></div></div><p>Most likely this is caused by wrong <acronym class="acronym">USB</acronym> index. </p><p><span class="bold"><strong>On Linux:</strong></span></p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Make sure that the device is not connected to your computer.</p></li><li class="listitem"><p>List all <code class="literal">ttyACM&lt;n&gt;</code> devices with</p><p>
                        </p><pre class="screen">&gt; ls /dev/ttyACM*</pre><p>
                    </p></li><li class="listitem"><p>Connect the device via <acronym class="acronym">USB</acronym>.</p></li><li class="listitem"><p>Again list all <code class="literal">ttyACM&lt;n&gt;</code> devices and compare the
                        output from above. This should show you what the <acronym class="acronym">USB</acronym>
                        connection the device connects on. Now change the <acronym class="acronym">USB</acronym>
                        index (in the config file or on the command line) to match the number of the
                            <code class="literal">ttyACM&lt;n&gt;</code></p></li><li class="listitem"><p>Make sure the user running the daemon have read/write privileges on the
                        device</p></li></ul></div><p>
        </p><p><span class="bold"><strong>On Apple OS X:</strong></span></p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The device is one of the "<code class="filename">/dev/cu.usbmodem????</code>"
                        devices where the question mark is a 4 digit number that depends on where
                        you plugged the device in. Example of full paths are
                            "<code class="filename">/dev/cu.usbmodem1411</code>" and
                            "<code class="filename">/dev/cu.usbmodem1451</code>". </p></li><li class="listitem"><p>The number to be specified in the config file are the last four
                        digits</p></li></ul></div><p>
        </p><p>In general if a connection cannot be established review the log file (default
                <code class="filename">/usr/share/g7ctrl/f7ctrl.log</code>) which might reveal further
            information.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please remember to wait at least 20 s after the device has been plugged in to
                    allow it to establish a connection before you try to send a command.</p></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51496576"></a>B.3 An error "port is in use" is shown</h3></div></div></div><p>This means that there is a conflict between the port the daemon is trying to use and
            one of your other applications. In order to find out what application is using what port
            the easiest command that accomplish this is most likely</p><p>
            </p><pre class="screen">&gt; sudo netstat -tulpn </pre><p>
        </p><p>To find out open files use "<span class="command"><strong>lsof</strong></span>"</p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.command-reference"></a>Appendix C - Command reference</h2></div></div></div><p>There commands are divided into three different areas</p><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Device commands. They are commands that controls a connected device</p></li><li class="listitem"><p>Database commands. Commands to export and read the database</p></li><li class="listitem"><p>Preset commands. Commands to manipulate presets</p></li><li class="listitem"><p>Daemon commands. Commands to act on the daemon itself.</p></li></ol></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51373312"></a>C.1 Device Command reference</h3></div></div></div><p>Below is the commands possible together with there parameters. In case a command can
            accept argument the daemon will ask for each command in sequence. The prompt will always
            be indicated by a "<code class="literal">?</code>" mark. To abort a specific command just type a
            single dot "<code class="literal">.</code>" and the command shell will return to the start
            position (outer level). Most commands only accept a selected value chosen from a list.
            All possible values in the lists are shown below.</p><p>
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>All command example below is shown as they would appear when using the command
                    shell "<span class="command"><strong>g7sh</strong></span>"</p></div><p>
        </p><p>For even more detailed command information please refer to the "<span class="italic">GM7 Protocol specification</span>" available from where you
            purchased your device.</p><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Typing "<code class="literal">help </code>&lt;command-name&gt;" will give you detailed help
                    for each command in the daemon.</p></div><p>
        </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.address"></a>C.1.1 <span class="command"><strong>address</strong></span></h4></div></div></div><p>Reead the current location and return an approximate street address. The lookup
                uses Google maps and is usually accurate within 50meters but this depends heavily on
                the location since addresses in general tend to be less accurate in for example the
                countryside.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p>
                <span class="command"><strong>get address</strong></span>
            </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt;  get address
78 Bell Street, NW16TB London</pre><p>
            </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.loc" title="C.1.11 loc">Section C.1.11</a>, <a class="xref" href="#cmd.locg" title="C.1.12 locg">Section C.1.12</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.batt"></a>C.1.2 <span class="command"><strong>batt</strong></span></h4></div></div></div><p>Read the battery voltage from connected device.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p>
                <span class="command"><strong>get batt</strong></span>
            </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; get batt
3.71V</pre><p>
            </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.loc" title="C.1.11 loc">Section C.1.11</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.clrec"></a>C.1.3 <span class="command"><strong>clrec</strong></span></h4></div></div></div><p>Erase all recorded locations in device memory. Use
                            <code class="literal">dlrec</code> to read back the recorded location positions in
                        device memory to the database.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p>
                        <span class="command"><strong>do clrec</strong></span>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; do clrec
Done.</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.dlrec" title="C.1.6 dlrec">Section C.1.6</a>, <a class="xref" href="#cmd.nrec" title="C.1.15 nrec">Section C.1.15</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.comm"></a>C.1.4 <span class="command"><strong>comm</strong></span></h4></div></div></div><p>Set/Read device communication type and its parameters</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] comm</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>CommSelect</em></span> - Select primary type of
                                    communication </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Use USB" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Use SMS over GSM"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "CSD (reserved)" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "UDP over GPRS" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>4</code></em> - "TCP/IP over GPRS"
                                            </p></li></ul></div></li><li class="listitem"><p>
                            <span class="emphasis"><em>SMS Base Phone</em></span> - <acronym class="acronym">SMS</acronym> base number
                            to call </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>CSD Base Phone</em></span> - <acronym class="acronym">CSD</acronym> base number
                            (reserved and not used) </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>GPRS APN</em></span> - The operators <acronym class="acronym">APN</acronym> .
                            This must be specified in order to use a <acronym class="acronym">GPRS</acronym> data
                            connections. The value of this parameter must be got from the carrier
                            used.</p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>GPRS User</em></span> - User name if required </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>GPRS Passwd</em></span> - Password if required </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>GPRS Server</em></span> - Server <acronym class="acronym">IP</acronym> address
                            where the device reports back to. If you specify a fully resolved domain
                            name here then you must also specify a <acronym class="acronym">DNS</acronym> server for
                            the device to use as the  <span class="emphasis"><em>GPRS DNS</em></span> argument
                            below.</p></li><li class="listitem"><p>
                            <span class="emphasis"><em>GPRS Server Port</em></span> - <acronym class="acronym">TCP/IP</acronym> Port
                            to use on server must be the same as set in the configuration
                            file.</p></li><li class="listitem"><p>
                            <span class="emphasis"><em>GPRS Keep Alive</em></span> - Interval (in seconds) between
                                <span class="italic">Keep Alive Packets</span> These packets
                            are empty data packets sent from the device back to the server to
                            maintain the connection if if no actual data has to be sent. The time
                            interval between the packets needed depends on how aggressively the
                            carrier is reclaiming <acronym class="acronym">IP</acronym> addresses. Usually it should
                            be between 30-90 seconds even though with some carriers you could get
                            away with up to 120-150s. You would normally want this time to be as
                            large as is safe in order to conserve energy in the device. </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>GPRS DNS</em></span> - Optional DNS server for device
                                    to use. </p><p>
                            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Use one of <span class="org">
                                        <span class="orgname"><a class="orgname" href="https://developers.google.com/speed/public-dns/" target="_top">Googles</a></span>
                                    </span> open <acronym class="acronym">DNS</acronym> servers here,
                                        '<code class="literal">8.8.8.8</code>' and
                                    '<code class="literal">8.8.4.4</code>', if your carrier doesn't have other
                                    specific recommendations.</p></div><p>
                        </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get comm
[GM7] COMMTYPE=0,,,,,,,0,0,</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.config"></a>C.1.5 <span class="command"><strong>config</strong></span></h4></div></div></div><p>Set/Read device ID, Password, and PIN Code of the SIM card</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] config</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Device ID</em></span> - Set device ID (leftmost digit
                                    must always be 3) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Device Password</em></span> - Set device Password
                                    (numeric) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>SIM Card PIN</em></span> - The SIM cards PIN code to
                                    use </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get config
[GM7] UNCFG=3000000001,0000,</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.dlrec"></a>C.1.6 <span class="command"><strong>dlrec</strong></span></h4></div></div></div><p>Download all recorded position in device memory to the database. Positions
                        that have been downloaded from the device memory in this way will have an
                        event id of <code class="literal">1</code>. During the download a progress for each
                        10% of the total number of locations downloaded will be printed.</p><p>After the dataset is imported from the device a check is made in the DB for
                possible duplicates. This makes it possible to do repeatable downloads without
                deleting old locations in the device and still only have the new locations remaining
                in the DB. </p><p>
                        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please note that download and DB update takes a bit of time. The
                                device is capable of a throughput (when reading out data) of just
                                below 40kB/s which translates to approx. 550 locations/s. This means
                                that, for example, 10,000 locations take just below 20s to read. The
                                DB update thereafter is for all practical purposes instantaneous. </p><p>The device itself have capacity to store more than 100,000
                        locations, which for example translates to roughly 4 month if a positions
                        fix is taken every other minute.</p></div><p>
                    </p><p>
                </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>If address lookup is used be aware that since Google open Web services has
                        usage restrictions both in tems of rate and absolute number of lookpus per
                        24 hour. The lookup is throttled not to send more than 9-10 requests per
                        second since otherwise the Google APIs will return an error indicating to
                        high usage. The limit per 24 hour is around 5000 lookups (roughly) which is
                        quite easy to exceed when importing locations with a high freuqency. This
                        will limit the rate of DB update to roughly 1000 location imports per 3
                        minutes.</p><p>There are two ways around that. 1) You can request and purchase an API key
                        which will allows a much higher throughput and absolut number of lookups per
                        24 hours or you can 2) disable the address lookup when doing bulk import
                        from the device using the ".<span class="command"><strong>address</strong></span>" command See <a class="xref" href="#cmd.address-toggle" title="C.4.1 .lookup">address</a>.</p></div><p>
            </p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>do dlrec</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; do dlrec
Preparing, please wait ...
Reading 1144 locations from device, please wait ...
[0%].[10%].[20%].[30%].[40%].[50%].[60%].[70%].[80%].[90%].[100%]
Storing a copy of read locations in "/tmp/gm7_last_dlrec.txt" ...
Updating DB. Address lookup used  ...
[0%].[10%].[20%].[30%].[40%].[50%].[60%].[70%].[80%].[90%].[100%]
Checking for duplicates ...
1144 locations imported.
Total time: 3:37 min (Device read: 0:06 min, DB Update: 3:31 min)
</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.clrec" title="C.1.3 clrec">Section C.1.3</a>, <a class="xref" href="#cmd.nrec" title="C.1.15 nrec">Section C.1.15</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.geofevt"></a>C.1.7 <span class="command"><strong>gfevt</strong></span></h4></div></div></div><p>Enable/Disable/Set/Read GEO-Fencing event. This allows up to 50 (numbered
                50-99) events to be specified. An geographic event is the entering/exiting of a
                specified area centered at the specified latitude, longitude with a specified
                radius.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set gfevt</strong></span></p><p><span class="command"><strong>get gfevt EVENTID</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Event ID</em></span> - Event ID. Maximum of 50 events.
                                    In range 50-99 </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Enabled</em></span> - Enable/Disable evenet </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Longitude</em></span> - Longitude for center of event
                                    zone </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Latitude</em></span> - Latitude for center of event
                                    zone </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Radius</em></span> - Radius of event zone in meters
                                    (0-65535) </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>ZoneControl</em></span> - How to trigger event </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Entering zone" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Leaving zone" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Action</em></span> - What to do on event </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Log to device" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Send to server" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Both log and send"
                                            </p></li></ul></div></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get gfevt 50</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.gfen" title="C.1.8 gfen">Section C.1.8</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.gfen"></a>C.1.8 <span class="command"><strong>gfen</strong></span></h4></div></div></div><p>Enable/Disabling GEO-fencing functionality</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set gfen [ on | off ] </strong></span></p><p><span class="command"><strong>get gfen</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Enabled</em></span> - Turn option on/off </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Radius</em></span> - Radius in meter for fence </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Zone trigger</em></span> - Trigger when leaving or
                                    entering zone </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Inside zone" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Outside zone" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Report action</em></span> - What to do on event </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Disabled" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Log to device" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Send to server" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Both log and send"
                                            </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP mask</em></span> - Bitmask of VIP numbers to alert
                                    . Phone number are numbered from left to right as 1,2,4,8,16 For
                                    example to alert phone number 1 and 3 give the value (1 | 4 ) =
                                    5</p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get gfen
[GM7] GFEN=0,150,2,0,0</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.geofevt" title="C.1.7 gfevt">Section C.1.7</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.imei"></a>C.1.9 <span class="command"><strong>imei</strong></span></h4></div></div></div><p>Query the IMEI number of the internal GSM module</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get imei</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get imei
[GM7] 912964059600079</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.sim" title="C.1.23 sim">Section C.1.23</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.led"></a>C.1.10 <span class="command"><strong>led</strong></span></h4></div></div></div><p>Enable/Disable the LED indicator on/off</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set led [ on | off ] </strong></span></p><p><span class="command"><strong>get led</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get led
[GM7] ELED=0</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.loc"></a>C.1.11 <span class="command"><strong>loc</strong></span></h4></div></div></div><p>Get latest location</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get loc</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get loc
[GM7] 3000000001,20140110001836,17.959366,59.367183,0,180,0,0,0,4.10V,0</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.locg" title="C.1.12 locg">Section C.1.12</a>,<a class="xref" href="#cmd.address" title="C.1.1 address">Section C.1.1</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.locg"></a>C.1.12 <span class="command"><strong>locg</strong></span></h4></div></div></div><p>Get the latest position as a Google map link</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get locg</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get locg
https://www.google.com/maps?q=57.963183,18.152366</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.loc" title="C.1.11 loc">Section C.1.11</a>,<a class="xref" href="#cmd.address" title="C.1.1 address">Section C.1.1</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.lowbatt"></a>C.1.13 <span class="command"><strong>lowbatt</strong></span></h4></div></div></div><p>Set/Read the internal battery low level alert</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set lowbatt &lt;report-action&gt; &lt;VIP-mask&gt;</strong></span></p><p><span class="command"><strong>get lowbatt</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Report action</em></span> - Action to perform at low
                                    battery voltage </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Disable" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Log on device" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Send back to server"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Both log and send back
                                                ro server" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP mask</em></span> - Bitmask of VIP numbers to alert
                                </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get lowbatt
[GM7] LOWBATT=3,7</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.mswitch"></a>C.1.14 <span class="command"><strong>mswitch</strong></span></h4></div></div></div><p>Enable/Disable detached report (when the device detect that it has bee
                        detached from its position by affecting the micro switch under the
                        magnet)</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set mswitch &lt;report-action&gt; &lt;VIP-mask&gt;</strong></span></p><p><span class="command"><strong>get mswitch</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                            <span class="emphasis"><em>Report action</em></span> - Action to perform when detachment
                            is detected</p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                        <em class="parameter"><code>0</code></em> - "Disable" </p></li><li class="listitem"><p>
                                        <em class="parameter"><code>1</code></em> - "Log on device" </p></li><li class="listitem"><p>
                                        <em class="parameter"><code>2</code></em> - "Send back to server" </p></li><li class="listitem"><p>
                                        <em class="parameter"><code>3</code></em> - "Both log and send back ro
                                        server" </p></li></ul></div></li><li class="listitem"><p>
                            <span class="emphasis"><em>VIP mask</em></span> - Bitmask of VIP numbers to alert </p></li></ul></div><p>
            </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get mswitch
[GM7] SETRA=3,7</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.nrec"></a>C.1.15 <span class="command"><strong>nrec</strong></span></h4></div></div></div><p>Return date range and number of location records stored in device
                        memory</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get nrec</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get nrec
[GM7] DLREC=17637(20140107231903-20140110002148)</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.dlrec" title="C.1.6 dlrec">Section C.1.6</a>, <a class="xref" href="#cmd.clrec" title="C.1.3 clrec">Section C.1.3</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.phone"></a>C.1.16 <span class="command"><strong>phone</strong></span></h4></div></div></div><p>Enable the function "<span class="italic">Get the current location by
                    making a phone call</span>". This allows one or more of the predefined VIP
                numbers (see ???)  to make a phone call to the device to retrieve the current
                location. After the phone call is finished the device will reply back with a text
                message with the most recent location.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set phone [on | off]</strong></span></p><p><span class="command"><strong>get phone</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Enable/Disable</em></span> this function.</p><p>Possible values and desciption:</p><p>
                            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><em class="parameter"><code>0</code></em> - Disabled</p></li><li class="listitem"><p><em class="parameter"><code>1</code></em> - Enabled</p></li></ul></div><p>
                        </p></li><li class="listitem"><p><span class="emphasis"><em>VIP Number</em></span> - Bitmask for allowed VIP numbers that
                            can make a call to the device</p></li></ul></div><p>
            </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get phone
[GM7] VLOCATION=1,7</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.ps"></a>C.1.17 <span class="command"><strong>ps</strong></span></h4></div></div></div><p>Enable/Disable power saving mode</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] ps</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Mode</em></span> - Select when to enable sleep mode to
                                    save battery </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Sleep after 3min of no
                                                movement. Wake up on movements. GSM=Standby,
                                                GPRS=GPS=Off, G-sensor=On" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Always enter sleep after
                                                3min and wake every n seconds specified.
                                                GSM=GPRS=GPS=G-sensor=Off" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Always enter sleep after
                                                3min and wake up on timer.
                                                GSM=GPRS=GPS=G-sensor=Off" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Always enter sleep after
                                                3min and wake up on movement. GSM=GPRS=GPS=Off,
                                                G-sensor=On" </p></li></ul></div></li><li class="listitem"><p>
                            <span class="emphasis"><em>Sleep interval</em></span> - Used with sleep mode 1, Interval
                            in minutes between wake ups. Range 60-65535</p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Wake up report</em></span> - Action when awaken </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Disable" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Log on device" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Send back to server"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Both log and send back
                                                ro server" </p></li></ul></div></li><li class="listitem"><p>
                            <span class="emphasis"><em>VIP mask</em></span> - Bit mask of VIP numbers to alert on
                            awake </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Timer 1</em></span> - Used with mode=2. 00-23 hr. Makes the
                            tracker wake up at the specified hour on the day.</p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Timer 2</em></span> - Used with mode=2. 00-23 hr. Makes the
                            tracker wake up at the specified hour on the day. </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Timer 3</em></span> - Used with mode=2. 00-23 hr. Makes the
                            tracker wake up at the specified hour on the day. </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get ps
[GM7] PSMT=3,0,1,0,,,,</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.reboot"></a>C.1.18 <span class="command"><strong>reboot</strong></span></h4></div></div></div><p>Restart-up the device</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>do reboot</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; do reboot
Done.</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.rec"></a>C.1.19 <span class="command"><strong>rec</strong></span></h4></div></div></div><p>Enable/Disable/read logging function to the device</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] rec</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Mode</em></span> - When should logging be done </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Disable" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Time mode, log every n
                                                seconds" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Distance mode, log every
                                                n meters" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Time AND Distance mode"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>4</code></em> - "Time OR Distance mode"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>5</code></em> - "Heading mode, logging
                                                starts when heading &gt; set value" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>6</code></em> - "Heading OR Time mode"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>7</code></em> - "Heading OR Distance"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>8</code></em> - "Heading OR (Time AND
                                                Distance)" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>9</code></em> - "Heading OR Time OR
                                                Distance" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Time interval</em></span> - Time interval (in sec) used
                                    in mode setting </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Distance interval</em></span> - Distance interval (in
                                    meters) used in mode setting </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Number of reports</em></span> - The number of reports to send
                            back on event (0=continuous logging) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Record basis</em></span> - Logging mode </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Wait for GPS fix before
                                                sending back report" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Don't wait for GPS fix
                                                before sending back report" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Heading</em></span> - Heading value used in mode
                                    (10-90) </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get rec
[GM7] REC=1,10,0,0,1,15</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.clrec" title="C.1.3 clrec">Section C.1.3</a>, <a class="xref" href="#cmd.dlrec" title="C.1.6 dlrec">Section C.1.6</a>, <a class="xref" href="#cmd.nrec" title="C.1.15 nrec">Section C.1.15</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.reset"></a>C.1.20 <span class="command"><strong>reset</strong></span></h4></div></div></div><p>Reset all parameters to the factory default settings</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>do reset</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; do reset
Done.</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.roam"></a>C.1.21 <span class="command"><strong>roam</strong></span></h4></div></div></div><p>Enable/Disable <acronym class="acronym">GPRS</acronym> roaming function</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set roam [ on | off ] </strong></span></p><p><span class="command"><strong>get roam</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; set roam off
[GM7] ROAMING=0</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.sense"></a>C.1.22 <span class="command"><strong>sens</strong></span></h4></div></div></div><p>Set sensitivity for movement detection as an integer in range [1..5]  where 1 is
                the highest sensitivity and 5 is the lowest. The factory setting is "4",</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[get|set] sens</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; get sens
[GM7] 4</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.sim"></a>C.1.23 <span class="command"><strong>sim</strong></span></h4></div></div></div><p>Query the identification of the <acronym class="acronym">SIM</acronym> card</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get sim</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get sim
[GM7] SIMID=73291534007080101233</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.imei" title="C.1.9 imei">Section C.1.9</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.sleep"></a>C.1.24 <span class="command"><strong>sleep</strong></span></h4></div></div></div><p>Enable/Disable "Sleeping Report"</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set sleep [ on | off ] </strong></span></p><p><span class="command"><strong>get sleep</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Message mode</em></span> - Set how to handle message at
                                    when device enters sleep </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "log message to device"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "send back message"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "both log and send back
                                                message" </p></li></ul></div></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get sleep
[GM7] SLEEP=0</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.sms"></a>C.1.25 <span class="command"><strong>sms</strong></span></h4></div></div></div><p>Switch the SMS format (Text of PDU mode)</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] sms</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Mode</em></span> - Set format for SMS sent back </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Use PDU mode" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Use text mode" </p></li></ul></div></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get sms
[GM7] SMSM=1</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52744624"></a>C.1.26 <span class="command"><strong>test</strong></span></h4></div></div></div><p>Device diagnostic function</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>do test</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; do test
Done.</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.track"></a>C.1.27 <span class="command"><strong>track</strong></span></h4></div></div></div><p>Control if device should be sending back automatic tracking
                        information.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>set track</strong></span></p><p><span class="command"><strong>get track</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Tracking mode</em></span> - Set condition for when
                                    tracking is started </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                        <em class="parameter"><code>0</code></em> - "Disabled"</p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Time mode" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>2</code></em> - "Distance mode" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "Time AND Distance mode"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>4</code></em> - "Time OR distance"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>5</code></em> - "Heading mode" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>6</code></em> - "Heading OR time" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>7</code></em> - "Heading OR distance"
                                            </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>8</code></em> - "Heading OR (Time AND
                                                Distance" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>9</code></em> - "Heading OR Time OR
                                                Distance" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Timer interval</em></span> - Used for mode 1 </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Distance interval</em></span> - Used for mode 2-9
                                </p></li><li class="listitem"><p>
                            <span class="emphasis"><em>Number of trackings</em></span> - Use 0 for continuous tracking </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Track basis</em></span> - Wait for GPS fix or not </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "Send report ONLY if GPS
                                                is fixed" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Send report regardless
                                                of GPS status" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Comm select</em></span> - Set type of report </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                        <em class="parameter"><code>0</code></em> - "Over USB" . <span class="bold"><strong>Currently NOT supported.</strong></span></p></li><li class="listitem"><p>
                                                <em class="parameter"><code>1</code></em> - "Over GSM" </p></li><li class="listitem"><p>
                                        <em class="parameter"><code>2</code></em> - "Reserved (not used)" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>3</code></em> - "UDP over GPRS" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>4</code></em> - "TCP/IP over GPRS"
                                            </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Heading</em></span> - Used for modes 5-9 </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get track
[GM7] TRACK=0,0,0,0,0,0,0</pre><p>
                    </p><p><span class="bold"><strong>See also:</strong></span></p><p><a class="xref" href="#cmd.comm" title="C.1.4 comm">Section C.1.4</a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.tz"></a>C.1.28 <span class="command"><strong>tz</strong></span></h4></div></div></div><p>Set the time zone information for the device</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] tz</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>Sign</em></span> - Ahead or before GMT zone </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>+</code></em> - "Ahead of GMT" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>-</code></em> - "Before GMT" </p></li></ul></div></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Hour</em></span> - Number of hours to adjust (0-9)
                                </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>Min</em></span> - Minutes to adjust </p><p>Possible values and description:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                                                <em class="parameter"><code>0</code></em> - "0 min" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>15</code></em> - "15 min" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>30</code></em> - "30 min" </p></li><li class="listitem"><p>
                                                <em class="parameter"><code>45</code></em> - "45 min" </p></li></ul></div></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get tz
[GM7] SETTZ=+,01,00</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.ver"></a>C.1.29 <span class="command"><strong>ver</strong></span></h4></div></div></div><p>Get current firmware version</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>get ver</strong></span></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get ver
[GM7] VER=M7 2.005 GP rev00c,V2</pre><p>
                    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.vip"></a>C.1.30 <span class="command"><strong>vip</strong></span></h4></div></div></div><p>Preset up to 5 SMS phone numbers for receiving different alerts</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>[ get | set ] vip</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP 1</em></span> - Mobile number 1 (full number incl
                                    country prefix '+' if needed) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP 2</em></span> - Mobile number 2 (full number incl
                                    country prefix '+' if needed) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP 3</em></span> - Mobile number 3 (full number incl
                                    country prefix '+' if needed) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP 4</em></span> - Mobile number 4 (full number incl
                                    country prefix '+' if needed) </p></li><li class="listitem"><p>
                                    <span class="emphasis"><em>VIP 5</em></span> - Mobile number 5 (full number incl
                                    country prefix '+' if needed) </p></li></ul></div><p>
                    </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                        </p><pre class="screen">g7ctrl&gt; get vip
[GM7] SETVIP=,,,,</pre><p>
                    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="appendix.database-commands"></a>C.2 Database commands</h3></div></div></div><p>The database commands are used to manage the stored location updates from the devices.
            All commands operates on the existing DB which is normally stored in directory
                "<code class="filename">/usr/share/g7ctrl/</code>". There are two ways to get locations into
            the database, 1) downloading locations from device memory (see <a class="xref" href="#cmd.dlrec" title="C.1.6 dlrec">Section C.1.6</a>) or 2) receive live updates from the device (see <a class="xref" href="#cmd.track" title="C.1.27 track">Section C.1.27</a>).</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-deletelocations"></a>C.2.1 <span class="command"><strong>db deletelocations</strong></span></h4></div></div></div><p>Delete all stored locations. This command can NOT be undone.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db deletelocations</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-dist"></a>C.2.2 <span class="command"><strong>db dist</strong></span></h4></div></div></div><p>Calculate the <span class="bold"><strong><span class="underline">approximate
                        distance</span></strong></span> traveled using the selected data set of
                location points.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db dist [dev=nnn] [ev=nnn] [from to]</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">[dev=nnn]</code> - Filter on a specific deviceid. If not
                            set all devices will be considered.</p></li><li class="listitem"><p><code class="literal">[ev=nnn]</code> - Filter on specific event. If not set all
                            events will be considered.</p></li><li class="listitem"><p><code class="literal">[from to]</code> - Filter on a specific date range. Dates
                            are given in <code class="literal">YYYY-MM-DD</code> format with optional time
                            specification as <code class="literal">HH:MM</code> in 24h format (military time).
                            If omitted all dates are considered.</p></li></ul></div><p>
            </p><p>Calculation of distance is approximation of the distance between two
                    <acronym class="acronym">GPS</acronym> points (assuming WGS-84 projection) and returns the
                result using both the <span class="italic">Haversine</span> method (great
                circle distance) and <span class="italic">Vincenty</span> method (iterative).
                The reply from the daemon is given as two lines exemplified by</p><p>
                </p><pre class="screen">Calculating approximate distance using 344 points.
25.3 km (alt. 25399.5 m)</pre><p>
            </p><p>The second distance in <code class="literal">m</code> are calculated using the <span class="italic">Vincenty</span> method and the first distance (in
                    <code class="literal">km</code>) is calculated using the <span class="italic">Haversine</span> method.</p><p>Due to the number of error sources in getting location updates and limitations
                inherent in this type of distance calculations <span class="bold"><strong>we can not in
                    general assume to have perfect accuracy</strong></span>. The accuracy will also vary
                depending on the absolute location due to differences in the earth radius. The way
                traveled between recorded positions is assumed to follow the great circle between
                the points so the more points the better approximation of the actual real distance. </p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The precise volatility in the distance figures are very difficult to
                        quantify due to the large number of factors that influence the
                            <acronym class="acronym">GPS</acronym> signal and the way the distance can be
                        calculated. However,practical tests (with the GM7 device) have shown that in
                        general it is safe to assume that the true distance (as measured in the
                        middle part of Sweden around lat 57°) in more than 80% of the cases
                        have less than 5% error compared with the distance as measured by an
                        odometer. If more accuracy is needed in a particular area then field tests
                        with known distances needs to be performed and correction factors
                        introduced.</p><p>Often the distance is slightly underestimated and the longer time interval
                        between each measure the more the distance is underestimated. This is due to
                        the fact that the distance travelled between each measured point is assumed
                        to be the shortest (great circle) distance and in practice the real distance
                        is always longer.</p><p>(The <span class="italic">Vincenity</span> method will generally
                        have better accuracy assuming perfect <acronym class="acronym">GPS</acronym> positions.
                        )</p></div><p>
            </p><p><span class="bold"><strong> Examples: </strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                            </p><pre class="screen">g7ctrl&gt; db dist</pre><p>
                        </p><p>Use all the data points and calculate the total traveled
                            distance</p></li><li class="listitem"><p>
                            </p><pre class="screen">g7ctrl&gt; db dist ev=1 2013-08-01 2013-08-01</pre><p>
                        </p><p>Calculate the traveled distance from the previously imported data
                            points from the internal memory of the device (they will have eventid=1)
                            for the 1:st of August 2013.</p></li><li class="listitem"><p>
                            </p><pre class="screen">g7ctrl&gt; db dist 2013-01-01 2013-12-31 13:00</pre><p>
                        </p><p>Calculate the total distance in DB for 2013 regardless of what event
                            triggered the location update</p></li></ul></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-export"></a>C.2.3 <span class="command"><strong>db export</strong></span></h4></div></div></div><p>Exports the database in the selected format to the named file</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db export [dev=nnn] [ev=nnn] [from to] (gpx|kml|xml|csv|json)
                    [filename]</strong></span></p><p><span class="bold"><strong>Arguments:</strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">[dev=nnn]</code> - Filter on a specific deviceid.
                                    If not set all devices will be considered.</p></li><li class="listitem"><p><code class="literal">[ev=nnn]</code> - Filter on specific event. If not
                                    set all events will be considered.</p></li><li class="listitem"><p><code class="literal">[from to]</code> - Filter on a specific date
                                    range. Dates are given in YYYY-MM-DD format with optional time
                                    specification as <code class="literal">HH:MM</code> in 24h format
                                    (military time). If omitted all dates are considered.</p></li><li class="listitem"><p><code class="literal">(gpx|kml|xml|csv|json)</code> - Export format to
                            use</p><p>
                                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="literal">gpx</code> = Exchange format for GPS
                                                devices. Widely used.</p></li><li class="listitem"><p><code class="literal">kml</code> = Format used to display
                                                tracks on Google earth and Google maps</p></li><li class="listitem"><p><code class="literal">xml</code> = Export all fields in a
                                                custom <acronym class="acronym">XML</acronym> format. See separate
                                                schema docs (<a class="xref" href="#appendix.technical" title="Appendix D - Technical information">Appendix D</a>). This schema has the advantage of including all
                                                information from the location updates such as
                                                included battery voltage and detach button status.
                                            </p></li><li class="listitem"><p><code class="literal">csv</code> = Export in comma separated
                                                format. Useful for importing into spreadsheets for
                                                post processing</p></li><li class="listitem"><p><code class="literal">json</code> = Export in JSON format. Useful
                                        for Web based post-processing.</p></li></ol></div><p>
                                </p></li><li class="listitem"><p><code class="literal">[filename]</code> - Full filename path to export
                                    to. If omitted the data will be exported to
                                        <code class="filename">/usr/share/g7ctrl/export.&lt;format&gt;</code>
                                    The file name must be either have an absolute path or no path.
                                    Relative paths are not allowed. If no path is specified then the
                                    current DB directory is used (by default
                                        <code class="filename">/usr/shar/g7ctrl</code>). If no file suffix is
                                    given the the export format will be added as file suffix.</p></li></ul></div><p>
                    </p><p><span class="bold"><strong> Examples: </strong></span></p><p>
                        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                                    </p><pre class="screen">g7ctrl&gt; db export gpx</pre><p>
                                </p><p>Export all stored location in GPX format to the DB dir. If
                                    default values are used then this command would export
                                        to<code class="filename">/usr/share/g7ctrl/export.gpx</code></p></li><li class="listitem"><p>
                                    </p><pre class="screen">g7ctrl&gt; db export dev=3000000001 2013-02-01 2013-02-28 xml /tmp/myexport.xml</pre><p>
                                </p><p>Export all location reported in February for device
                                        <code class="literal">3000000001</code> in g7ctgrl own
                                        <acronym class="acronym">XML</acronym> format to the file
                                        <code class="filename">/tmp/myexport.xml</code></p></li><li class="listitem"><p>
                                    </p><pre class="screen">g7ctrl&gt; db export ev=1 2013-02-01 2013-02-28 gpx recorded</pre><p>
                                </p><p>Export all downloaded locations (eventid=1) for the given
                                    period in <acronym class="acronym">GPX</acronym> format to
                                        <code class="filename">recorded.gpx</code> in the DB directory</p></li><li class="listitem"><p>
                                    </p><pre class="screen">g7ctrl&gt; db export 2014-01-05 17:30 2014-01-05 gpx</pre><p>
                                </p><p>Export all records between <code class="literal">2014-01-05
                                        17:30:00</code> to <code class="literal">201-01-05
                                    23:59:59</code></p></li></ul></div><p>
                    </p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The recorded way points  broken up in different tracks (and track
                        segments) according to the config file settings of
                            <code class="literal">trackseg_split_time</code> and
                            <code class="literal">track_split_time</code></p></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-head"></a>C.2.4 <span class="command"><strong>db head</strong></span></h4></div></div></div><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db head [n]</strong></span></p><p>Display the newest n received locations. If n is omitted it will be defaulted to 10.</p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default the ordering (and hence what is considered latest) is based on
                        the date and time set by the device on the location and not the order the
                        location arrived in to the server (and hence the DB).</p></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-lastloc"></a>C.2.5 <span class="command"><strong>db lastloc</strong></span></h4></div></div></div><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db lastloc</strong></span></p><p>Display the latest recorded position in the DB</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-mailpos"></a>C.2.6 <span class="command"><strong>db mailpos</strong></span></h4></div></div></div><p>Mail the last recorded position to the predefined mail address in the
                    configuration file.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db mailpos</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-mailgpx"></a>C.2.7 <span class="command"><strong>db mailgpx</strong></span></h4></div></div></div><p>Mail a compressed version of a <acronym class="acronym">GPX</acronym> export file of the
                    entire DB as an attachment to the predefined mail address in the
                    configuration file.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db mailgpx</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-mailcsv"></a>C.2.8 <span class="command"><strong>db mailcsv</strong></span></h4></div></div></div><p>Mail a compressed version of a <acronym class="acronym">CSV</acronym> export file of the
                entire DB as an attachment to the predefined mail address in the
                configuration file.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db mailcsv</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52935440"></a>C.2.9 <span class="command"><strong>db size</strong></span></h4></div></div></div><p>Report the number of stored location events in DB</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db size</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52938368"></a>C.2.10 <span class="command"><strong>db sort</strong></span></h4></div></div></div><p>Specify the sorting order for the <code class="literal">db tail</code> and <code class="literal">db
                    head</code> commands. The default is to sort on arrival time. Given the
                command without arguments prints the current sort order.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db sort [device|arrival]</strong></span></p><p><span class="bold"><strong>Arguments</strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">device</code> - Base the sort order on the device
                            timestamp on the received location</p></li><li class="listitem"><p><code class="literal">arrival</code> - Base the sort order on the time the
                            update was received on the server</p></li></ul></div><p>
            </p><p><span class="bold"><strong>Examples</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; db sort
Sort order: By arrival time</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.db-tail"></a>C.2.11 <span class="command"><strong>db tail</strong></span></h4></div></div></div><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>db tail [n]</strong></span></p><p>Display the oldest n received locations. If n is omitted it will be defaulted to 10.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default the ordering (and hence what is considered oldest) is based on the
                    date and time set by the device on the location and not the order the location
                    arrived in to the server (and hence the DB).</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp52953024"></a>C.3 Preset commands</h3></div></div></div><p>The preset commands are used to manage the stored commands in the presets. For more
            information on presets please refer to <a class="xref" href="#section.using-presets" title="8.3 Using presets">Section 8.3</a></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52954720"></a>C.3.1 <span class="command"><strong>preset list</strong></span></h4></div></div></div><p>List all defined preset files. Preset files are stored in the config directory
                under "<code class="filename">presets/</code>"</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>preset list</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52958144"></a>C.3.2 <span class="command"><strong>preset refresh</strong></span></h4></div></div></div><p>Re-read all presets from disk. An easy way to update the daemon when new presets
                have been added without having to restart the daemon.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>preset refresh</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52961168"></a>C.3.3 <span class="command"><strong>preset use</strong></span></h4></div></div></div><p>Execute the specified preset. A shortcut for this is
                    "<code class="literal">@&lt;preset-name&gt;</code>"</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>preset use &lt;preset-name&gt;</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52964592"></a>C.3.4 <span class="command"><strong>preset help</strong></span></h4></div></div></div><p>Give help for the specified preset. The preset help for each defined preset file
                is store in the beginning of the preset file itself.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>preset help &lt;preset-name&gt;</strong></span></p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.server-commands"></a>C.4 Server commands</h3></div></div></div><p>Daemon commands are internal commands that interacts with the server (daemon) itself.
            All server commands (except the "help" command are started with a dot
                "<span class="command"><strong>.</strong></span>".</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.address-toggle"></a>C.4.1 <span class="command"><strong>.lookup</strong></span></h4></div></div></div><p>Toggle the address lookup when a location is stored in the DB. The default value
                is specified in the configuration file. It could be useful to turn the lookup
                temporarily off if for example a large number of locations are imported via
                USB.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.lookup</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .lookup
Address lookup : off
g7ctrl&gt; .lookup
Address lookup : on</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.cachestat"></a>C.4.2 <span class="command"><strong>.cachestat</strong></span></h4></div></div></div><p>Display statistics for the usage of the Geo loction cache system. The cache system works for both
            address lookup and for the small static maps that can be included in the notification mails so the command
            displayes statitcs separately for both address and minimap cache. The statistics is calculated from the
            start of the dameon and hence reset each time the daemon is started.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.cachestat</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .cachestat
+=========+======+=======+=======+========+
|  Cache  |  Tot |  Fill |  Hits |   Mem  |
+=========+======+=======+=======+========+
| Address |    0 |  16 % |   0 % | 563 kB |
| Minimap |    0 |   2 % |   0 % | 252 kB |
+=========+======+=======+=======+========+</pre><p>
            </p><p>The above table shows the cache status just after start when the cache has been
                initialized from file but no calls has yet been made.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.date"></a>C.4.3 <span class="command"><strong>.date</strong></span></h4></div></div></div><p>Print the current date and time on the server</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.date</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .date
Thu Mar 26 21:01:34 2015</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.help"></a>C.4.4 <span class="command"><strong>help</strong></span></h4></div></div></div><p>Print a one line description (without arguments) of all available commands that
                the daemon supports. </p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>help</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.help-command"></a>C.4.5 <span class="command"><strong>help &lt;command&gt;</strong></span></h4></div></div></div><p>Print a detailed help on the specified command including synopsis, description of
                arguments and where applicable a few examples.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>help &lt;command-name&gt;</strong></span></p><p><span class="bold"><strong>Examples:</strong></span></p><p><span class="command"><strong>help db export</strong></span></p><p>
                </p><pre class="screen">db export - Export entire or filtered portion of the existing DB to other formats

SYNOPSIS:
db export [dev=nnn] [ev=nnn] [from to] (gpx|kml|xml|csv) [filename]

ARGUMENTS:
dev=nnn            Optional. Filter on device id
ev=nnn             Optional. Filter on eventid
[from to]          Optional. Date interval to export in format "yyyy-mm-dd"
(gpx|kml|xml|csv)  Mandatory. Which format used for exporting the DB
                    gpx = Exchange format or GPS devices. WIdely used.
                    kml = Format used to display tracks on Google earth and Google maps
                    xml = Export all fields in DB in a XML format. See separate schema docs.
                    csv = Export in comma separated format. Useful for importing into spreadsheets
filename           Optional. Filename of exported file.


EXAMPLES:
"db export gpx" - Export entire DB to in GPX format
"db export 2013-01-01 2013-01-31 csv /tmp/jan.xml" - Export all january entries to "jan.xml" in CSV format
"db export dev=3000000002 kml /tmp/export.xml" - Export all entries for device=3000000002 to "export.xml" in KML format</pre><p>
            </p><p><span class="command"><strong>help .nl</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; help .nl
.nl - List all registered nick names

SYNOPSIS:
.nl </pre><p>
            </p><p><span class="command"><strong>help track</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; help track
NAME:
  track - Control if device should be sending back automatic tracking information.
 
SYNOPSIS:
  set track [on|off]
  get track
 
ARGUMENTS:
  Tracking mode       - Set condition for when tracking is started
  Timer interval      - Used for mode 1
  Distance interval   - Used for mode 2-9
  Number of trackings - Use 0 for continously tracking
  Track basis         - Wait for GPS fix or not
  Comm select         - Set type of report
  Heading             - Used for modes 5-9
 

DESCRIPTION:
Long description not yet available.</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-ver"></a>C.4.6 <span class="command"><strong>.ver</strong></span></h4></div></div></div><p>Print software version of daemon</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .ver
GM7 Server version 3.2.0 (build 150318-748)</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-lc"></a>C.4.7 <span class="command"><strong>.lc</strong></span></h4></div></div></div><p>List all connected command clients  </p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.lc</strong></span></p><p><span class="bold"><strong>See also:</strong></span>
                <a class="xref" href="#cmd.srv-ld" title="C.4.8 .ld">.ld</a>, <a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .lc
------------------------------------------------------
                 Command connections
------------------------------------------------------
 #   IP               Status            
------------------------------------------------------
*01  127.0.0.1        2015-02-13 20:37
</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-ld"></a>C.4.8 <span class="command"><strong>.ld</strong></span></h4></div></div></div><p>List all connected devices, both on <acronym class="acronym">USB</acronym> and over
                    <acronym class="acronym">GPRS</acronym>
            </p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.ld</strong></span></p><p><span class="bold"><strong>See also:</strong></span>
                <a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a></p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .ld
------------------------------------------------------
                    GPRS connections
------------------------------------------------------
 #   IP               Status            Dev ID
------------------------------------------------------
 01  127.0.0.1        2015-02-13 20:07  3000000011

------------------------------------------------------
                     USB devices
------------------------------------------------------
 #   USB              Status            Dev ID
------------------------------------------------------
00 : *ttyACM0         2015-02-13 20:38  3000000002
01 :  ttyACM1         (no device)
02 :  ttyACM2         (no device)
03 :  ttyACM3         (no device)
04 :  ttyACM4         (no device)
05 :  ttyACM5         (no device)

</pre><p>
            </p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For device connections over <acronym class="acronym">GPRS</acronym> the daemon needs to
                        receive at least one <code class="literal">KEEP_ALIVE</code> packet in order to
                        determine the device ID of the device that connected. Depending on the
                        configuration on how often a <code class="literal">KEEP_ALIVE</code> packet is sent it
                        can take a few minutes until the daemon knows the Device ID. </p></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-ln"></a>C.4.9 <span class="command"><strong>.ln</strong></span></h4></div></div></div><p>List all registered devices in the chosen format. Defaults to format 3 if no
                format specified</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.ln [n]</strong></span></p><p><span class="bold"><strong>Argumnts:</strong></span></p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>[0] - One full record per line</p></li><li class="listitem"><p>[1] - Four lines per full record</p></li><li class="listitem"><p>[2] - One field in the full record per row</p></li><li class="listitem"><p>[3] - Compact list version with just Nick, DEV.ID and IMEI fields
                            displayed</p></li></ul></div><p>
            </p><p><span class="bold"><strong>Example:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .ln 1
#   NICK        DEV.ID               IMEI              SIM                  
01  MC          3000000001           312345678600039   89123456787000101922 

PHONE           FW.VER               REG.DATE          UPD.DATE        
070-123 45 67   M7 2.005 GP rev00c   20140116 07:56    20140117 13:36 </pre><p>
            </p><p>
                </p><pre class="screen">g7ctrl&gt; .ln 2
#         01
NICK:     MC
DEV.ID:   3000000001
IMEI:     312345678600039
SIM:      89123456787000101922
PHONE:    070-123 45 67
FW.VER:   M7 2.005 GP rev00c
REG.DATE: 20140116 07:56
UPD.DATE: 20140117 13:36</pre><p>
            </p><p>
                </p><pre class="screen">&gt; .ln
-------------------------------------------
#   NICK        DEV.ID      IMEI              
-------------------------------------------
01  MYMC        3000000001  352964052600039 </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp53035776"></a>C.4.10 <span class="command"><strong>.dn</strong></span></h4></div></div></div><p>Delete the specified nick-name</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.dn nick-name</strong></span></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-nick"></a>C.4.11 <span class="command"><strong>.nick</strong></span></h4></div></div></div><p>Register the device connected over USB. This will read back the
                    <acronym class="acronym">IMEI</acronym>, the <acronym class="acronym">SIM</acronym> and the <span class="bold"><strong>Device ID</strong></span> from the device and record them in the server
                DB. When events are received from a tracker the device id will be replaced with the
                nick-name (when it exists) in all communication from the daemon to the user for each
                of use. By using the "<span class="command"><strong>.nl</strong></span>" command all registered devices can be
                shown together with the registered information.</p><p>The nick name can also be used together with the "<span class="command"><strong>.use</strong></span>" command
                as an easy way to communicate with a remote device.</p><p>This is a good way to manage multiple devices. In all database commands the nick
                name can be used instead of the numeric device id which makes it easier to manage
                multiple devices without remembering all device id:s</p><p>The optional <acronym class="acronym">SIM</acronym> phone number must be given manually since it
                is not possible to read back the <acronym class="acronym">SIM</acronym> phone number from the
                device.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.nick nick-name [phone-number]</strong></span></p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please note that nick-name are case sensitive!</p></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-table"></a>C.4.12 <span class="command"><strong>.table</strong></span></h4></div></div></div><p> Toggle the output to pretty-print output tables using Unicode table drawing
                characters.</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.table</strong></span></p><p><span class="bold"><strong>See also:</strong></span>
                <a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a>,<a class="xref" href="#cmd.srv-target" title="C.4.13 .target">.target</a>,
            </p><p><span class="bold"><strong>Examples:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .table
Table drawing : On</pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-target"></a>C.4.13 <span class="command"><strong>.target</strong></span></h4></div></div></div><p>Specify which device connected over GPRS to use as target for the device commands.
                The target is specified as either the given nick-name for the tracker or as the
                client number as shown with the "<span class="command"><strong>.lc</strong></span>" command. The direction is
                in effect until the next time the command is used. </p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.target [ nick-name | client-number ]</strong></span></p><p><span class="bold"><strong>See also:</strong></span>
                <a class="xref" href="#cmd.srv-usb" title="C.4.14 .usb">.usb</a></p><p><span class="bold"><strong>Examples:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .target MyCar</pre><p>
            </p><p>All the commands hereafter will be directed to the device with the nick-name
                "MyCar"</p><p>
                </p><pre class="screen">g7ctrl&gt; .target 1 </pre><p>
            </p><p>This will use the device connected as client number 1 as listed by the
                    "<span class="command"><strong>.lc</strong></span>" command.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cmd.srv-usb"></a>C.4.14 <span class="command"><strong>.usb</strong></span></h4></div></div></div><p>Specify which device connected on USB to talk to or list status of all connected
                devices</p><p><span class="bold"><strong>Synopsis:</strong></span></p><p><span class="command"><strong>.USB [ usb-index ]</strong></span></p><p><span class="bold"><strong>See also:</strong></span>
                <a class="xref" href="#cmd.srv-target" title="C.4.13 .target">.target</a></p><p><span class="bold"><strong>Examples:</strong></span></p><p>
                </p><pre class="screen">g7ctrl&gt; .usb 1</pre><p>
            </p><p>Use device connected on USB device 1</p><p>
                </p><pre class="screen">g7ctrl&gt; .usb
------------------------------------------------------
 #    USB             Status            Dev ID
------------------------------------------------------
00 : *ttyACM0         2015-02-13 19:38  3000000002</pre><p>
            </p><p>List all existing devices. The star '<code class="literal">*</code>' in front of the
                    <code class="literal">ttyACM0</code> device indicates that this is the selected device for
                this command connection. If this command had been given just after the device had
                been connected and before the identity of the device had been established the
                listing would instead have shown the following</p><p>
                </p><pre class="screen">g7ctrl&gt; .usb
------------------------------------------------------
 #    USB             Status            Dev ID
------------------------------------------------------
00 : *ttyACM0         connecting ...</pre><p>
            </p></div></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.technical"></a>Appendix D - Technical information</h2></div></div></div><p>
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This section is only meant for developers and contains brief information on the
                internals of the software.</p></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51523824"></a>D.1 Documentation format</h3></div></div></div><p>The documentation is written entirely using the Docbook5 <acronym class="acronym">XML</acronym> schema and transformed
            into the various output formats using the official XSL style sheets (currently version
            1.78.1) with a thin customization layer (in <code class="filename">xslt_stylesheets/</code>). The
            transformation is done using <span class="command"><strong>xsltproc</strong></span> and
                Apache-<span class="command"><strong>fop</strong></span> controlled with a standard makefile. All output is
            written into the appropriate format directory in <code class="filename">out/</code>. The manual
            makes use of <code class="literal">XInclude</code> schema to split the manual in separate files
            for ease of maintenance. The HTML rendering is further customized with a CSS style sheet
            to make it a bit more readable and nice. In order to create a text rendering of the
            manual the HTML version is converted to text using the ASCII-web browser
                "<span class="command"><strong>links</strong></span>".</p><p>The included bootstrap scripts (see <a class="xref" href="#section.build-system" title="D.7.7 The build system">Section D.7.7</a>) will
            setup a complete working DocBook5 environment. Since <acronym class="acronym">XML</acronym> is quite
            verbose it is also recommended that editing is done in a <acronym class="acronym">XML</acronym> aware
            editor to make text editing less tedious.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51517648"></a>D.2 The database schema</h3></div></div></div><p>The database contains three tables:</p><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">tbl_track</code>, stores all the information received back
                        from the device events</p></li><li class="listitem"><p><code class="literal">tbl_info</code>, stores meta information about the DB and
                        application itself</p></li><li class="listitem"><p><code class="literal">tbl_device_nick</code>, stores all defined nick names for
                        devices</p></li></ul></div><p>
        </p><p>The daemon has built in functionality to export the track database into both its
            internal <acronym class="acronym">XML</acronym> format (see <a class="xref" href="#section.internal-export-format" title="D.3 The internal XML export format grammar">Section D.3</a>) and standard GPX (<span class="italic">Gps Exchange format</span>) and KML (<span class="italic">Google Maps</span>) as well CSV (<span class="italic">Comma separated
                values</span>). This is further described in <a class="xref" href="#section.exporting-db" title="10 Exporting the DB">Section 10</a>.</p><div class="figure"><a name="idp51507216"></a><div class="figure-contents"><pre class="programlisting">CREATE TABLE tbl_track (
  'fld_key' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
  'fld_timestamp' INTEGER NOT NULL, 
  'fld_deviceid' INTEGER NOT NULL, 
  'fld_datetime' INTEGER NOT NULL, 
  'fld_lat' TEXT NOT NULL, 
  'fld_lon' TEXT NOT NULL, 
  'fld_approxaddr' TEXT NOT NULL
  'fld_speed' INTEGER NOT NULL, 
  'fld_heading' INTEGER, NOT NULL,  
  'fld_altitude' INTEGER NOT NULL, 
  'fld_satellite' INTEGER NOT NULL, 
  'fld_event' INTEGER NOT NULL, 
  'fld_voltage' TEXT NOT NULL, 
  'fld_detachstat' INTEGER NOT NULL);

CREATE TABLE tbl_info (
  'fld_key' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
  'fld_created' TEXT NOT NULL, 
  'fld_dbversion' INTEGER NOT NULL);

CREATE TABLE tbl_device_nick ( 
  'fld_nick' TEXT NOT NULL,
  'fld_devid' INTEGER NOT NULL,
  'fld_imei' INTEGER PRIMARY KEY NOT NULL,
  'fld_sim' TEXT NOT NULL,
  'fld_phone' TEXT NOT NULL,
  'fld_fwver' TEXT NOT NULL,
  'fld_regdate' TEXT NOT NULL,
  'fld_upddate' TEXT NOT NULL);</pre></div><p class="formal-object-title"><span class="label">Figure D.1: </span><span class="title">DB Schema</span></p></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="section.internal-export-format"></a>D.3 The internal <acronym class="acronym">XML</acronym> export format
            grammar</h3></div></div></div><p>The <acronym class="acronym">XML</acronym> export is a fairly straightforward export in
                <acronym class="acronym">XML</acronym> format where each row in the database corresponds to a single
                <code class="literal">event_export</code>. The reason to create a proprietary format os that
            neither <acronym class="acronym">GPX</acronym> nor <acronym class="acronym">KML</acronym> format allows for the
            inclusion of device specific data as for example battery level or the status of the
            detach button. This is also exported in the CSV format but the author is partial to the
                <acronym class="acronym">XML</acronym> format since it makes post processing so much easier (once
            you know <acronym class="acronym">XSLT</acronym> to do transformations).</p><p>The grammar below is written using the <acronym class="acronym">RNG</acronym> (Relax New Grammar)
            schema. The corresponding graphical representation is shown in <a class="xref" href="#fig.export-rng-grammar" title="Figure D.2. RNG Grammar for XML Export format">Figure D.2</a></p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
    -File         $Id$
    -Author       Johan Persson, johan162@gmail.com
    
    Relax-NG XML Schema For exported event database. (See http://www.relaxng.org)

--&gt;

&lt;grammar 
    xmlns="http://relaxng.org/ns/structure/1.0"
    xmlns:a="http://relaxng.org/ns/compatibility/annotations/1.0"
    datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes"&gt;
    &lt;start&gt;
        &lt;ref name="event_export"&gt;&lt;/ref&gt;
    &lt;/start&gt;
    
    &lt;define name="event_export"&gt;
        &lt;element name="event_export"&gt;
            &lt;interleave&gt;
                &lt;attribute name="version" &gt;&lt;data type="string" /&gt;&lt;/attribute&gt;
                &lt;attribute name="exportdate" &gt;&lt;data type="date" /&gt; &lt;/attribute&gt;
                &lt;attribute name="creator"&gt;&lt;data type="string"&gt;&lt;/data&gt;&lt;/attribute&gt;
            &lt;/interleave&gt;
            &lt;ref name="boundaries" /&gt;
            &lt;zeroOrMore&gt;
                &lt;ref name="locevent" /&gt;
            &lt;/zeroOrMore&gt;
        &lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="boundaries"&gt;
        &lt;element name="bounds"&gt;
            &lt;interleave&gt;
                &lt;attribute name="minlat"&gt;&lt;data type="float"&gt;&lt;/data&gt;&lt;/attribute&gt;
                &lt;attribute name="maxlat"&gt;&lt;data type="float"&gt;&lt;/data&gt;&lt;/attribute&gt;
                &lt;attribute name="minlon"&gt;&lt;data type="float"&gt;&lt;/data&gt;&lt;/attribute&gt;
                &lt;attribute name="maxlon"&gt;&lt;data type="float"&gt;&lt;/data&gt;&lt;/attribute&gt;
            &lt;/interleave&gt;
        &lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="locevent"&gt;
        &lt;element name="locevent"&gt;
            &lt;attribute name="id" &gt;&lt;data type="int" /&gt;&lt;/attribute&gt;
            &lt;interleave&gt;
                &lt;ref name="key" /&gt;
                &lt;ref name="timestamp" /&gt;
                &lt;ref name="deviceid" /&gt;
                &lt;ref name="location" /&gt;
                &lt;ref name="speed" /&gt;
                &lt;ref name="heading" /&gt;
                &lt;ref name="elevation" /&gt;
                &lt;ref name="satellite" /&gt;
                &lt;ref name="voltage" /&gt;
                &lt;ref name="attachbutt" /&gt;
            &lt;/interleave&gt;
        &lt;/element&gt;        
    &lt;/define&gt;
    
    &lt;define name="key"&gt;
        &lt;element name="key"&gt;&lt;data type="int" /&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="timestamp"&gt;
        &lt;element name="timestamp"&gt;&lt;data type="int"/&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="deviceid"&gt;
        &lt;element name="deviceid" &gt;&lt;data type="string"/&gt; &lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="location"&gt;
        &lt;element name="location"&gt;
            &lt;interleave&gt;
                &lt;attribute name="lat" /&gt;
                &lt;attribute name="long" /&gt;
            &lt;/interleave&gt;
        &lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="speed"&gt;
        &lt;element name="speed"&gt; &lt;data type="int" /&gt; &lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="satellite"&gt;
        &lt;element name="satellite"&gt;&lt;data type="int" /&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="heading"&gt;
        &lt;element name="heading"&gt;&lt;data type="int"/&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="elevation"&gt;
        &lt;element name="elevation"&gt;&lt;data type="int" /&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="voltage"&gt;
        &lt;element name="voltage"&gt;&lt;data type="int" /&gt;&lt;/element&gt;
    &lt;/define&gt;
    
    &lt;define name="attachbutt"&gt;
        &lt;element name="attachbutt"&gt;&lt;data type="boolean" /&gt;&lt;/element&gt;
    &lt;/define&gt;
&lt;/grammar&gt;</pre><p>
            </p><div class="figure"><a name="fig.export-rng-grammar"></a><div class="figure-contents"><div class="mediaobject"><img src="img/export_db-rng-grammar.png" width="700" alt="RNG Grammar for XML Export format"></div></div><p class="formal-object-title"><span class="label">Figure D.2: </span><span class="title">RNG Grammar for <acronym class="acronym">XML</acronym> Export format</span></p></div><p><br class="figure-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51632208"></a>D.4 Configuring the daemon to generate a stack-trace</h3></div></div></div><p>It is possible to compile the daemon so that in the unlikely event of a program crash
            (or technically a <code class="literal">SIGSEGV</code>) a stack trace is generated. This is useful
            for a released program since it is unlikely that an end user will be running on a system
            which allows core dumps and in any he/she would not know what to do with it. In that
            case a stack trace is the best we can do since we might also asl the end user to mail
            that short file to us to give a rough indication of where the problem occurred.</p><p>Automatic stack trace is generated in the event of a <code class="literal">SIGSEGV</code> when
            the compile is configured with</p><p>
            </p><pre class="screen">./configure --enable-stacktrace</pre><p>
        </p><p>If this is done then a stack trace will be written to
                "<code class="filename">/tmp/g7ctrl_stack-&lt;timestamp&gt;.crash</code>" where
                <code class="literal">timestamp</code> is replaced by the current time when the event
            occurred. An example of such a stack trace is shown below</p><p>
            </p><pre class="screen">signal 11 : "Segmentation fault" at 0x407191 accessing 0x2540be3ff (Reason: "Addressed not mapped")
HINT: Use "addr2line -e g7ctrl 0x407191" to find out which line is giving this condition.

Stack trace:
./src/g7ctrl(sigsegv_handler+0x163)[0x4074a3]
./src/g7ctrl(main+0x1d1)[0x407191]
./src/g7ctrl(main+0x1d1)[0x407191]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f7171264a15]
./src/g7ctrl[0x407269]</pre><p>
        </p><p>This is not a completely robust solution since there are cases where the stack trace
            will be incomplete or there is such a catastrophic memory overwrite that the stack is
            completely destroyed. However, in practice this will help find a common null-pointer
            problem or an uninitialized pointer. The walk back of the stack frames are done with the
            help of the gnulib <code class="literal">backtrace()</code> function. This also means that this
            functionality will not be available when compiling on non gnulib systems, such as
                <acronym class="acronym">OSX</acronym>.</p><p>By default stack traces are not enabled (nor is it enabled in the packaged
            distribution).</p><p>To help pinpoint the location of the violation the system command
                <span class="command"><strong>addr2line</strong></span> is commonly used and the stack trace gives a hint on
            how to use that command to exactly pinpoint the line in the code that caused this issue.
                <span class="bold"><strong>CAVEAT</strong></span>: For a completely destroyed stack this will
            not work since the stack frames may have been destroyed as. If such a problem is
            encountered a full core dump is needed for a post-mortem debugging session. How to
            enable a system core dump for misbehaving applications (or daemons) is system dependent
            and not further discussed here assuming that a developer knows how to enable
            this.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51392928"></a>D.5 Configuring for a simulated device</h3></div></div></div><p>In order to be able to run the daemon and its command without having to physically
            attach a device it is possible to compile a version of the daemon which simulates a
            connected device. To keep things simple in version 1.0.0 the simulated device will
            always return an error. In future version this simulation might be extended to return
            command specific "fake" data. A simulated build is configured with</p><pre class="screen">./configure  --enable-simulate</pre><p>This will allow running the daemon without any messages about a missing device and
            will allow device commands (even though the simulated device will behave as if it had an
            error)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp51395952"></a>D.6 Protocol description</h3></div></div></div><p>The protocol is a plain text (<acronym class="acronym">UTF8</acronym>) based command-response type
            protocol. The daemon will send different amount of information back depending on the
            actual command. However, the daemon guarantees that no reply shall ever exceed a buffer
            size of 10K. To indicate that the daemon has finished sending data back and is awaiting
            a new command the sequence "<code class="literal">\r\n</code>" ends the data. A client should
            therefore implement a reading loop similar to the following example
                <code class="code">readwrite()</code></p><p>
            </p><pre class="programlisting">#define LEN_10K (10*1024)
#define NUM_RETRIES 3
#define SOCK_DISCONNECTED -99

/**
 * Utility variant of the standard read() function which handles signal
 * interruption and connection reset in a graceful way. Basically it will
 * resume the read() operation when a temporary error has happened. 
 * 
 * @param sockd Socket descriptor
 * @param[out] buffer Buffer to hold the read string
 * @param buffLen Maximum length of the storage buffer
 * @return the number of bytes read, 0 on connection close/reset, otherwise
 * &lt; 0 indicates an error and errno is set.
 */
int
socket_read(const int sockd, void *buffer, const size_t buffLen) {
    int rc;
    while( TRUE ) {
        rc = read(sockd,buffer, buffLen);
        if( (-1 == rc) &amp;&amp; (EINTR == errno) ) {
            continue;        
        } else {
            break;
        }
    }
    return rc;
}


/**
 * Read a reply from a socket with a 5s timeout.
 * 
 * @param sock Socket to read from
 * @param buffer Buffer for reply
 * @param maxbufflen Maximum reply length
 * @param nread number of chars read
 * @return 0 on success, -3 timeout, -2 buffer to small for reply, -1 other error
 */
int
waitread(int sock, char *buffer, int maxbufflen, int *nread) {
    fd_set read_fdset;
    struct timeval timeout;

    FD_ZERO(&amp;read_fdset);
    FD_SET(sock, &amp;read_fdset);

    // 5s timeout
    timerclear(&amp;timeout);
    timeout.tv_sec = 5;
    timeout.tv_usec = 0;
    int rc = select(sock + 1, &amp;read_fdset, NULL, NULL, &amp;timeout);
    if (0 == rc) {
        // Timeout
        *nread = 0;
        *buffer = '\0';
        return -3;
    } else if( rc &lt; 0 ) {
        return -1;
    } else {
        *nread = socket_read(sock, buffer, maxbufflen);
        if (*nread &gt;= maxbufflen - 1) {
            // Reply is longer than we can receive
            *nread = 0;
            *buffer = '\0';
            return -2;
        } else if (*nread &gt; 0 ) {
            buffer[*nread + 1] = '\0';
        } else {
            *buffer = '\0';
            return SOCK_DISCONNECTED;
        }
    }
    return 0;
}

/**
 * Read reply from readsock until a "\r\n" sequence is found. Write partial
 * replies to writesock as we go if writesock &gt; 0
 * @param readsock Socket/fd to read from
 * @param writesock Socket/fd to write patyal replies from (if writesock == 1)
 * no replies will be written.
 * @param buffer Reply buffer (stores the complete reply)
 * @param maxbufflen Maximum reply buffer
 * @return  0 on success, -1 on failure, -2 on buffer too small to hold reply
 * -3 = connection reset
 */
int
readwrite(int readsock, int writesock, char *buffer, int maxbufflen) {

    char *pbuff = calloc(LEN_10K, sizeof (char));
    *buffer = '\0';
    int totlen = 0, rc = 0, nread = 0;
    int retries = NUM_RETRIES;
    while (totlen &lt; maxbufflen) {
        rc = waitread(readsock, pbuff, LEN_10K, &amp;nread);
        if (0 == rc) {
            retries = NUM_RETRIES;
            pbuff[nread] = '\0';

            if (totlen + nread &lt; maxbufflen) {
                strcat(buffer, pbuff);
                totlen += nread;
            } else {
                free(pbuff);
                return -2; // Buffer too small
            }

            // Current output from daemon is finished with a "\r\n" sequence but we 
            // don't want to include that in the output to the user
            if (nread &gt;= 2 &amp;&amp; '\r' == pbuff[nread - 2] &amp;&amp; '\n' == pbuff[nread - 1]) {
                pbuff[nread - 2] = '\0';
                _writef(writesock, "%s", pbuff);
                break;
            } else if (writesock &gt; 0) {
                // Write back a partial response
                _writef(writesock, "%s", pbuff);
            }

        } else if (-3 == rc) {
            // Try 3 times when we get a timeout
            retries--;
            if (retries &lt;= 0) {
                free(pbuff);
                return -1;
            }
        } else if ( rc &lt; 0 ) {
            free(pbuff);
            if( SOCK_DISCONNECTED == rc )
                return -3;
            else 
                return -1;
        }
    }

    buffer[maxbufflen - 1] = '\0';
    free(pbuff);
    return 0;
}
</pre><p>
        </p><p>The code is also slightly complicated by the fact that some daemon commands takes a
            bit of time to perform and the daemon sends back progress information even before the
            finishing "<code class="literal">\r\n</code>". This means that we should handle (and possible show
            the user) this progress information. This is handled in the <code class="code">readwrite()</code>
            function. using the descriptor <code class="code">writesock</code>
        </p><p>In case of timeout the above code will retry <code class="code">NUM_RETRIES</code> before giving
            up.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp52403312"></a>D.7 Internal architecture</h3></div></div></div><p>The software is built pretty much as a standard multi-threaded socket server with
            the possibility to detach from the controlling terminal. It can arbitrate between
            multiple clients and can handle multiple incoming tracker connections.</p><p>It can however not at present handle multiple USB connected devices at one time.
        This is though not big issue since it would be awkward for the end user as well as
        he or her would have to augment each command to specify which of the connected devices
        the command is intended for.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52405472"></a>D.7.1 Coding standards</h4></div></div></div><p>The code is written in plain <code class="literal">C</code> using <code class="literal">C99</code>
                standards level together with the <acronym class="acronym">GNU</acronym> extensions given by
                    <code class="literal">#define _GNU_SOURCE</code>. The code style is standard
                    <code class="literal">K&amp;R</code> with indentation of 4 and using Hungarian style for
                boolean comparisons. </p><p>For robustness in string handling a set of custom string manipulation routines are
                used which are contained in the <code class="filename">xstr.c</code> module. This is
                especially important in the correct handling of <acronym class="acronym">UTF8</acronym> encoded
                characters since in that case the old truth that one byte corresponds to one
                character breaks down. We take special care of not using the dangerous
                    <code class="function">strnlen()</code> function for any kind of string manipulation.
                This is only used in the case we would like to copy a number of bytes from one are
                to another with a specific length.</p><p>All functions (in general) return negative error codes and 0 for correct value.
                Working values are returned through pointer arguments.</p><p>Camel case is used with occasional module separation naming using '_' character as
                appropriate.</p><p><code class="literal">const</code> modifier is used when appropriate and full use of
                    <code class="literal">C99</code> declaration in blocks to better highlight declaration and
                usage of variables. When possible array indexes are always typed as
                    "<code class="literal">size_t</code>" except when old library routines makes this
                cumbersome.</p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The size for <code class="literal">size_t</code> is 8 bytes on 64 bit systems so it
                        might seem as a waste since the indexing principle could be achieved using
                            <code class="literal">unsigned</code> which is only 4 bytes. However, the compiler
                        in most cases can generate more efficient code with
                            <code class="literal">size_t</code> addresses than with unsigned. The small
                        drawback is that using <code class="literal">size_t </code>in datastructure will
                        result in slightly larger memory requirements.</p></div><p>
            </p><p>Stack variables are preferred up to a size to avoid nasty
                    <code class="literal">malloc()</code> errors when possible. At compile time the extra
                stack and malloc checks are enforced through additional command line arguments. When
                possible the dynamic array possibility in C99 are used instead of malloc/calloc
                calls.</p><p><span class="application">Doxygen</span>. Even though no doxygen generated documentation
                is included in the distribution all functions are commented using Doxyblock comments
                and a <span class="application">Doxygen</span> configuration file is included in the
                source directory. <span class="application">Doxygen</span> can be run without any
                significant warnings being generated. Doxygen comments for functions are only added
                in the "<code class="filename">*.c</code>" files and not complemented in the
                    "<code class="filename">*.h</code>" files.</p><p>The overall code complexity is medium to complex (in cyclomatic sense). Many
                functions are in general low but a few reaches the complex level which makes the
                overall code medium-to-complex. However, a number of measurements are put in place
                to combat the complexity and full usage of compiler static analysis is made. The
                code is written primarily for clarity and not for optimization since for this type
                of application no trickery is needed. For an experienced Unix/GNU Linux developer
                the code should pose no problem since it only uses commonly used patterns for a
                    <code class="literal">C</code> program. </p><p>The code is further structured so that no single source module in general is more
                than 2000 lines long (including comments and file pre-amble).</p><p>Where possible pointer levels are restricted to two with the exception of pointer
                arrays supplied in function calls as out arguments. (typically exemplified by
                    <code class="code">char *list[]</code> type of arrays)</p><p>On a few occasions the following <code class="literal">__attribute__ </code>are used:</p><p>
                </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong><code class="literal">__attribute__
                                ((pure))</code></strong></span></span></dt><dd><p>To indicate a side effect free function. Only used for funtion
                                prototypes</p></dd><dt><span class="term"><span class="bold"><strong><code class="literal">__attribute__
                                    ((format(fmt,ifmt,ichk)))</code></strong></span></span></dt><dd><p>Specifies static compiler check according to a format
                                string</p></dd></dl></div><p>
            </p><p>A few compiler <code class="code">#pragma</code> (both <span class="application">gcc</span> and
                    <span class="application">clang</span>) are also used to suppress warnings as
                necessary when there is a false positive. To indicate special
                    <span class="productname">OSX</span> consideration the test is made with the
                    <code class="literal">__APPLE__</code> define which is guaranteed to exist during
                compilation on <span class="productname">OSX</span>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52289040"></a>D.7.2 Compilation</h4></div></div></div><p>The source has been instrumented to compile cleanly (no warnings) on both
                    "<span class="command"><strong>clang</strong></span>" (v3.2) or "<span class="command"><strong>gcc</strong></span>" (v4.7.x, 4.8.x).
                Some preprocessor conditionals is necessary to accomplish this since all warnings
                are enabled and flagged to give hard compile time errors. The code is further
                adapted to compile both on <acronym class="acronym">GNU</acronym> Linux as well as
                    <span class="productname">OSX</span>. </p><p>The code is compiled with the additional warnings and instrumentation flags as: </p><p><code class="literal">-pedantic -Wall -Werror -Wpointer-arith -Wstrict-prototypes -Wextra
                    -Wshadow, -Werror=format -Wformat=2 -fstack-protector
                    -D_FORTIFY_SOURCE=2</code></p><p>All of the above flags adds either one or more specific additional static tests or
                in te case of <code class="literal">FORTIFY_SOURCE</code> adds stack frame protection patterns
                to detect memory overwrites. For optimization "-O2" </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52294848"></a>D.7.3 Organization of the source code</h4></div></div></div><p>The source code follows a fairly standard layout with a separate source and
                documentation directories. Each directory has a short <code class="filename">README</code>
                file which documents the purpose of the directory.</p><p>The code should be considered medium complex and consist of a number of
                programming and scripting languages. Table <a class="xref" href="#table.source-stats" title="Table D.1. Breakdown of project LOC by type">Table D.1</a>
                shows the break down for the source.</p><p>All source files can be found in the <code class="filename">src/</code> directory. The
                daemon is divided into a number of source files together with a few supporting
                libraries contained in there own directories. An overview of the purpose of each
                source file is given in the table <a class="xref" href="#table.source-files" title="Table D.2. Overview of source">Table D.2</a>.</p><p>The statistics table was generated with the help of the <span class="command"><strong>cloc</strong></span>
                command and formatted for readability. All plain text files (such as mail templates)
                as well as the build system files are excluded from this statistics.</p><p>
                </p><div class="table"><a name="table.source-stats"></a><p class="formal-object-title"><span class="label">Table D.1: </span><span class="title">Breakdown of project LOC by type</span></p><div class="table-contents"><table summary="Breakdown of project LOC by type" border="1"><colgroup><col width="150pt" align="left" class="c1"><col width="50pt" align="left" class="c2"><col width="80pt" align="right" class="c3"><col width="80pt" align="right" class="c4"><col width="90pt" align="right" class="c5"></colgroup><thead><tr><th align="left">language</th><th align="left">files</th><th align="right">blank</th><th align="right">comment</th><th align="right">code</th></tr></thead><tbody><tr><td align="left">C</td><td align="left">42</td><td align="right">3457</td><td align="right">7268</td><td align="right">16912</td></tr><tr><td align="left">XML</td><td align="left">20</td><td align="right">152</td><td align="right">2</td><td align="right">8440</td></tr><tr><td align="left">HTML</td><td align="left">10</td><td align="right">352</td><td align="right">0</td><td align="right">4819</td></tr><tr><td align="left">XSLT</td><td align="left">14</td><td align="right">290</td><td align="right">626</td><td align="right">1965</td></tr><tr><td align="left">C/C++ Header</td><td align="left">42</td><td align="right">1027</td><td align="right">2119</td><td align="right">1890</td></tr><tr><td align="left">CSS</td><td align="left">2</td><td align="right">181</td><td align="right">69</td><td align="right">894</td></tr><tr><td align="left">Bourne Shell</td><td align="left">10</td><td align="right">89</td><td align="right">251</td><td align="right">271</td></tr><tr><td align="left">awk</td><td align="left">1</td><td align="right">6</td><td align="right">7</td><td align="right">47</td></tr><tr><td align="left">SQL</td><td align="left">1</td><td align="right">2</td><td align="right">0</td><td align="right">28</td></tr><tr><td align="left"><span class="bold"><strong>TOTAL</strong></span></td><td align="left"><span class="bold"><strong>142</strong></span></td><td align="right"><span class="bold"><strong>5556</strong></span></td><td align="right"><span class="bold"><strong>10342</strong></span></td><td align="right"><span class="bold"><strong>35266</strong></span></td></tr><tr><td align="left"><span class="bold"><strong> </strong></span></td><td align="left"><span class="bold"><strong> </strong></span></td><td align="right"><span class="bold"><strong> </strong></span></td><td align="right"><span class="bold"><strong> </strong></span></td><td align="right"><span class="bold"><strong>(All: 51306)</strong></span></td></tr></tbody></table></div></div><p><br class="table-break">
            </p><p>
            </p><div class="table"><a name="table.source-files"></a><p class="formal-object-title"><span class="label">Table D.2: </span><span class="title">Overview of source</span></p><div class="table-contents"><table summary="Overview of source" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th>File</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">connwatcher.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Watch for device connections</p><p>This is done by creating an <code class="literal">inotify</code> structure to watch the
                                            <code class="filename">/dev</code>directory for the apperance of
                                        a new <code class="literal">ttyACM&lt;n&gt; </code>device.</p></td></tr><tr><td><code class="filename">dbcmd.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Contains all commands and function that work with
                                        the database</p><p>The DB is built around a trivial sqlite3 database and only makes use of very rudimentary
                                            <acronym class="acronym">SQL</acronym> to insert and extract data from
                                        the DB file.</p></td></tr><tr><td><code class="filename">export.c</code></td><td>
                                    <p><span class="bold"><strong>Purpose:</strong></span> Routines to
                                        handle export to alternative formats like
                                            <acronym class="acronym">GPX</acronym> and <acronym class="acronym">KML</acronym></p>
                                </td></tr><tr><td><code class="filename">futils.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Various file utility functions</p></td></tr><tr><td><code class="filename">g7cmd.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Command dispatcher for user commands.</p><p>This contains the simple parser that reads the commands given by the user. To keep things
                                        simple the parsing is done with the help of the PCRE3
                                        library for regular expressions. In addition all the raw
                                        commands that is given to the device is defined here. The
                                        command for the device is entirely data driven which keeps
                                        the code short and understandable. </p>
                                    <p>This contain the thread that gets started by the
                                            <code class="filename">socklistener.c</code> main thread whenever
                                        a new command client connects.</p></td></tr><tr><td><code class="filename">g7config.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Reads all values from the config file</p></td></tr><tr><td><code class="filename">g7sendcmd.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span>Routines to do low/mid level communication with the
                                        device</p><p>This module contains the logic and routines that do the actual sending and receiving of
                                        commands from teh device with error checking.</p></td></tr><tr><td><code class="filename">g7srvcmd.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span>Implements the logic for the internal server commands
                                        (server commands are those commands that starts with an
                                        initial "<code class="literal">.</code>").</p></td></tr><tr><td><code class="filename">g7ctrl.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span>MAIN file. Initializes all structures and starts all
                                        threads</p><p>This is the main module which starts the daemon, reads the command line arguments, detaches
                                from the terminal and kicks of the main thread (in
                                <code class="filename">worker.c</code>) which listens for
                                incoming connections.</p></td></tr><tr><td><code class="filename">geoloc.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handle the
                                    translation of coordinates to approximate addresses through
                                    Google API</p></td></tr><tr><td><code class="filename">gpsdist.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Functions to
                                    calculate the geodesic distance between lat/lon points</p></td></tr><tr><td><code class="filename">lockfile.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handle the lock file with the session pid</p></td></tr><tr><td><code class="filename">logger.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handles all logging to file</p></td></tr><tr><td><code class="filename">mailutil.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Various convenience function to interface with the
                                        <acronym class="acronym">SMTP</acronym> library in order to send mail using templates</p></td></tr><tr><td><code class="filename">nicks.c</code></td><td>
                                    <p><span class="bold"><strong>Purpose:</strong></span> Handling of
                                        device nick names</p>
                                </td></tr><tr><td><code class="filename">pcredmalloc.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Malloc routines used together with the PCRE3 library
                                        to keep track of the insanely stupid malloc schema in PCRE3
                                        which seems to be designed to give memory leaks.</p></td></tr><tr><td><code class="filename">presets.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handles reading and executing of presets</p></td></tr><tr><td><code class="filename">rkey.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handles replacing key templates in a file with
                                        designated values</p></td></tr><tr><td><code class="filename">serial.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Handles low level serial communication with the
                                        device</p></td></tr><tr><td><code class="filename">sighandling.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Signal handling including separate signal handling
                                        thread.</p>
                                    <p><span class="bold"><strong>Note: </strong></span>The "mini-dump"
                                        logic and stack walking which is enabled when the code is
                                        configured with <code class="literal">--enable-stacktrace</code> is
                                        contained here.</p></td></tr><tr><td><code class="filename">socklistener.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Contains the main socket server that listens to the
                            command and device socket and launches the appropriate
                            thread when a connection is made.</p></td></tr><tr><td><code class="filename">tracker.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Is the main thread that gets created whenever a
                                        device connects.</p></td></tr><tr><td><code class="filename">unicode_tbl.c</code></td><td>
                                    <p><span class="bold"><strong>Purpose:</strong></span> Routines to draw
                                        simple or complex tables using Unicode code point table
                                        characters</p>
                                </td></tr><tr><td><code class="filename">utils.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> Various utility function used in all other
                                        places</p></td></tr><tr><td><code class="filename">wreply.c</code></td><td><span class="bold"><strong>Purpose:</strong></span> Wrapper funcion to
                                    send back any reply string to the client.</td></tr><tr><td><code class="filename">xstr.c</code></td><td><p><span class="bold"><strong>Purpose:</strong></span> A number of robust and memory safe versions of
                                        several usual string functions.</p><p>String handling is inherently unsafe (even the 'n' versions) and these routines makes it just
                                        a bit safer (together with some additional good-to-have
                                        string routines).</p>
                                    <p>This module also contain a set of UTF8 safe version of
                                        standard string routines with a prefix of
                                            "<code class="literal">xmb_</code>"</p></td></tr></tbody></table></div></div><p><br class="table-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52268112"></a>D.7.4 Thread model</h4></div></div></div><p>To accommodate multiple clients and multiple connecting device standard POSIX
                threads are used. The threads used are:</p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Main thread that listens to the command and device ports (handled in
                                <code class="filename">worker.c</code>). When a new connection is detected it
                            is kicked of in its own thread as follows:</p><p>
                            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>One thread for each connected clients to execute commands
                                        (handled in <code class="filename">g7cmd.c</code>)</p></li><li class="listitem"><p>One thread for each connected device (handled in
                                            <code class="filename">tracker.c</code>)</p></li></ul></div><p>
                        </p></li><li class="listitem"><p>A signal handling thread where all signals are directed (handled in
                                <code class="filename">g7ctrl.c</code>)</p></li><li class="listitem"><p>A thread that watches for connected devices on the USB (handled in
                                <code class="filename">connwatcher.c</code>)</p></li></ul></div><p>
            </p><p>The main thread (and the application) is killed upon receiving the
                    <code class="literal">SIGSTOP</code> or <code class="literal">SIGABRT</code> signals as per
                standard.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52280240"></a>D.7.5 A note on command line parsing</h4></div></div></div><p>The parsing of command lines are handled through the use regular expression
                together with the <acronym class="acronym">PCRE3</acronym> library. The motivation is that commands
                are fragmented and cannot really be considered a language justifying a full
                    <acronym class="acronym">RDP</acronym>. To facilitate the specification of the syntax for the
                grammar a number of defines are used. They are all defined in
                    <code class="filename">g7cmd.h</code> and starts with an initial
                "<code class="literal">_PR_</code>". This makes it easier to understand and avoids tedious
                parenthesis matching errors. </p><p>So for example to define a matching rule for the hypothetical command
                    "<code class="literal">show line nnn filename</code>" (which intends to show an arbitrary
                line from a file) we would write</p><p>
                </p><pre class="screen">"show" _PR_S "line" _PR_S _PR_N _PR_S _PR_FNAME _PR_E</pre><p>
            </p><p>
                </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">_PR_S</code></span></dt><dd><p>One or more spaces</p></dd><dt><span class="term"><code class="literal">_PR_N</code></span></dt><dd><p>One or more numeric characters</p></dd><dt><span class="term"><code class="literal">_PR_FNAME</code></span></dt><dd><p>A filename</p></dd><dt><span class="term"><code class="literal">_PR_E</code></span></dt><dd><p>The end of the expression</p></dd></dl></div><p>
            </p><p>Compare this to the actual regular expression got by replacing the defines with
                the actual expression and the usefulness of this schema becomes obvious!</p><p>Many more predefined useful regular expression fragments are defined in
                    <code class="filename">util.h</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp52107616"></a>D.7.6 Supporting libraries included</h4></div></div></div><p>In addition to the core source files above the library also makes use of the
                following support libraries. They are included as separate libraries since they
                could also be used free-standing from the daemon.</p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">libsmtp</code> - A basic library that wraps the
                                <acronym class="acronym">SMTP</acronym> protocol into some higher level function
                            that makés it simple to create mails with attachment and alternate
                            content. One novelty I added to this library which I haven't seen
                            elsewhere is the possibility to simplify the inclusion of inline images
                            into mails. This library follows exactly the <acronym class="acronym">SMTP</acronym>
                            <acronym class="acronym">RFC</acronym> without any known deviations (in comparison with
                            many other public mail providers ...)</p></li><li class="listitem"><p><code class="literal">libiniparser</code> - A standard library written by parse
                            INI-files. This is included here since it is not available as a
                            pre-built library on all systems. The library is written by <span class="italic">N. Devillard</span> and is available in the public
                            domain.</p></li></ul></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="section.build-system"></a>D.7.7 The build system</h4></div></div></div><p>The system is a fairly standard autotools recursive make system. The
                    <code class="filename">configure.ac</code> file has a number of custom written macros to
                help setup the build for the Docbook5. The generated build files (for the
                distribution) will include a set of pre-built rendering of the documentations. This
                departs from the strict standard that a distribution should not include files that
                are generated. However, this is a practicality to avoid forcing end users to setup a
                complete Docbook5 environment just to get the documentation.</p><p>The repository is strict in the sense that no generated files are checked in (this
                also reuqires some extra step to be done to recreate a build environment when the
                code is checked out directly from the repository.)</p><p>The autotools setup is intended to be used with a modern style setup using
                    <code class="filename">configure.ac</code> and <span class="command"><strong>autoreconf</strong></span>.</p><p>The source includes a utility directory with a few scripts that makes setting up a
                build system a bit simpler for developers wanting to get started with developing.
                These helper scripts are all located in the <code class="filename">bldscripts</code>
                directory (see more information in <a class="xref" href="#section.build-environment" title="4.6 Setting up your own build environment - for developers">Section 4.6</a>).
                In addition to some helper script to setup a build environment a number of script
                are used as utilities during development and help with debugging.</p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The build scripts in the table below are not included in the release tar
                        ball but only available in te source repository since these are developer
                        tools and not needed for normal end user builds.</p></div><p>
            </p><div class="table"><a name="idp52123328"></a><p class="formal-object-title"><span class="label">Table D.3: </span><span class="title">Utility builds cripts in the <code class="filename">bldscripts</code> directory </span></p><div class="table-contents"><table summary="Utility builds cripts in the bldscripts directory " border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">autoclean.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Cleans all generated
                                files and make the source as if just had been checked out from the
                                repository</td></tr><tr><td><code class="filename">bootstrap.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Installs all complete
                                build environment in clean <span class="bold"><strong>RPM based
                                    distribution</strong></span> such as
                                    <span class="productname">OpenSuSE</span>. This includes a complete
                                Docbook5 setup and installs all support libraries and does the
                                initial bootstrapping for autotools. This script is only meant to be
                                run once just after the source tree has been checked out from the
                                repository.</td></tr><tr><td><code class="filename">bootstrap-deb.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Installs all complete
                                build environment in clean <span class="bold"><strong>Debian based
                                    distribution</strong></span>. This includes a complete Docbook5 setup
                                and installs all support libraries and does the initial
                                bootstrapping for autotools. This script is only meant to be run
                                once just after the source tree has been checked out from the
                                repo.</td></tr><tr><td><code class="filename">cntwc.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Count number of source
                                lines in the tree</td></tr><tr><td><code class="filename">cov-bld.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span>Create a coverity augmented 
                                build that can subsequently be uploaded with <code class="filename">cov-upload.sh</code>
                            </td></tr><tr><td><code class="filename">cov-upload.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span>Upload a previous
                                augmented coverity build to the project account in Coverity Open
                                Source Service (See <code class="filename">cov-bld.sh</code>) </td></tr><tr><td><code class="filename">gstackfcore.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> 
                                Print a full stack trace (for all threads) given a core dump file</td></tr><tr><td><code class="filename">mkcl.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Creates a
                                    <code class="filename">ChangeLog</code> from the Subversion log using a
                                small custom XSL script (<code class="filename">svn2cl.xsl</code>)</td></tr><tr><td><code class="filename">mkrelease.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Creates a new release
                                (reconfigures and runs <code class="literal">make distcheck</code>)</td></tr><tr><td><code class="filename">rmtrsp.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Remove trailing spaces at end of line in all source files</td></tr><tr><td><code class="filename">setcorefile.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span>Specify kernel pattern for coure dump file</td></tr><tr><td><code class="filename">src-stat.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Create the source
                                statisticsas included in the Technicla Appendix in the manual. The
                                statistics is based on <span class="command"><strong>cloc</strong></span> and then fomatted
                                into a nice <acronym class="acronym">XML</acronym> table</td></tr><tr><td><code class="filename">stdbuild.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Configure and
                                build</td></tr><tr><td><code class="filename">stdconfig.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Do a standard
                                configuration with silent rules enabled</td></tr><tr><td><code class="filename">svnst</code></td><td><span class="bold"><strong>Purpose:</strong></span> Do a <code class="literal">svn
                                    st</code> but ignore all non added files</td></tr><tr><td><code class="filename">svntag</code></td><td><span class="bold"><strong>Purpose:</strong></span> Tag a release</td></tr><tr><td><code class="filename">tbc.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Total build and clean</td></tr><tr><td><code class="filename">update.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Stop the current
                                running daemon in the system and install the newly built daemon (as
                                root). This script uses the systemd <span class="command"><strong>systemctl</strong></span>
                                method and hence assumes a recent system.</td></tr><tr><td><code class="filename">init-update.sh</code></td><td><span class="bold"><strong>Purpose:</strong></span> Same as
                                    <code class="filename">updated.sh</code> but uses older
                                    "<code class="filename">/etc/init.d</code>" method.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp53088112"></a>D.7.8 A note on build number</h4></div></div></div><p>In order to have a build number that truly is stepped for each build (and not just
                when a specific source file has been edited) the system makes use of a standard
                linker trick. The link processes defines two link time symbols (using
                    <acronym class="acronym">GNU</acronym> linker <code class="literal">--defsym</code>) whose "fake"
                addresses are used in the source to get a build number. The build number is made
                persistent in the file <code class="filename">build.txt</code> which is stepped each time it
                is used. This makes for true build number sequence.</p><p>However, this relies on the possibility to define new symbols at link time as
                supported by the <acronym class="acronym">GNU</acronym> linker. On other system (such as <span class="productname">OSX</span>) where the linker do
                not support this option the build numbers are not used and will always be 0. </p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If someone could show how to accomplish the equivalent "trick" on
                            <span class="productname">OSX</span> we could fix this. Basically, what is
                        needed is the possibility always monotonically increase a build number at
                        link time.</p></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp53094864"></a>D.7.9 Generating a release</h4></div></div></div><p>A new release is generated by means of the "<span class="command"><strong>make distcheck</strong></span>"
                command to make sure we have a clean self-contained release. To also recreate the
                build from scratch and re-generate the <code class="filename">Changelog</code> the utility
                script "<code class="filename">mkrelease.sh</code>" should be used. The version number is as
                usual configured in <code class="filename">autoconfig.ac</code>. </p></div></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.references"></a>Appendix E - References</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp52346720"></a>E.1 Major SW technologies and tools used</h3></div></div></div><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Xtreme GM7 Protocol Documentation, v1.07</p></li><li class="listitem"><p>GNU autotools automake, <a class="link" href="http://www.gnu.org/software/automake/" target="_top">http://www.gnu.org/software/automake/</a></p></li><li class="listitem"><p>GNU autotools autoconf, <a class="link" href="http://www.gnu.org/software/autoconf/" target="_top">http://www.gnu.org/software/autoconf/</a></p></li><li class="listitem"><p>SQLITE3, <a class="link" href="http://www.sqlite.org/" target="_top">http://www.sqlite.org/</a>
                    </p></li><li class="listitem"><p>GNU make, <a class="link" href="http://www.gnu.org/software/make/" target="_top">GNU
                            make</a></p></li><li class="listitem"><p>GNU Compiler Collection, <a class="link" href="http://gcc.gnu.org/" target="_top">gcc</a></p></li><li class="listitem"><p>clang, <a class="link" href="http://clang.llvm.org/" target="_top">C language frontend for
                            LLVM</a></p></li><li class="listitem"><p>Google Map Geocoding API, <a class="link" href="https://developers.google.com/maps/documentation/geocoding/" target="_top">https://developers.google.com/maps/documentation/geocoding/</a></p></li><li class="listitem"><p>Coverity, Static Code Analyzer, <a class="link" href="http://www.coverity.com/" target="_top">http://www.coverity.com/</a></p></li><li class="listitem"><p>JSON, RFC 4627, <a class="link" href="http://www.ietf.org/rfc/rfc4627.txt" target="_top">http://www.ietf.org/rfc/rfc4627.txt</a>,
                        JSON Organization <a class="link" href="http://www.json.org/" target="_top">http://www.json.org/</a></p></li></ul></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp52175040"></a>E.2 XML standards referenced and tools used</h3></div></div></div><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>XSLT, <a class="link" href="http://www.w3.org/TR/xslt" target="_top">http://www.w3.org/TR/xslt</a></p></li><li class="listitem"><p>RNG, <a class="link" href="http://relaxng.org/" target="_top">http://relaxng.org/</a></p></li><li class="listitem"><p>DocBook5, <a class="link" href="http://www.docbook.org/" target="_top">http://www.docbook.org/</a></p></li><li class="listitem"><p>XPath, <a class="link" href="http://www.w3.org/TR/xpath/" target="_top">http://www.w3.org/TR/xpath/</a></p></li><li class="listitem"><p>libxml2,<a class="link" href="http://xmlsoft.org/" target="_top">http://xmlsoft.org/</a></p></li></ul></div><p>
        </p><p>All XML/XSLT transformation is done using <span class="command"><strong>xsltproc</strong></span>, see <a class="link" href="http://xmlsoft.org/XSLT/xsltproc2.html" target="_top">The XSLT C library for GNOME</a></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp52177056"></a>E.3 Miscellaneous standards referenced</h3></div></div></div><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POSIX pthread, POSIX 1003.1c-1995</p></li><li class="listitem"><p>GPX Standard Exchange Format (<a class="link" href="http://www.topografix.com/gpx.asp" target="_top">Topografix</a>)</p></li><li class="listitem"><p>SMTP RFC,  <a class="link" href="http://tools.ietf.org/html/rfc821" target="_top">RFC
                            821</a></p></li></ul></div><p>
        </p></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.news"></a>Appendix F - Detailed release history</h2></div></div></div><pre class="programlisting">NEWS - Major releases
===========
***Highlights major changes for each release in reverse chronological order.***

v3.3.0 (sep 2015)
=================

General notes for this release
------------------------------
This release focus on providing the option to generate a device report. This is
a PDF document that summarizes all settings for a connected device in a nice
overview layout.


Detailed user visible changes
-----------------------------

 - Added command ".report [dev] [file]" to generate a report file in PDF format
   for one of the connected devices. If only one device is connected the specification
   of device is is optional. The filename given must be specified in a location 
   writable by the daemon.


Bugs fixed
----------

 - The "phone" command did not allow the specification of report method and 
   VIP number.

 - The documentation for "phone" and "mswitch" command was wrong


Internal changes (visible for developers and packagers)
-------------------------------------------------------

 - New dependency "libharu" (called "libhpdf-dev" in Ubunto/debian). 
   This is a generic PDF creation library.

 - Several new files that deals with the creation of the PDF device report
   They are divided between the view and model together with a supporting
   report utility library to make it easier to produce a table based report.



v3.2.0 (may 2015)
========================

General notes for this release
------------------------------

This is a major feature release which increases functionality, stability and 
fine-tunes existing functionality in a number of areas. The details of the 
release can be found below. As a summary the highlights are: 

1. Option to include two static miniature maps with different zoom factors in 
   the various event notification mails that directly shows the location.

2. improvements in geolocation lookup for more robustness in terms of handling
   all possible returns from Google API calls and adapt to Google different 
   user limits in number of and frequency of API calls allowed.

3. context sensitive command completion have been introduced in the "g7sh"
   shell.

4. full UTF8 multi-byte string handling now supported for all server output. 

5. seven new server commands
    - **.date ** Prints current date and time on server
    - **.cachestat**  Prints statistics on the Geo-lcation caches
    - **.lookup** Toggles the address lookup for received locations
    - **db head** Print the *n* latest received location updates
    - **db tail** Print the *n* first received locations
    - **db sort** Controls the sorting order for the *db head* and *db tail*
    - **.table** Toggles the printing of pretty-printed tables

6. a number of new configuration options (in *g7config.conf*) to control the new
   features.

    - Specification of a Google API key which is used in the geolocation lookups.
      This allows the specification of a commercial key to increase the allowed
      number of calls (and rate/s) to Google location APIs.

      *More information about Google API key is available in the manual
      (see Appendix A.2 in the manual)*

    - A new setting (or actually settings) in the configuration file makes it
      possible to include two static mini-maps in the notification mails on event
      notifications for those event that carry a location. This is a small
      customizable static Google map centered around the current location of
      the tracker at two zoom levels (overview and detailed). The exact 
      zoom-levels used are customizable

    - A new setting to customize mail subject prefix

    - A new setting to choose to use a shorter form of device ID in subject header

-----
**NOTE:** Since the configuration file has been updated it is recommended to
install the new default config file and re-apply local config changes manually.

-----


Detailed user visible changes
-----------------------------
- Manual updated to RA15 to reflect changes in 3.2.0

- Added smart context sensitive command completion in the command shell 
  invoked by the tab-key

- Replaced "%" as command line prompt in shell with "g7ctrl&gt;" and to "(arg)&gt;&gt; " 
  while in command arguments (second level).

- Mail templates updated with new look &amp; feel

- The information in last location mail template has been updated to be in line
  with the other mail templates

- Added options "include_minimap" to enable the inclusion of a small static map
  showing the current location (with both an overview and a detailed map) the the
  notification mail. The exact meaning of these parameters are described in the
  manual and in the config file.

- Adds full UTF-8 support in order to better handle addresses from Google

- Added a new cache for the minimap images which are stored i the standard
  variable data files directory (defaults to /var/lib/g7ctrl) if not otherwise
  adjusted by the configuration. The same approximation as for the address
  is used.

- Added server command ".cachestat" to return statistics on cache hits and
  usage.

- Added server command ".date" to print server current date and time

- Added server command ".lookup" to toggle address lookup when storing
  locations in DB. Default value on startup is read from the configuration file.

- Added server command "db sort [arrival|device]" to specify sort order for
  "db head" and "db tail" commands. Only "db sort" prints the current sort order.

- Added "subject_prefix" setting the configuration file to allow customization
  of the prefix used in the subject header for all mails sent from the daemon.

- The calls to Google lookup API:s are now throttled not to exceed the rate
  limit for anonymous calls that Google enforces (5 QPS).
  It is (of course) still possible to exceed the "number of calls per 24 hour"
  (2500 calls/24h) and in that case you just have to wait.
  To avoid this it is strongly recommended to purchase an API commercial key.
  Using such a key will increase your Google allowances (10 QPS and 100,000
  queries/24h).  Such a key is personal and is requested directly from Google.
  A purchased or otherwise acquired key can be specified in the configuration file.

- Handle 24h absolute rate limit for Google APIs. If the 24h rate limit (for
  total number of API calls) is reached  then no further Google API calls are
  made until 24h has passed. This can be reset
  manually with the new ".ratereset" command. If the rate limit is hit then a
  notification email is also sent. Restarting the daemon will also reset the
  blockage.

- Introduced option to set a Google API key in the configuration file to allow
  for higher rate and higher absolute number of address lookups. To get a key
  you must configure a key in the Google administration console as described in
  Appendix A.2

- Moved port settings in config file from "config" to "startup" section since
  ports will not be changed in the running daemon even if the config file is
  refreshed.

- Search for the chosen compression program in several locations
  and give better error message if not found when trying to mail a
  compressed version of the DB.

- Add server command ".table" to output result tables in nicer unicode table.
  The command itself toggles this option for the connected client.
  This affects all command with tabled output such as ".usb",".target",".ld"
  and so on.

  For example:

        % .table
        Table drawing : On
        % .target
        ╒════╤════════════════╤══════════════════╤════════════╕
        │  # │       IP       │      Status      │   Dev ID   │
        ╞════╪════════════════╪══════════════════╪════════════╡
        │ 01 │ *79.102.220.42 │ 2015-03-05 20:06 │ 3000000001 │
        └────┴────────────────┴──────────────────┴────────────┘

- Improved geo -location lookup. If a location does not have a street address
  then see if it has a at least a postal code and in that case return that
  before giving up.

- Added two DB commands "db tail" and "db head" which displays a list of location
  updates from the head or tail of the location table. Only the key fields
  position, timestamp, address, speed and device id fields are displayed.
  The list is sorted depending on the setting from the "db sort" command. By
  default the sort order is by time of arrival. The oldest
  location in the DB has number 1 and the newest the highest number (=equal the
  number of locations in the DB).

  The newest location (according to the specified sort order) is always at the
  top. The sort order can be set to either "by arrival" or "by timestamp". See
  the "db sort" command.

  For example:

        % db head
        0002  2014-12-11 00:57:07 3000000001 61.478771 15.382076 0   "828 93, Sweden"
        0001  2014-12-11 00:22:25 3000000001 57.478771 16.382076 0   "Skälsebo Målehorva 2, 572 96 Fårbo, Sweden"

  Or with pretty printing enabled

        % .table
        Table drawing : On
        % db head
        ╔════╤═══════════════════╤══════════╤═════════╤═════════╤═════╤══════════════════════════════════════════╗
        ║  # │       Date        │  Dev.ID  │   Lat   │   Lon   │Speed│                  Address                 ║
        ╠════╪═══════════════════╪══════════╪═════════╪═════════╪═════╪══════════════════════════════════════════╣
        ║0002│2014-12-11 00:57:07│3000000001│61.478771│15.382076│0    │828 93, Sweden                            ║
        ╟────┼───────────────────┼──────────┼─────────┼─────────┼─────┼──────────────────────────────────────────╢
        ║0001│2014-12-11 00:22:25│3000000001│57.478771│16.382076│0    │Skälsebo Målehorva 2, 572 96 Fårbo, Sweden║
        ╚════╧═══════════════════╧══════════╧═════════╧═════════╧═════╧══════════════════════════════════════════╝



Bugs fixed
----------

- Fix handling of GFEN command to show all arguments. This also changes behavior so
  that it is no longer possible to only use the "set gfen on" as a shortcut.

- Fixed a bug where device replies for commands with no reply argument was not
  properly received.  

- The CSS tag for bold fonts in email template "mail_event.html" was wrong.

- The memcpy() used strlcpy() would read too much memory for short strings. This
  would never cause a buffer overwrite error but could be reading non-accessible
  memory and result in a **SIGSEGV**.

- The field labels in the last location mail template was wrong


Internal changes (visible for developers and packagers)
-------------------------------------------------------
- New location for the repository 
  https://sourceforge.net/p/g7ctrl/git/

- Moved to Git based repository from 3.2.0 and hence all SVN tags
  has been removed.

- Renamed geolocation_google.[hc] to geoloc.[hc]

- The modules "unicode_tbl.[ch]" was added which manage the table formatting
  in a nice and easy way.

- The daemon now initializes setlocale(LC_ALL,"") to read the current locale
  since it will be needed for correctly handling of UTF8 code points.

- In XML doc sources start replacing xlink:href with linkend

- Added some more detailed error messages to better diagnose what Google is
  returning as street address (or not).

- Some internal changes to DB location list handling

- Generic improvements in handling of UTF8 encoded chars
   - Added xmb_strncpy() in xstr.c as a UTF8 safe version of strncpy()
   - Refactored all internal usage of strncpy() to use UTF8 safe version as applicable
     as well as buffer and security audit of all usages.
   - Added UTF8 safe versions of printf() and fprintf() to properly format strings with
     size specifiers such as "%-30s" xmb_printf(), and xmb_fprintf()
   - Added xmb_strncat()


- For OSX an approximation of clock_gettime() POSIX call has been added in the
  utils module.

- Increased a number of buffers used with the socket communication to be able to
  handle larger amount of data in the g7 shell before truncating and giving an
  error.

- The built in SMTP library has received some better documentation and some
  new utility methods to simplify handling of non-file based images that should
  be included as inline pictures.

- The mailutil library has also got new supporting functionality to work with
  images that are inline and not included as attachments.

- If the system uses logrotate the installation will now install a configuration
  script in /etc/logrotate.d . NOTE since the logfile could be a runtime setting
  it might need adjustment if a non standard location is used for the logfile.
  The logrotate script assumes that the logfile is "/var/log/g7ctrl/g7ctrl.log"

- The README files and other text info files have been made compatible with
  markdown syntax

- The created file for source statistics in the manual is removed from the
  repo since it is a constructed file and updates on a make of the manual.
  The stats are now created from the makefile in the docs/manual directory.



g7ctrl v3.1.0 (march 2015)
==========================

General notes for this release
------------------------------
**This release bring some notable new features:**

1. Each connected client can now independently have different connected devices.
   In previous releases all clients talked to the same device when issuing
   commands and if one client changed the target the other clients were also
   changed since the target device was a server setting.

2. The server can now manage several connected devices over USB and the
   client can select which of the connected USB devices to talk to.
   In addition when a USB device is connected the ID of the device is read
   and first after the ID has been successfully read is the device available
   for commands.

3. The last feature that will allow the user to specify a proximity range for
   when the location lookup should match an existing address. The proximity is
   specified as a new value (in meters) in the config file.
   Since the accuracy of the GPS is rarely better than 15 meters it is
   un-necessary to send a request to Google if the location is only different
   in the last digit or so in the received coordinates. The distance calculation
   uses the "Haversine" method (Great circle) to calculate the distance between
   two locations.

4. Summary of new/modified commands introduced in this release
   Server commands:

    * .target     - List/Set device target connected over GPRS
    * .usb        - List/Set device target connected on a USB port
    * .ld         - List all connected devices
    * -lc         - List all connected command clients

    Device commands:

    * get address - Return approx. street address for current location
    * @@CMD(arg1,arg2, ...) New syntax to give non-interactive commands


User visible changes:
---------------------
- Manual updated to RA13 to cover all new additions in 3.1.0

- A new command "get address" was  introduced which will get the latest
  location from the device as a street address.

- It is now possible to enter non-interactive commands with the syntax
  @@CMD(arg1,arg2,...)
  Example: @@LED(1)
  The syntax is the exact same as how presets are specified. This makes
  it faster to enter more complex command for experienced user by bypassing
  the question/answer process when using the ordinary command entering process.
  This is further documented in the manual.

- The new command ".target" replaces the old ".use" to specify which device
  should receive the commands. This targets a device connected over GPRS

- The new server command ".usb" is used to specify which USB port to talk
  to in case multiple devices are connected. It is also used to list devices
  currently connected on USB

- The ".lc" behavior is modified to only list command connections

- The new server command ".ld" is used to list connected devices over both
  USB and GPRS

- Each command client now have an individual connection state so each connected
  client can talk to a different device

- Multiple USB devices can be connected and managed

- The device ID of connected devices over USB is read upon connection. NOTE
  this also introduces a slight delay which also better indicates the time it
  tales for the device to establish a USB serial simulation so the device ID
  can be read back. It takes about 20s for the device to set up .

- Added "address_lookup_proximity" config setting to allow setting how close a
  cache match must be in order to be considered a match for a cached street address.

- Allow multiple commands in the same string for batch shell processing with
  "g7sh -e". Commands are separated with a ";" character
  For example: g7sh -e ".ver;db size;db mailcsv;"
  Commands with arguments are not yet supported.

- Updated documentation to reflect changes in 3.1.0. Updated troubleshooting
  guide and some more code statistics in the technical appendix.

- Some minor esthetic updates:
   - Extra blank line in reply after listing preset removed
   - Extra blank line in reply after sending mail with exported db removed
   - Title in mails sent on on new device connection and events harmonized

- Some minor updates of default values in the config file

- The timeout value for receiving command replies over GPRS was increased
  since it sometimes take up to 30s to receive a reply.


Bugs fixed:
-----------
- A number of theoretical buffer overruns was fixed (detected by Coverity scan)

- The translation to human readable text would always show "Off" for binary
  commands.

- The translation of the device error code to human text was incorrect for the
  case when the command name was not included in the reply (as the protocol
  specification wrongly states it always should be.)

- On some occasions the assumption was made that basename() does not change
  its argument (glibc - style since the code is built with _GNU_SOURCE defined).
  Unfortunately this is an incorrect assumption if both libgen.h and string.h
  is included in the same *.c file even if _GNU_SOURCE is defined!

- If the g7shell was terminated with Ctrl-C then the terminal could be left
  in a confused state and require a "reset" due to readline() signal
  handling not being properly cleaned up.

- A few minor spelling errors in comments and docs was fixed


Internal changes (visible for developers and packagers):
--------------------------------------------------------
- The xstrsplitfields() function has changed behavior so that it will
  preserve spaces in the split strings.

- Added buffer overrun checks in xstrsplitfields() for extra safety

- The signature for the geodetic distance calculations functions have been
  updated to reflect there const'ness

- Renamed worker.[ch] -&gt; socklistener.[ch]

- Some major refactoring in all command methods due to the need to include
  the client context which is unique for each command thread.

- A new structure usb_conn_status have ben introduced to keep track of multiple
  USB devices.



g7ctrl v3.0.0 (jan 2015)
========================

**General notes for this release**
-----------------------------------
The bump in full version number is made necessary since the config file
and startup option has changed and potentially breaks the backwards
compatibility with existing installation scripts by packager.

This release also changes the location for various data files to better
adhere to FHS.

This is good thing but potential packagers need to be aware of this even
though it should make things simpler in the long run.


User visible changes:
---------------------
- Make the daemon reload config and preset files on receiving signal SIGHUP

- Removed the daemonize config setting from the config file. It makes more sense to
  only have this as a program option handled by a system administrator at install time.

- The directories for the data files has been changed to better adherence to FHS.
  This means that :
    a) The static datafiles (templates etc.) are moved to /usr/share/g7ctrl
    b) The default data files that change (i.e. DB files) is now moved to /var/lib/g7ctrl
    c) The default PID lock file is in /var/run/g7ctrl
    d) The default logfile is in /var/log/g7ctrl
    e) The default config file location remains in /etc/g7ctrl
  These locations can be overridden by program options at start of the daemon using
  the new options --pidfile , --datadir, --dbdir

- The db_dir and logfile locations are removed from the config file since this is
  more correctly a packaging setting and now has to be overridden by program
  options. This also makes it possible to reload config file on the fly when we receive
  the SIGHUP signal.

- Added JSON export format for DB.

- When exporting the DB to chosen format there is no longer any imposed size restriction
  other than available memory.

- Don't install the g7m emulator for regular builds but only for development builds
  it does not make sense for regular users to have this.


Bugs fixed:
-----------
- The mail handling can now be completely disabled with the config setting "use_mail"
  Previously this setting was ignored.

- The upstart script (for Debian based distributions) was using "expect fork" when
  it needs an "expect dameon" since we fork exactly twice to avoid becoming session leader.
  This error made "stop g7ctrl" give an error since the wrong PID was registered
  by upstart.

- If translation to human labels on receiving device replies was enabled then the reply
  from the server would erronous indicate an error in the device reply.


Internal changes (visible for developers and packagers):
--------------------------------------------------------
- Use the system log directory by default, i.e. "/var/log" and handle permission
  accordingly when we drop down.

- The lockfile handling has been completely rewritten to better adhere to
  best practice. This also means that the daemon accepts and extra command
  line argument "-z" to optionally specify where to store a lockfile.
  NOTE1: This is now mandatory if the daemon is not started as root!
  NOTE2: When started as root the lockfile is always stored in "/var/run/g7ctrl/g7ctrl.pid"

- By configuring with "--enable-stacktrace" this will now force gcc to use the
  "-rdynamic" flag to be able to include the symbol tables so that the stacktrace
  directly can give better human information. In addition enabling the stacktrace
  is interpretated as a development build and will also build the emulator.

- Added utility build script "dbgconfig.sh" to configure a development build.

- The automake file for installing assets like templates has been rewritten to
  make it clearer and rely more on the built in magic of autotools

- Added utility build scripts ststbuild,sh and ststrun.sh to build and install
  in a system test directory for development purposes using the make staging
  with DESTDIR
</pre></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.backlog"></a>Appendix G - Backlog</h2></div></div></div><p>
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This is a detailed list of historic and planned releases and major implemented
                features. This documentation is mostly directed towards developers wanting an
                understanding of the evolution of the application and where it is heading.</p></div><p>
    </p><p>
        </p><pre class="programlisting">$Id: TODO 954 2015-04-10 19:14:10Z ljp $
This is a list of features planned as backlog activities in reverse chronological order.


Planned for v4.1.0 [NOT STARTED]
--------------------------------
TAGLINE: 

Backlog:
- Establish infrastructure for localization of messages
- Verify that device connected is really GM7 tracker (by checking sysfs  
  information /sys/class/tty/.. for model id and manufacturer) 
- Improved USB handling (detection of GM7 device using manufacturer and device iD)
- Add /udev rules to detect GM7 device automatically instead of inotify()
  Device seems to use the following settings:

    # Info from
    # udevadm info --query=all --name=/dev/ttyACM0
    P: /devices/pci0000:00/0000:00:1d.1/usb7/7-1/7-1:1.0/tty/ttyACM0
    N: ttyACM0
    S: serial/by-id/usb-03eb_6130-if00
    S: serial/by-path/pci-0000:00:1d.1-usb-0:1:1.0
    E: DEVLINKS=/dev/serial/by-id/usb-03eb_6130-if00 /dev/serial/by-path/pci-0000:00:1d.1-usb-0:1:1.0
    E: DEVNAME=/dev/ttyACM0
    E: DEVPATH=/devices/pci0000:00/0000:00:1d.1/usb7/7-1/7-1:1.0/tty/ttyACM0
    E: ID_BUS=usb
    E: ID_MM_CANDIDATE=1
    E: ID_MODEL=6130
    E: ID_MODEL_ENC=6130
    E: ID_MODEL_ID=6130
    E: ID_PATH=pci-0000:00:1d.1-usb-0:1:1.0
    E: ID_PATH_TAG=pci-0000_00_1d_1-usb-0_1_1_0
    E: ID_REVISION=0110
    E: ID_SERIAL=03eb_6130
    E: ID_TYPE=generic
    E: ID_USB_DRIVER=cdc_acm
    E: ID_USB_INTERFACES=:020201:0a0000:
    E: ID_USB_INTERFACE_NUM=00
    E: ID_VENDOR=03eb
    E: ID_VENDOR_ENC=03eb
    E: ID_VENDOR_FROM_DATABASE=Atmel Corp.
    E: ID_VENDOR_ID=03eb
    E: MAJOR=166
    E: MINOR=0
    E: SUBSYSTEM=tty
    E: TAGS=:systemd:
    E: USEC_INITIALIZED=39333429206

Done:
- &lt;empty&gt;


Planned for v4.0.0 [NOT STARTED]
--------------------------------
Backlog:
- Add built-in Web-interface for device configure and tracking data handling
  -- Add micro-web server
  -- Theme handling based on CSS
  -- Should use responsive design and asynchronous Javscript
  

Done:
- &lt;empty&gt;


Planned for v3.3.0 [NOT STARTED]
--------------------------------
Backlog:
- Add option to return all command replies in structured JSON format

Done:
- &lt;empty&gt;



Planned for v3.2.1 [NOT STARTED]
--------------------------------
Backlog:
- Add minimap to last location mail template
- Add option to scale minimap images for higher resolution
- Add note in manual about logrotate
- Make buildnumber into a timestamp instead
- Make it possible for Google 24h API ban end time to survive server restart


Done:
- &lt;empty&gt;



Planned for v3.2.0 [**COMPLETED]
--------------------------------
Backlog:
- &lt;empty&gt;

Done:
- Add json DB export option to documentation
- Add documentation of new config options in relation to minimaps
- Code cleanup and coverity check
- Add documentation for ".cachestat"
- Add option to include a minimap in the notification mail on where the
  tracker currently is in order to avoid having to follow the link to Google.
- Add documentation in the manual for Google API key handling and application
- Add missing doc for config options
- Add unicode drawing of tables for nice output
- Handle system with binaries for compression program in non-standard locations
- Document .table command
- Investigate why we cannot parse Gelookup for address:
  Geocache MISS (59.478771,15.382076)
  ** Failed to parse service reply for address (lat=59.478771, lon=15.382076)
  ** Reverse geolocation lookup failed for (59.478771,15.382076)
  (Resolved: Does not have a street address)
- Add option to print head of last positions in DB to screen
- Add proper table output for db head and db tail
- Rework all table output to only use unitable module
- Check that address lookup can be used when importing locations over USB from
  device.
- Add Google API key to config file
- Improve capacity to handle large data sent back from the server to the shell
- Add command ".ratereset"
- Add mail notification when 24 API limit has been reached


Planned for v3.1.0 [**COMPLETED]
--------------------------------
Backlog:
- &lt;empty&gt;

Done:
- Update documentation for new ".target", ".lc" and ".ld" commands.
- Change the .use command. Proposed new syntax
  ".target x"    to connect to target device at usb index 'x'
                 the index can be ssen by listing all connected
  ".usb x"       USB devices with command ".ld"
                 The default when a command client is connected
                 will be "usb 0" (The first connected device)
- Do a clean exit in GNU readline if the shell is terminated by user with C-C
- Make device target a per client setting (larger refactoring)
- Make it possible to handle multiple USB client connected to the server
- Make the .lc command only list command clients
- Add .ld command that only lists connected device and shows the active connection
- Updated docs and help texts
- Accept multiple device commands on command line with the '-e' option
- Store the geocache on file when the daemon shuts down
- Add automatically updated code statistics in technical section of the manual
- Add information about the Geo cache saved file
- Update utility build script documentation
- Add reading Dev ID for OSX version of connect agent
- (remove .ld and replace with .target without argument in analogue with how .usb works
- Investigate feasibility to switch ports on account on receiving SIGHUP 
  Conclusion: Not worth the extra complexity. Change of listening ports will require restart
  of daemon.
- Add help for new .usb and .target commands for the online "help"
- Add documentation for "@@" non-interactive functions
- Add command "get address" which is similar to "get loc" but will return 
  the corresponding street address as returned by Google maps for the
  current location.
- Add option to specify commands with argument to the "-e" option for command 
  shell to allow its use in off-line batch processing.
- Add documentation for multiple USB
  

Planned for v3.0.0 [**COMPLETED]
--------------------------------
Backlog:
- Empty.


Done:
- Change directory structure for all files and data to more closely follow LSB
- Re-read Config file on receiving SIGHUP signal (except changing listening port)
- Add JSON export of DB
- Improve lockfile handing according to LSB



Planned for v2.3.0 [**COMPLETED]
--------------------------------
TAGLINE: 

Backlog:
- Empty

Done:
- Add handling of GFEN events 50-99
- Add downloading of records over GPRS



Planned for v3.0.0 [**COMPLETED]
--------------------------------
Backlog:
- &lt;empty&gt;

Done:
- Add JSON DB export
- Fix so that the daemon better uses FHS standard for daemons
- Restructure config file to be able to do reload on-the-fly  
- Don't install the emulator in normal builds
- Review the config files to change the location of installed files


Planned for v2.2.0 [**COMPLETED]
--------------------------------
TAGLINE: 
Make it possible to fully use OS X as deployment and build platform and
add smart reverse Geolocation lookup. Improve cross platform stability
on the USB/Serial port handling.

Backlog:
- Fix installation conflict on Debian if trying to install when there already
  have been on installation2


Done:
- Add full OS X support for both daemon and USB
- Add reverse Geolocation address handling
- Fix build scripts for XML documentation to better cope with different build
  systems.
- Handle daemon startup/shutdown scripts for new Debian/Ubuntu




Planned for v2.1.0 [**COMPLETED]
--------------------------------
TAGLINE: Communication to device over GPRS and show device reply in plain
         text.

Backlog:
 - &lt;empty&gt;

Done:
- Make it possible to have finer select which records are exported and mailed as 
  attachment on date and/or device id
- More consistent handling of command reply
- Clean up command sending/receiving
- Communicate TO device over GPRS
- Add automatic tagging of commands to recognize proper responses
- Document ".use"
- Add detailed help for all server commands
- Add optional interpretation of command replies so that for example the reply
  get lowbatt, "0,0" translates to :
       Report action: Disable
            VIP Mask: 0
- Add preset templates for power management
- Run through Coverity and fix warnings




Planned for v2.0.1 [**COMPLETED]
--------------------------------
TAGLINE: Optimize DB, nick names, add geo fence event command and fix all
remaining standard commands. Under the hood preparation for 
communication to device over GPRS.


Backlog:
- &lt;empty&gt;

Done:
- Add command ".lc" - List active connections
- Optimize DB storage
- Add option to connect a nick-name to a specific device id which is used in
  for example mail and DB exports
- Break up time disjoint events with user selectable cut-off time into multiple 
  track-segments in GPX export
- Add commands 
    "get batt" = Get battery voltage
- Sort "help" commands
- Refactor download of locations
- Refactor mid level read from device
- Refactor nick name handling
- Implement gfevt
- Make it possible to specify usage of xz or gz compression for mailing GPX file
  in config.
- Improve build handling on systems not having "links" installed
- GPRS: If new incoming connection is from a device that has an old connection
  remove old connection immediately (without waiting for it to timeout)
- Check DB version
- Dynamic IP address for device is kept up to date when GPRS connection exists
  this is the first half of handling commands over GPRS.
- Design and add geofence numbered events handling



&lt;EOF&gt;
</pre><p>
    </p></div></div></body></html>
